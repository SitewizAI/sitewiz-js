{"version":3,"file":"main.js","sources":["../src/utils/cookies.ts","../src/utils/uuid.ts","../node_modules/rrweb/es/rrweb/packages/rrweb-snapshot/es/rrweb-snapshot.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/utils.js","../node_modules/rrweb/es/rrweb/packages/types/dist/types.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/mutation.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/error-handler.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observer.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/cross-origin-iframe-mirror.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/iframe-manager.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/shadow-dom-manager.js","../node_modules/rrweb/es/rrweb/ext/tslib/tslib.es6.js","../node_modules/rrweb/es/rrweb/ext/base64-arraybuffer/dist/base64-arraybuffer.es5.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observers/canvas/serialize-args.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observers/canvas/canvas.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observers/canvas/webgl.js","../node_modules/rrweb/es/rrweb/_virtual/image-bitmap-data-url-worker.js","../node_modules/rrweb/es/rrweb/_virtual/_rollup-plugin-web-worker-loader__helper__browser__createInlineWorkerFactory.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/index.js","../node_modules/rrweb/es/rrweb/_virtual/_rollup-plugin-web-worker-loader__helper__funcToSource.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observers/canvas/canvas-manager.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observers/canvas/2d.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/stylesheet-manager.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/processed-node-manager.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/plugins/console/record/error-stack-parser.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/plugins/console/record/stringify.js","../node_modules/rrweb/es/rrweb/packages/rrweb/src/plugins/console/record/index.js","../src/plugins/error.ts","../src/plugins/revenue.ts","../src/plugins/clickedElement.ts","../src/plugins/ga4.tsx","../node_modules/tslib/tslib.es6.js","../src/utils/type-utils.ts","../src/utils/request-utils.ts","../src/utils/ua-utils.ts","../src/utils/event-utils.ts","../src/plugins/userAgentDetection.ts","../src/optimizations/mutationLimiter.ts","../node_modules/fflate/esm/browser.js","../src/utils/compress.ts","../src/optimizations/queue.ts","../src/session-replay.ts","../src/plugins/marketingTracking.ts","../src/entrypoints/main.ts","../src/sitewiz-core.ts"],"sourcesContent":["import { uuidv4 } from \"./uuid\";\n\nexport function getSessionId() : [string, boolean]  {\n    const name = \"sitewizsession=\";\n    const decodedCookie = decodeURIComponent(document.cookie);\n    const ca = decodedCookie.split(\";\");\n    for (let i = 0; i < ca.length; i++) {\n      let c = ca[i];\n      while (c.charAt(0) === \" \") {\n        c = c.substring(1);\n      }\n      if (c.indexOf(name) === 0) {\n        const sessionId = c.substring(name.length, c.length);\n        return [sessionId, true];\n      }\n    }\n    const newSessionId = uuidv4();\n    setCookie(\"sitewizsession\", newSessionId, 1);\n    return [newSessionId, false];\n  }\n\nexport function setCookie(name: string, value: string, days: number) {\n    const d = new Date();\n    d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);\n    const expires = \"expires=\" + d.toUTCString();\n    document.cookie = `${name}=${value};${expires};path=/`;\n  }","export function uuidv4() : string {\n    return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(\n      /[xy]/g,\n      function (c) {\n        const r = (Math.random() * 16) | 0,\n          v = c === \"x\" ? r : (r & 0x3) | 0x8;\n        return v.toString(16);\n      }\n    );\n}\n\n\n\n","var NodeType;\r\n(function (NodeType) {\r\n    NodeType[NodeType[\"Document\"] = 0] = \"Document\";\r\n    NodeType[NodeType[\"DocumentType\"] = 1] = \"DocumentType\";\r\n    NodeType[NodeType[\"Element\"] = 2] = \"Element\";\r\n    NodeType[NodeType[\"Text\"] = 3] = \"Text\";\r\n    NodeType[NodeType[\"CDATA\"] = 4] = \"CDATA\";\r\n    NodeType[NodeType[\"Comment\"] = 5] = \"Comment\";\r\n})(NodeType || (NodeType = {}));\n\nfunction isElement(n) {\r\n    return n.nodeType === n.ELEMENT_NODE;\r\n}\r\nfunction isShadowRoot(n) {\r\n    const host = n === null || n === void 0 ? void 0 : n.host;\r\n    return Boolean((host === null || host === void 0 ? void 0 : host.shadowRoot) === n);\r\n}\r\nfunction isNativeShadowDom(shadowRoot) {\r\n    return Object.prototype.toString.call(shadowRoot) === '[object ShadowRoot]';\r\n}\r\nfunction fixBrowserCompatibilityIssuesInCSS(cssText) {\r\n    if (cssText.includes(' background-clip: text;') &&\r\n        !cssText.includes(' -webkit-background-clip: text;')) {\r\n        cssText = cssText.replace(' background-clip: text;', ' -webkit-background-clip: text; background-clip: text;');\r\n    }\r\n    return cssText;\r\n}\r\nfunction escapeImportStatement(rule) {\r\n    const { cssText } = rule;\r\n    if (cssText.split('\"').length < 3)\r\n        return cssText;\r\n    const statement = ['@import', `url(${JSON.stringify(rule.href)})`];\r\n    if (rule.layerName === '') {\r\n        statement.push(`layer`);\r\n    }\r\n    else if (rule.layerName) {\r\n        statement.push(`layer(${rule.layerName})`);\r\n    }\r\n    if (rule.supportsText) {\r\n        statement.push(`supports(${rule.supportsText})`);\r\n    }\r\n    if (rule.media.length) {\r\n        statement.push(rule.media.mediaText);\r\n    }\r\n    return statement.join(' ') + ';';\r\n}\r\nfunction stringifyStylesheet(s) {\r\n    try {\r\n        const rules = s.rules || s.cssRules;\r\n        return rules\r\n            ? fixBrowserCompatibilityIssuesInCSS(Array.from(rules, stringifyRule).join(''))\r\n            : null;\r\n    }\r\n    catch (error) {\r\n        return null;\r\n    }\r\n}\r\nfunction stringifyRule(rule) {\r\n    let importStringified;\r\n    if (isCSSImportRule(rule)) {\r\n        try {\r\n            importStringified =\r\n                stringifyStylesheet(rule.styleSheet) ||\r\n                    escapeImportStatement(rule);\r\n        }\r\n        catch (error) {\r\n        }\r\n    }\r\n    else if (isCSSStyleRule(rule) && rule.selectorText.includes(':')) {\r\n        return fixSafariColons(rule.cssText);\r\n    }\r\n    return importStringified || rule.cssText;\r\n}\r\nfunction fixSafariColons(cssStringified) {\r\n    const regex = /(\\[(?:[\\w-]+)[^\\\\])(:(?:[\\w-]+)\\])/gm;\r\n    return cssStringified.replace(regex, '$1\\\\$2');\r\n}\r\nfunction isCSSImportRule(rule) {\r\n    return 'styleSheet' in rule;\r\n}\r\nfunction isCSSStyleRule(rule) {\r\n    return 'selectorText' in rule;\r\n}\r\nclass Mirror {\r\n    constructor() {\r\n        this.idNodeMap = new Map();\r\n        this.nodeMetaMap = new WeakMap();\r\n    }\r\n    getId(n) {\r\n        var _a;\r\n        if (!n)\r\n            return -1;\r\n        const id = (_a = this.getMeta(n)) === null || _a === void 0 ? void 0 : _a.id;\r\n        return id !== null && id !== void 0 ? id : -1;\r\n    }\r\n    getNode(id) {\r\n        return this.idNodeMap.get(id) || null;\r\n    }\r\n    getIds() {\r\n        return Array.from(this.idNodeMap.keys());\r\n    }\r\n    getMeta(n) {\r\n        return this.nodeMetaMap.get(n) || null;\r\n    }\r\n    removeNodeFromMap(n) {\r\n        const id = this.getId(n);\r\n        this.idNodeMap.delete(id);\r\n        if (n.childNodes) {\r\n            n.childNodes.forEach((childNode) => this.removeNodeFromMap(childNode));\r\n        }\r\n    }\r\n    has(id) {\r\n        return this.idNodeMap.has(id);\r\n    }\r\n    hasNode(node) {\r\n        return this.nodeMetaMap.has(node);\r\n    }\r\n    add(n, meta) {\r\n        const id = meta.id;\r\n        this.idNodeMap.set(id, n);\r\n        this.nodeMetaMap.set(n, meta);\r\n    }\r\n    replace(id, n) {\r\n        const oldNode = this.getNode(id);\r\n        if (oldNode) {\r\n            const meta = this.nodeMetaMap.get(oldNode);\r\n            if (meta)\r\n                this.nodeMetaMap.set(n, meta);\r\n        }\r\n        this.idNodeMap.set(id, n);\r\n    }\r\n    reset() {\r\n        this.idNodeMap = new Map();\r\n        this.nodeMetaMap = new WeakMap();\r\n    }\r\n}\r\nfunction createMirror() {\r\n    return new Mirror();\r\n}\r\nfunction maskInputValue({ element, maskInputOptions, tagName, type, value, maskInputFn, }) {\r\n    let text = value || '';\r\n    const actualType = type && toLowerCase(type);\r\n    if (maskInputOptions[tagName.toLowerCase()] ||\r\n        (actualType && maskInputOptions[actualType])) {\r\n        if (maskInputFn) {\r\n            text = maskInputFn(text, element);\r\n        }\r\n        else {\r\n            text = '*'.repeat(text.length);\r\n        }\r\n    }\r\n    return text;\r\n}\r\nfunction toLowerCase(str) {\r\n    return str.toLowerCase();\r\n}\r\nconst ORIGINAL_ATTRIBUTE_NAME = '__rrweb_original__';\r\nfunction is2DCanvasBlank(canvas) {\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx)\r\n        return true;\r\n    const chunkSize = 50;\r\n    for (let x = 0; x < canvas.width; x += chunkSize) {\r\n        for (let y = 0; y < canvas.height; y += chunkSize) {\r\n            const getImageData = ctx.getImageData;\r\n            const originalGetImageData = ORIGINAL_ATTRIBUTE_NAME in getImageData\r\n                ? getImageData[ORIGINAL_ATTRIBUTE_NAME]\r\n                : getImageData;\r\n            const pixelBuffer = new Uint32Array(originalGetImageData.call(ctx, x, y, Math.min(chunkSize, canvas.width - x), Math.min(chunkSize, canvas.height - y)).data.buffer);\r\n            if (pixelBuffer.some((pixel) => pixel !== 0))\r\n                return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction isNodeMetaEqual(a, b) {\r\n    if (!a || !b || a.type !== b.type)\r\n        return false;\r\n    if (a.type === NodeType.Document)\r\n        return a.compatMode === b.compatMode;\r\n    else if (a.type === NodeType.DocumentType)\r\n        return (a.name === b.name &&\r\n            a.publicId === b.publicId &&\r\n            a.systemId === b.systemId);\r\n    else if (a.type === NodeType.Comment ||\r\n        a.type === NodeType.Text ||\r\n        a.type === NodeType.CDATA)\r\n        return a.textContent === b.textContent;\r\n    else if (a.type === NodeType.Element)\r\n        return (a.tagName === b.tagName &&\r\n            JSON.stringify(a.attributes) ===\r\n                JSON.stringify(b.attributes) &&\r\n            a.isSVG === b.isSVG &&\r\n            a.needBlock === b.needBlock);\r\n    return false;\r\n}\r\nfunction getInputType(element) {\r\n    const type = element.type;\r\n    return element.hasAttribute('data-rr-is-password')\r\n        ? 'password'\r\n        : type\r\n            ?\r\n                toLowerCase(type)\r\n            : null;\r\n}\r\nfunction extractFileExtension(path, baseURL) {\r\n    var _a;\r\n    let url;\r\n    try {\r\n        url = new URL(path, baseURL !== null && baseURL !== void 0 ? baseURL : window.location.href);\r\n    }\r\n    catch (err) {\r\n        return null;\r\n    }\r\n    const regex = /\\.([0-9a-z]+)(?:$)/i;\r\n    const match = url.pathname.match(regex);\r\n    return (_a = match === null || match === void 0 ? void 0 : match[1]) !== null && _a !== void 0 ? _a : null;\r\n}\n\nlet _id = 1;\r\nconst tagNameRegex = new RegExp('[^a-z0-9-_:]');\r\nconst IGNORED_NODE = -2;\r\nfunction genId() {\r\n    return _id++;\r\n}\r\nfunction getValidTagName(element) {\r\n    if (element instanceof HTMLFormElement) {\r\n        return 'form';\r\n    }\r\n    const processedTagName = toLowerCase(element.tagName);\r\n    if (tagNameRegex.test(processedTagName)) {\r\n        return 'div';\r\n    }\r\n    return processedTagName;\r\n}\r\nfunction extractOrigin(url) {\r\n    let origin = '';\r\n    if (url.indexOf('//') > -1) {\r\n        origin = url.split('/').slice(0, 3).join('/');\r\n    }\r\n    else {\r\n        origin = url.split('/')[0];\r\n    }\r\n    origin = origin.split('?')[0];\r\n    return origin;\r\n}\r\nlet canvasService;\r\nlet canvasCtx;\r\nconst URL_IN_CSS_REF = /url\\((?:(')([^']*)'|(\")(.*?)\"|([^)]*))\\)/gm;\r\nconst URL_PROTOCOL_MATCH = /^(?:[a-z+]+:)?\\/\\//i;\r\nconst URL_WWW_MATCH = /^www\\..*/i;\r\nconst DATA_URI = /^(data:)([^,]*),(.*)/i;\r\nfunction absoluteToStylesheet(cssText, href) {\r\n    return (cssText || '').replace(URL_IN_CSS_REF, (origin, quote1, path1, quote2, path2, path3) => {\r\n        const filePath = path1 || path2 || path3;\r\n        const maybeQuote = quote1 || quote2 || '';\r\n        if (!filePath) {\r\n            return origin;\r\n        }\r\n        if (URL_PROTOCOL_MATCH.test(filePath) || URL_WWW_MATCH.test(filePath)) {\r\n            return `url(${maybeQuote}${filePath}${maybeQuote})`;\r\n        }\r\n        if (DATA_URI.test(filePath)) {\r\n            return `url(${maybeQuote}${filePath}${maybeQuote})`;\r\n        }\r\n        if (filePath[0] === '/') {\r\n            return `url(${maybeQuote}${extractOrigin(href) + filePath}${maybeQuote})`;\r\n        }\r\n        const stack = href.split('/');\r\n        const parts = filePath.split('/');\r\n        stack.pop();\r\n        for (const part of parts) {\r\n            if (part === '.') {\r\n                continue;\r\n            }\r\n            else if (part === '..') {\r\n                stack.pop();\r\n            }\r\n            else {\r\n                stack.push(part);\r\n            }\r\n        }\r\n        return `url(${maybeQuote}${stack.join('/')}${maybeQuote})`;\r\n    });\r\n}\r\nconst SRCSET_NOT_SPACES = /^[^ \\t\\n\\r\\u000c]+/;\r\nconst SRCSET_COMMAS_OR_SPACES = /^[, \\t\\n\\r\\u000c]+/;\r\nfunction getAbsoluteSrcsetString(doc, attributeValue) {\r\n    if (attributeValue.trim() === '') {\r\n        return attributeValue;\r\n    }\r\n    let pos = 0;\r\n    function collectCharacters(regEx) {\r\n        let chars;\r\n        const match = regEx.exec(attributeValue.substring(pos));\r\n        if (match) {\r\n            chars = match[0];\r\n            pos += chars.length;\r\n            return chars;\r\n        }\r\n        return '';\r\n    }\r\n    const output = [];\r\n    while (true) {\r\n        collectCharacters(SRCSET_COMMAS_OR_SPACES);\r\n        if (pos >= attributeValue.length) {\r\n            break;\r\n        }\r\n        let url = collectCharacters(SRCSET_NOT_SPACES);\r\n        if (url.slice(-1) === ',') {\r\n            url = absoluteToDoc(doc, url.substring(0, url.length - 1));\r\n            output.push(url);\r\n        }\r\n        else {\r\n            let descriptorsStr = '';\r\n            url = absoluteToDoc(doc, url);\r\n            let inParens = false;\r\n            while (true) {\r\n                const c = attributeValue.charAt(pos);\r\n                if (c === '') {\r\n                    output.push((url + descriptorsStr).trim());\r\n                    break;\r\n                }\r\n                else if (!inParens) {\r\n                    if (c === ',') {\r\n                        pos += 1;\r\n                        output.push((url + descriptorsStr).trim());\r\n                        break;\r\n                    }\r\n                    else if (c === '(') {\r\n                        inParens = true;\r\n                    }\r\n                }\r\n                else {\r\n                    if (c === ')') {\r\n                        inParens = false;\r\n                    }\r\n                }\r\n                descriptorsStr += c;\r\n                pos += 1;\r\n            }\r\n        }\r\n    }\r\n    return output.join(', ');\r\n}\r\nfunction absoluteToDoc(doc, attributeValue) {\r\n    if (!attributeValue || attributeValue.trim() === '') {\r\n        return attributeValue;\r\n    }\r\n    const a = doc.createElement('a');\r\n    a.href = attributeValue;\r\n    return a.href;\r\n}\r\nfunction isSVGElement(el) {\r\n    return Boolean(el.tagName === 'svg' || el.ownerSVGElement);\r\n}\r\nfunction getHref() {\r\n    const a = document.createElement('a');\r\n    a.href = '';\r\n    return a.href;\r\n}\r\nfunction transformAttribute(doc, tagName, name, value) {\r\n    if (!value) {\r\n        return value;\r\n    }\r\n    if (name === 'src' ||\r\n        (name === 'href' && !(tagName === 'use' && value[0] === '#'))) {\r\n        return absoluteToDoc(doc, value);\r\n    }\r\n    else if (name === 'xlink:href' && value[0] !== '#') {\r\n        return absoluteToDoc(doc, value);\r\n    }\r\n    else if (name === 'background' &&\r\n        (tagName === 'table' || tagName === 'td' || tagName === 'th')) {\r\n        return absoluteToDoc(doc, value);\r\n    }\r\n    else if (name === 'srcset') {\r\n        return getAbsoluteSrcsetString(doc, value);\r\n    }\r\n    else if (name === 'style') {\r\n        return absoluteToStylesheet(value, getHref());\r\n    }\r\n    else if (tagName === 'object' && name === 'data') {\r\n        return absoluteToDoc(doc, value);\r\n    }\r\n    return value;\r\n}\r\nfunction ignoreAttribute(tagName, name, _value) {\r\n    return (tagName === 'video' || tagName === 'audio') && name === 'autoplay';\r\n}\r\nfunction _isBlockedElement(element, blockClass, blockSelector) {\r\n    try {\r\n        if (typeof blockClass === 'string') {\r\n            if (element.classList.contains(blockClass)) {\r\n                return true;\r\n            }\r\n        }\r\n        else {\r\n            for (let eIndex = element.classList.length; eIndex--;) {\r\n                const className = element.classList[eIndex];\r\n                if (blockClass.test(className)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        if (blockSelector) {\r\n            return element.matches(blockSelector);\r\n        }\r\n    }\r\n    catch (e) {\r\n    }\r\n    return false;\r\n}\r\nfunction classMatchesRegex(node, regex, checkAncestors) {\r\n    if (!node)\r\n        return false;\r\n    if (node.nodeType !== node.ELEMENT_NODE) {\r\n        if (!checkAncestors)\r\n            return false;\r\n        return classMatchesRegex(node.parentNode, regex, checkAncestors);\r\n    }\r\n    for (let eIndex = node.classList.length; eIndex--;) {\r\n        const className = node.classList[eIndex];\r\n        if (regex.test(className)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (!checkAncestors)\r\n        return false;\r\n    return classMatchesRegex(node.parentNode, regex, checkAncestors);\r\n}\r\nfunction needMaskingText(node, maskTextClass, maskTextSelector, checkAncestors) {\r\n    try {\r\n        const el = node.nodeType === node.ELEMENT_NODE\r\n            ? node\r\n            : node.parentElement;\r\n        if (el === null)\r\n            return false;\r\n        if (typeof maskTextClass === 'string') {\r\n            if (checkAncestors) {\r\n                if (el.closest(`.${maskTextClass}`))\r\n                    return true;\r\n            }\r\n            else {\r\n                if (el.classList.contains(maskTextClass))\r\n                    return true;\r\n            }\r\n        }\r\n        else {\r\n            if (classMatchesRegex(el, maskTextClass, checkAncestors))\r\n                return true;\r\n        }\r\n        if (maskTextSelector) {\r\n            if (checkAncestors) {\r\n                if (el.closest(maskTextSelector))\r\n                    return true;\r\n            }\r\n            else {\r\n                if (el.matches(maskTextSelector))\r\n                    return true;\r\n            }\r\n        }\r\n    }\r\n    catch (e) {\r\n    }\r\n    return false;\r\n}\r\nfunction onceIframeLoaded(iframeEl, listener, iframeLoadTimeout) {\r\n    const win = iframeEl.contentWindow;\r\n    if (!win) {\r\n        return;\r\n    }\r\n    let fired = false;\r\n    let readyState;\r\n    try {\r\n        readyState = win.document.readyState;\r\n    }\r\n    catch (error) {\r\n        return;\r\n    }\r\n    if (readyState !== 'complete') {\r\n        const timer = setTimeout(() => {\r\n            if (!fired) {\r\n                listener();\r\n                fired = true;\r\n            }\r\n        }, iframeLoadTimeout);\r\n        iframeEl.addEventListener('load', () => {\r\n            clearTimeout(timer);\r\n            fired = true;\r\n            listener();\r\n        });\r\n        return;\r\n    }\r\n    const blankUrl = 'about:blank';\r\n    if (win.location.href !== blankUrl ||\r\n        iframeEl.src === blankUrl ||\r\n        iframeEl.src === '') {\r\n        setTimeout(listener, 0);\r\n        return iframeEl.addEventListener('load', listener);\r\n    }\r\n    iframeEl.addEventListener('load', listener);\r\n}\r\nfunction onceStylesheetLoaded(link, listener, styleSheetLoadTimeout) {\r\n    let fired = false;\r\n    let styleSheetLoaded;\r\n    try {\r\n        styleSheetLoaded = link.sheet;\r\n    }\r\n    catch (error) {\r\n        return;\r\n    }\r\n    if (styleSheetLoaded)\r\n        return;\r\n    const timer = setTimeout(() => {\r\n        if (!fired) {\r\n            listener();\r\n            fired = true;\r\n        }\r\n    }, styleSheetLoadTimeout);\r\n    link.addEventListener('load', () => {\r\n        clearTimeout(timer);\r\n        fired = true;\r\n        listener();\r\n    });\r\n}\r\nfunction serializeNode(n, options) {\r\n    const { doc, mirror, blockClass, blockSelector, needsMask, inlineStylesheet, maskInputOptions = {}, maskTextFn, maskInputFn, dataURLOptions = {}, inlineImages, recordCanvas, keepIframeSrcFn, newlyAddedElement = false, } = options;\r\n    const rootId = getRootId(doc, mirror);\r\n    switch (n.nodeType) {\r\n        case n.DOCUMENT_NODE:\r\n            if (n.compatMode !== 'CSS1Compat') {\r\n                return {\r\n                    type: NodeType.Document,\r\n                    childNodes: [],\r\n                    compatMode: n.compatMode,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    type: NodeType.Document,\r\n                    childNodes: [],\r\n                };\r\n            }\r\n        case n.DOCUMENT_TYPE_NODE:\r\n            return {\r\n                type: NodeType.DocumentType,\r\n                name: n.name,\r\n                publicId: n.publicId,\r\n                systemId: n.systemId,\r\n                rootId,\r\n            };\r\n        case n.ELEMENT_NODE:\r\n            return serializeElementNode(n, {\r\n                doc,\r\n                blockClass,\r\n                blockSelector,\r\n                inlineStylesheet,\r\n                maskInputOptions,\r\n                maskInputFn,\r\n                dataURLOptions,\r\n                inlineImages,\r\n                recordCanvas,\r\n                keepIframeSrcFn,\r\n                newlyAddedElement,\r\n                rootId,\r\n            });\r\n        case n.TEXT_NODE:\r\n            return serializeTextNode(n, {\r\n                needsMask,\r\n                maskTextFn,\r\n                rootId,\r\n            });\r\n        case n.CDATA_SECTION_NODE:\r\n            return {\r\n                type: NodeType.CDATA,\r\n                textContent: '',\r\n                rootId,\r\n            };\r\n        case n.COMMENT_NODE:\r\n            return {\r\n                type: NodeType.Comment,\r\n                textContent: n.textContent || '',\r\n                rootId,\r\n            };\r\n        default:\r\n            return false;\r\n    }\r\n}\r\nfunction getRootId(doc, mirror) {\r\n    if (!mirror.hasNode(doc))\r\n        return undefined;\r\n    const docId = mirror.getId(doc);\r\n    return docId === 1 ? undefined : docId;\r\n}\r\nfunction serializeTextNode(n, options) {\r\n    var _a;\r\n    const { needsMask, maskTextFn, rootId } = options;\r\n    const parentTagName = n.parentNode && n.parentNode.tagName;\r\n    let textContent = n.textContent;\r\n    const isStyle = parentTagName === 'STYLE' ? true : undefined;\r\n    const isScript = parentTagName === 'SCRIPT' ? true : undefined;\r\n    if (isStyle && textContent) {\r\n        try {\r\n            if (n.nextSibling || n.previousSibling) {\r\n            }\r\n            else if ((_a = n.parentNode.sheet) === null || _a === void 0 ? void 0 : _a.cssRules) {\r\n                textContent = stringifyStylesheet(n.parentNode.sheet);\r\n            }\r\n        }\r\n        catch (err) {\r\n            console.warn(`Cannot get CSS styles from text's parentNode. Error: ${err}`, n);\r\n        }\r\n        textContent = absoluteToStylesheet(textContent, getHref());\r\n    }\r\n    if (isScript) {\r\n        textContent = 'SCRIPT_PLACEHOLDER';\r\n    }\r\n    if (!isStyle && !isScript && textContent && needsMask) {\r\n        textContent = maskTextFn\r\n            ? maskTextFn(textContent, n.parentElement)\r\n            : textContent.replace(/[\\S]/g, '*');\r\n    }\r\n    return {\r\n        type: NodeType.Text,\r\n        textContent: textContent || '',\r\n        isStyle,\r\n        rootId,\r\n    };\r\n}\r\nfunction serializeElementNode(n, options) {\r\n    const { doc, blockClass, blockSelector, inlineStylesheet, maskInputOptions = {}, maskInputFn, dataURLOptions = {}, inlineImages, recordCanvas, keepIframeSrcFn, newlyAddedElement = false, rootId, } = options;\r\n    const needBlock = _isBlockedElement(n, blockClass, blockSelector);\r\n    const tagName = getValidTagName(n);\r\n    let attributes = {};\r\n    const len = n.attributes.length;\r\n    for (let i = 0; i < len; i++) {\r\n        const attr = n.attributes[i];\r\n        if (!ignoreAttribute(tagName, attr.name, attr.value)) {\r\n            attributes[attr.name] = transformAttribute(doc, tagName, toLowerCase(attr.name), attr.value);\r\n        }\r\n    }\r\n    if (tagName === 'link' && inlineStylesheet) {\r\n        const stylesheet = Array.from(doc.styleSheets).find((s) => {\r\n            return s.href === n.href;\r\n        });\r\n        let cssText = null;\r\n        if (stylesheet) {\r\n            cssText = stringifyStylesheet(stylesheet);\r\n        }\r\n        if (cssText) {\r\n            delete attributes.rel;\r\n            delete attributes.href;\r\n            attributes._cssText = absoluteToStylesheet(cssText, stylesheet.href);\r\n        }\r\n    }\r\n    if (tagName === 'style' &&\r\n        n.sheet &&\r\n        !(n.innerText || n.textContent || '').trim().length) {\r\n        const cssText = stringifyStylesheet(n.sheet);\r\n        if (cssText) {\r\n            attributes._cssText = absoluteToStylesheet(cssText, getHref());\r\n        }\r\n    }\r\n    if (tagName === 'input' || tagName === 'textarea' || tagName === 'select') {\r\n        const value = n.value;\r\n        const checked = n.checked;\r\n        if (attributes.type !== 'radio' &&\r\n            attributes.type !== 'checkbox' &&\r\n            attributes.type !== 'submit' &&\r\n            attributes.type !== 'button' &&\r\n            value) {\r\n            attributes.value = maskInputValue({\r\n                element: n,\r\n                type: getInputType(n),\r\n                tagName,\r\n                value,\r\n                maskInputOptions,\r\n                maskInputFn,\r\n            });\r\n        }\r\n        else if (checked) {\r\n            attributes.checked = checked;\r\n        }\r\n    }\r\n    if (tagName === 'option') {\r\n        if (n.selected && !maskInputOptions['select']) {\r\n            attributes.selected = true;\r\n        }\r\n        else {\r\n            delete attributes.selected;\r\n        }\r\n    }\r\n    if (tagName === 'canvas' && recordCanvas) {\r\n        if (n.__context === '2d') {\r\n            if (!is2DCanvasBlank(n)) {\r\n                attributes.rr_dataURL = n.toDataURL(dataURLOptions.type, dataURLOptions.quality);\r\n            }\r\n        }\r\n        else if (!('__context' in n)) {\r\n            const canvasDataURL = n.toDataURL(dataURLOptions.type, dataURLOptions.quality);\r\n            const blankCanvas = document.createElement('canvas');\r\n            blankCanvas.width = n.width;\r\n            blankCanvas.height = n.height;\r\n            const blankCanvasDataURL = blankCanvas.toDataURL(dataURLOptions.type, dataURLOptions.quality);\r\n            if (canvasDataURL !== blankCanvasDataURL) {\r\n                attributes.rr_dataURL = canvasDataURL;\r\n            }\r\n        }\r\n    }\r\n    if (tagName === 'img' && inlineImages) {\r\n        if (!canvasService) {\r\n            canvasService = doc.createElement('canvas');\r\n            canvasCtx = canvasService.getContext('2d');\r\n        }\r\n        const image = n;\r\n        const oldValue = image.crossOrigin;\r\n        image.crossOrigin = 'anonymous';\r\n        const recordInlineImage = () => {\r\n            image.removeEventListener('load', recordInlineImage);\r\n            try {\r\n                canvasService.width = image.naturalWidth;\r\n                canvasService.height = image.naturalHeight;\r\n                canvasCtx.drawImage(image, 0, 0);\r\n                attributes.rr_dataURL = canvasService.toDataURL(dataURLOptions.type, dataURLOptions.quality);\r\n            }\r\n            catch (err) {\r\n                console.warn(`Cannot inline img src=${image.currentSrc}! Error: ${err}`);\r\n            }\r\n            oldValue\r\n                ? (attributes.crossOrigin = oldValue)\r\n                : image.removeAttribute('crossorigin');\r\n        };\r\n        if (image.complete && image.naturalWidth !== 0)\r\n            recordInlineImage();\r\n        else\r\n            image.addEventListener('load', recordInlineImage);\r\n    }\r\n    if (tagName === 'audio' || tagName === 'video') {\r\n        const mediaAttributes = attributes;\r\n        mediaAttributes.rr_mediaState = n.paused\r\n            ? 'paused'\r\n            : 'played';\r\n        mediaAttributes.rr_mediaCurrentTime = n.currentTime;\r\n        mediaAttributes.rr_mediaPlaybackRate = n.playbackRate;\r\n        mediaAttributes.rr_mediaMuted = n.muted;\r\n        mediaAttributes.rr_mediaLoop = n.loop;\r\n        mediaAttributes.rr_mediaVolume = n.volume;\r\n    }\r\n    if (!newlyAddedElement) {\r\n        if (n.scrollLeft) {\r\n            attributes.rr_scrollLeft = n.scrollLeft;\r\n        }\r\n        if (n.scrollTop) {\r\n            attributes.rr_scrollTop = n.scrollTop;\r\n        }\r\n    }\r\n    if (needBlock) {\r\n        const { width, height } = n.getBoundingClientRect();\r\n        attributes = {\r\n            class: attributes.class,\r\n            rr_width: `${width}px`,\r\n            rr_height: `${height}px`,\r\n        };\r\n    }\r\n    if (tagName === 'iframe' && !keepIframeSrcFn(attributes.src)) {\r\n        if (!n.contentDocument) {\r\n            attributes.rr_src = attributes.src;\r\n        }\r\n        delete attributes.src;\r\n    }\r\n    let isCustomElement;\r\n    try {\r\n        if (customElements.get(tagName))\r\n            isCustomElement = true;\r\n    }\r\n    catch (e) {\r\n    }\r\n    return {\r\n        type: NodeType.Element,\r\n        tagName,\r\n        attributes,\r\n        childNodes: [],\r\n        isSVG: isSVGElement(n) || undefined,\r\n        needBlock,\r\n        rootId,\r\n        isCustom: isCustomElement,\r\n    };\r\n}\r\nfunction lowerIfExists(maybeAttr) {\r\n    if (maybeAttr === undefined || maybeAttr === null) {\r\n        return '';\r\n    }\r\n    else {\r\n        return maybeAttr.toLowerCase();\r\n    }\r\n}\r\nfunction slimDOMExcluded(sn, slimDOMOptions) {\r\n    if (slimDOMOptions.comment && sn.type === NodeType.Comment) {\r\n        return true;\r\n    }\r\n    else if (sn.type === NodeType.Element) {\r\n        if (slimDOMOptions.script &&\r\n            (sn.tagName === 'script' ||\r\n                (sn.tagName === 'link' &&\r\n                    (sn.attributes.rel === 'preload' ||\r\n                        sn.attributes.rel === 'modulepreload') &&\r\n                    sn.attributes.as === 'script') ||\r\n                (sn.tagName === 'link' &&\r\n                    sn.attributes.rel === 'prefetch' &&\r\n                    typeof sn.attributes.href === 'string' &&\r\n                    extractFileExtension(sn.attributes.href) === 'js'))) {\r\n            return true;\r\n        }\r\n        else if (slimDOMOptions.headFavicon &&\r\n            ((sn.tagName === 'link' && sn.attributes.rel === 'shortcut icon') ||\r\n                (sn.tagName === 'meta' &&\r\n                    (lowerIfExists(sn.attributes.name).match(/^msapplication-tile(image|color)$/) ||\r\n                        lowerIfExists(sn.attributes.name) === 'application-name' ||\r\n                        lowerIfExists(sn.attributes.rel) === 'icon' ||\r\n                        lowerIfExists(sn.attributes.rel) === 'apple-touch-icon' ||\r\n                        lowerIfExists(sn.attributes.rel) === 'shortcut icon')))) {\r\n            return true;\r\n        }\r\n        else if (sn.tagName === 'meta') {\r\n            if (slimDOMOptions.headMetaDescKeywords &&\r\n                lowerIfExists(sn.attributes.name).match(/^description|keywords$/)) {\r\n                return true;\r\n            }\r\n            else if (slimDOMOptions.headMetaSocial &&\r\n                (lowerIfExists(sn.attributes.property).match(/^(og|twitter|fb):/) ||\r\n                    lowerIfExists(sn.attributes.name).match(/^(og|twitter):/) ||\r\n                    lowerIfExists(sn.attributes.name) === 'pinterest')) {\r\n                return true;\r\n            }\r\n            else if (slimDOMOptions.headMetaRobots &&\r\n                (lowerIfExists(sn.attributes.name) === 'robots' ||\r\n                    lowerIfExists(sn.attributes.name) === 'googlebot' ||\r\n                    lowerIfExists(sn.attributes.name) === 'bingbot')) {\r\n                return true;\r\n            }\r\n            else if (slimDOMOptions.headMetaHttpEquiv &&\r\n                sn.attributes['http-equiv'] !== undefined) {\r\n                return true;\r\n            }\r\n            else if (slimDOMOptions.headMetaAuthorship &&\r\n                (lowerIfExists(sn.attributes.name) === 'author' ||\r\n                    lowerIfExists(sn.attributes.name) === 'generator' ||\r\n                    lowerIfExists(sn.attributes.name) === 'framework' ||\r\n                    lowerIfExists(sn.attributes.name) === 'publisher' ||\r\n                    lowerIfExists(sn.attributes.name) === 'progid' ||\r\n                    lowerIfExists(sn.attributes.property).match(/^article:/) ||\r\n                    lowerIfExists(sn.attributes.property).match(/^product:/))) {\r\n                return true;\r\n            }\r\n            else if (slimDOMOptions.headMetaVerification &&\r\n                (lowerIfExists(sn.attributes.name) === 'google-site-verification' ||\r\n                    lowerIfExists(sn.attributes.name) === 'yandex-verification' ||\r\n                    lowerIfExists(sn.attributes.name) === 'csrf-token' ||\r\n                    lowerIfExists(sn.attributes.name) === 'p:domain_verify' ||\r\n                    lowerIfExists(sn.attributes.name) === 'verify-v1' ||\r\n                    lowerIfExists(sn.attributes.name) === 'verification' ||\r\n                    lowerIfExists(sn.attributes.name) === 'shopify-checkout-api-token')) {\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction serializeNodeWithId(n, options) {\r\n    const { doc, mirror, blockClass, blockSelector, maskTextClass, maskTextSelector, skipChild = false, inlineStylesheet = true, maskInputOptions = {}, maskTextFn, maskInputFn, slimDOMOptions, dataURLOptions = {}, inlineImages = false, recordCanvas = false, onSerialize, onIframeLoad, iframeLoadTimeout = 5000, onStylesheetLoad, stylesheetLoadTimeout = 5000, keepIframeSrcFn = () => false, newlyAddedElement = false, } = options;\r\n    let { needsMask } = options;\r\n    let { preserveWhiteSpace = true } = options;\r\n    if (!needsMask &&\r\n        n.childNodes) {\r\n        const checkAncestors = needsMask === undefined;\r\n        needsMask = needMaskingText(n, maskTextClass, maskTextSelector, checkAncestors);\r\n    }\r\n    const _serializedNode = serializeNode(n, {\r\n        doc,\r\n        mirror,\r\n        blockClass,\r\n        blockSelector,\r\n        needsMask,\r\n        inlineStylesheet,\r\n        maskInputOptions,\r\n        maskTextFn,\r\n        maskInputFn,\r\n        dataURLOptions,\r\n        inlineImages,\r\n        recordCanvas,\r\n        keepIframeSrcFn,\r\n        newlyAddedElement,\r\n    });\r\n    if (!_serializedNode) {\r\n        console.warn(n, 'not serialized');\r\n        return null;\r\n    }\r\n    let id;\r\n    if (mirror.hasNode(n)) {\r\n        id = mirror.getId(n);\r\n    }\r\n    else if (slimDOMExcluded(_serializedNode, slimDOMOptions) ||\r\n        (!preserveWhiteSpace &&\r\n            _serializedNode.type === NodeType.Text &&\r\n            !_serializedNode.isStyle &&\r\n            !_serializedNode.textContent.replace(/^\\s+|\\s+$/gm, '').length)) {\r\n        id = IGNORED_NODE;\r\n    }\r\n    else {\r\n        id = genId();\r\n    }\r\n    const serializedNode = Object.assign(_serializedNode, { id });\r\n    mirror.add(n, serializedNode);\r\n    if (id === IGNORED_NODE) {\r\n        return null;\r\n    }\r\n    if (onSerialize) {\r\n        onSerialize(n);\r\n    }\r\n    let recordChild = !skipChild;\r\n    if (serializedNode.type === NodeType.Element) {\r\n        recordChild = recordChild && !serializedNode.needBlock;\r\n        delete serializedNode.needBlock;\r\n        const shadowRoot = n.shadowRoot;\r\n        if (shadowRoot && isNativeShadowDom(shadowRoot))\r\n            serializedNode.isShadowHost = true;\r\n    }\r\n    if ((serializedNode.type === NodeType.Document ||\r\n        serializedNode.type === NodeType.Element) &&\r\n        recordChild) {\r\n        if (slimDOMOptions.headWhitespace &&\r\n            serializedNode.type === NodeType.Element &&\r\n            serializedNode.tagName === 'head') {\r\n            preserveWhiteSpace = false;\r\n        }\r\n        const bypassOptions = {\r\n            doc,\r\n            mirror,\r\n            blockClass,\r\n            blockSelector,\r\n            needsMask,\r\n            maskTextClass,\r\n            maskTextSelector,\r\n            skipChild,\r\n            inlineStylesheet,\r\n            maskInputOptions,\r\n            maskTextFn,\r\n            maskInputFn,\r\n            slimDOMOptions,\r\n            dataURLOptions,\r\n            inlineImages,\r\n            recordCanvas,\r\n            preserveWhiteSpace,\r\n            onSerialize,\r\n            onIframeLoad,\r\n            iframeLoadTimeout,\r\n            onStylesheetLoad,\r\n            stylesheetLoadTimeout,\r\n            keepIframeSrcFn,\r\n        };\r\n        if (serializedNode.type === NodeType.Element &&\r\n            serializedNode.tagName === 'textarea' &&\r\n            serializedNode.attributes.value !== undefined) ;\r\n        else {\r\n            for (const childN of Array.from(n.childNodes)) {\r\n                const serializedChildNode = serializeNodeWithId(childN, bypassOptions);\r\n                if (serializedChildNode) {\r\n                    serializedNode.childNodes.push(serializedChildNode);\r\n                }\r\n            }\r\n        }\r\n        if (isElement(n) && n.shadowRoot) {\r\n            for (const childN of Array.from(n.shadowRoot.childNodes)) {\r\n                const serializedChildNode = serializeNodeWithId(childN, bypassOptions);\r\n                if (serializedChildNode) {\r\n                    isNativeShadowDom(n.shadowRoot) &&\r\n                        (serializedChildNode.isShadow = true);\r\n                    serializedNode.childNodes.push(serializedChildNode);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    if (n.parentNode &&\r\n        isShadowRoot(n.parentNode) &&\r\n        isNativeShadowDom(n.parentNode)) {\r\n        serializedNode.isShadow = true;\r\n    }\r\n    if (serializedNode.type === NodeType.Element &&\r\n        serializedNode.tagName === 'iframe') {\r\n        onceIframeLoaded(n, () => {\r\n            const iframeDoc = n.contentDocument;\r\n            if (iframeDoc && onIframeLoad) {\r\n                const serializedIframeNode = serializeNodeWithId(iframeDoc, {\r\n                    doc: iframeDoc,\r\n                    mirror,\r\n                    blockClass,\r\n                    blockSelector,\r\n                    needsMask,\r\n                    maskTextClass,\r\n                    maskTextSelector,\r\n                    skipChild: false,\r\n                    inlineStylesheet,\r\n                    maskInputOptions,\r\n                    maskTextFn,\r\n                    maskInputFn,\r\n                    slimDOMOptions,\r\n                    dataURLOptions,\r\n                    inlineImages,\r\n                    recordCanvas,\r\n                    preserveWhiteSpace,\r\n                    onSerialize,\r\n                    onIframeLoad,\r\n                    iframeLoadTimeout,\r\n                    onStylesheetLoad,\r\n                    stylesheetLoadTimeout,\r\n                    keepIframeSrcFn,\r\n                });\r\n                if (serializedIframeNode) {\r\n                    onIframeLoad(n, serializedIframeNode);\r\n                }\r\n            }\r\n        }, iframeLoadTimeout);\r\n    }\r\n    if (serializedNode.type === NodeType.Element &&\r\n        serializedNode.tagName === 'link' &&\r\n        typeof serializedNode.attributes.rel === 'string' &&\r\n        (serializedNode.attributes.rel === 'stylesheet' ||\r\n            (serializedNode.attributes.rel === 'preload' &&\r\n                typeof serializedNode.attributes.href === 'string' &&\r\n                extractFileExtension(serializedNode.attributes.href) === 'css'))) {\r\n        onceStylesheetLoaded(n, () => {\r\n            if (onStylesheetLoad) {\r\n                const serializedLinkNode = serializeNodeWithId(n, {\r\n                    doc,\r\n                    mirror,\r\n                    blockClass,\r\n                    blockSelector,\r\n                    needsMask,\r\n                    maskTextClass,\r\n                    maskTextSelector,\r\n                    skipChild: false,\r\n                    inlineStylesheet,\r\n                    maskInputOptions,\r\n                    maskTextFn,\r\n                    maskInputFn,\r\n                    slimDOMOptions,\r\n                    dataURLOptions,\r\n                    inlineImages,\r\n                    recordCanvas,\r\n                    preserveWhiteSpace,\r\n                    onSerialize,\r\n                    onIframeLoad,\r\n                    iframeLoadTimeout,\r\n                    onStylesheetLoad,\r\n                    stylesheetLoadTimeout,\r\n                    keepIframeSrcFn,\r\n                });\r\n                if (serializedLinkNode) {\r\n                    onStylesheetLoad(n, serializedLinkNode);\r\n                }\r\n            }\r\n        }, stylesheetLoadTimeout);\r\n    }\r\n    return serializedNode;\r\n}\r\nfunction snapshot(n, options) {\r\n    const { mirror = new Mirror(), blockClass = 'rr-block', blockSelector = null, maskTextClass = 'rr-mask', maskTextSelector = null, inlineStylesheet = true, inlineImages = false, recordCanvas = false, maskAllInputs = false, maskTextFn, maskInputFn, slimDOM = false, dataURLOptions, preserveWhiteSpace, onSerialize, onIframeLoad, iframeLoadTimeout, onStylesheetLoad, stylesheetLoadTimeout, keepIframeSrcFn = () => false, } = options || {};\r\n    const maskInputOptions = maskAllInputs === true\r\n        ? {\r\n            color: true,\r\n            date: true,\r\n            'datetime-local': true,\r\n            email: true,\r\n            month: true,\r\n            number: true,\r\n            range: true,\r\n            search: true,\r\n            tel: true,\r\n            text: true,\r\n            time: true,\r\n            url: true,\r\n            week: true,\r\n            textarea: true,\r\n            select: true,\r\n            password: true,\r\n        }\r\n        : maskAllInputs === false\r\n            ? {\r\n                password: true,\r\n            }\r\n            : maskAllInputs;\r\n    const slimDOMOptions = slimDOM === true || slimDOM === 'all'\r\n        ?\r\n            {\r\n                script: true,\r\n                comment: true,\r\n                headFavicon: true,\r\n                headWhitespace: true,\r\n                headMetaDescKeywords: slimDOM === 'all',\r\n                headMetaSocial: true,\r\n                headMetaRobots: true,\r\n                headMetaHttpEquiv: true,\r\n                headMetaAuthorship: true,\r\n                headMetaVerification: true,\r\n            }\r\n        : slimDOM === false\r\n            ? {}\r\n            : slimDOM;\r\n    return serializeNodeWithId(n, {\r\n        doc: n,\r\n        mirror,\r\n        blockClass,\r\n        blockSelector,\r\n        maskTextClass,\r\n        maskTextSelector,\r\n        skipChild: false,\r\n        inlineStylesheet,\r\n        maskInputOptions,\r\n        maskTextFn,\r\n        maskInputFn,\r\n        slimDOMOptions,\r\n        dataURLOptions,\r\n        inlineImages,\r\n        recordCanvas,\r\n        preserveWhiteSpace,\r\n        onSerialize,\r\n        onIframeLoad,\r\n        iframeLoadTimeout,\r\n        onStylesheetLoad,\r\n        stylesheetLoadTimeout,\r\n        keepIframeSrcFn,\r\n        newlyAddedElement: false,\r\n    });\r\n}\r\n\nconst commentre = /\\/\\*[^*]*\\*+([^/*][^*]*\\*+)*\\//g;\r\nfunction parse(css, options = {}) {\r\n    let lineno = 1;\r\n    let column = 1;\r\n    function updatePosition(str) {\r\n        const lines = str.match(/\\n/g);\r\n        if (lines) {\r\n            lineno += lines.length;\r\n        }\r\n        const i = str.lastIndexOf('\\n');\r\n        column = i === -1 ? column + str.length : str.length - i;\r\n    }\r\n    function position() {\r\n        const start = { line: lineno, column };\r\n        return (node) => {\r\n            node.position = new Position(start);\r\n            whitespace();\r\n            return node;\r\n        };\r\n    }\r\n    class Position {\r\n        constructor(start) {\r\n            this.start = start;\r\n            this.end = { line: lineno, column };\r\n            this.source = options.source;\r\n        }\r\n    }\r\n    Position.prototype.content = css;\r\n    const errorsList = [];\r\n    function error(msg) {\r\n        const err = new Error(`${options.source || ''}:${lineno}:${column}: ${msg}`);\r\n        err.reason = msg;\r\n        err.filename = options.source;\r\n        err.line = lineno;\r\n        err.column = column;\r\n        err.source = css;\r\n        if (options.silent) {\r\n            errorsList.push(err);\r\n        }\r\n        else {\r\n            throw err;\r\n        }\r\n    }\r\n    function stylesheet() {\r\n        const rulesList = rules();\r\n        return {\r\n            type: 'stylesheet',\r\n            stylesheet: {\r\n                source: options.source,\r\n                rules: rulesList,\r\n                parsingErrors: errorsList,\r\n            },\r\n        };\r\n    }\r\n    function open() {\r\n        return match(/^{\\s*/);\r\n    }\r\n    function close() {\r\n        return match(/^}/);\r\n    }\r\n    function rules() {\r\n        let node;\r\n        const rules = [];\r\n        whitespace();\r\n        comments(rules);\r\n        while (css.length && css.charAt(0) !== '}' && (node = atrule() || rule())) {\r\n            if (node) {\r\n                rules.push(node);\r\n                comments(rules);\r\n            }\r\n        }\r\n        return rules;\r\n    }\r\n    function match(re) {\r\n        const m = re.exec(css);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        const str = m[0];\r\n        updatePosition(str);\r\n        css = css.slice(str.length);\r\n        return m;\r\n    }\r\n    function whitespace() {\r\n        match(/^\\s*/);\r\n    }\r\n    function comments(rules = []) {\r\n        let c;\r\n        while ((c = comment())) {\r\n            if (c) {\r\n                rules.push(c);\r\n            }\r\n            c = comment();\r\n        }\r\n        return rules;\r\n    }\r\n    function comment() {\r\n        const pos = position();\r\n        if ('/' !== css.charAt(0) || '*' !== css.charAt(1)) {\r\n            return;\r\n        }\r\n        let i = 2;\r\n        while ('' !== css.charAt(i) &&\r\n            ('*' !== css.charAt(i) || '/' !== css.charAt(i + 1))) {\r\n            ++i;\r\n        }\r\n        i += 2;\r\n        if ('' === css.charAt(i - 1)) {\r\n            return error('End of comment missing');\r\n        }\r\n        const str = css.slice(2, i - 2);\r\n        column += 2;\r\n        updatePosition(str);\r\n        css = css.slice(i);\r\n        column += 2;\r\n        return pos({\r\n            type: 'comment',\r\n            comment: str,\r\n        });\r\n    }\r\n    function selector() {\r\n        whitespace();\r\n        while (css[0] == '}') {\r\n            error('extra closing bracket');\r\n            css = css.slice(1);\r\n            whitespace();\r\n        }\r\n        const m = match(/^((\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'|[^{])+)/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        const cleanedInput = m[0]\r\n            .trim()\r\n            .replace(/\\/\\*([^*]|[\\r\\n]|(\\*+([^*/]|[\\r\\n])))*\\*\\/+/g, '')\r\n            .replace(/\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'/g, (m) => {\r\n            return m.replace(/,/g, '\\u200C');\r\n        });\r\n        return customSplit(cleanedInput).map((s) => s.replace(/\\u200C/g, ',').trim());\r\n    }\r\n    function customSplit(input) {\r\n        const result = [];\r\n        let currentSegment = '';\r\n        let depthParentheses = 0;\r\n        let depthBrackets = 0;\r\n        for (const char of input) {\r\n            if (char === '(') {\r\n                depthParentheses++;\r\n            }\r\n            else if (char === ')') {\r\n                depthParentheses--;\r\n            }\r\n            else if (char === '[') {\r\n                depthBrackets++;\r\n            }\r\n            else if (char === ']') {\r\n                depthBrackets--;\r\n            }\r\n            if (char === ',' && depthParentheses === 0 && depthBrackets === 0) {\r\n                result.push(currentSegment);\r\n                currentSegment = '';\r\n            }\r\n            else {\r\n                currentSegment += char;\r\n            }\r\n        }\r\n        if (currentSegment) {\r\n            result.push(currentSegment);\r\n        }\r\n        return result;\r\n    }\r\n    function declaration() {\r\n        const pos = position();\r\n        const propMatch = match(/^(\\*?[-#\\/\\*\\\\\\w]+(\\[[0-9a-z_-]+\\])?)\\s*/);\r\n        if (!propMatch) {\r\n            return;\r\n        }\r\n        const prop = trim(propMatch[0]);\r\n        if (!match(/^:\\s*/)) {\r\n            return error(`property missing ':'`);\r\n        }\r\n        const val = match(/^((?:'(?:\\\\'|.)*?'|\"(?:\\\\\"|.)*?\"|\\([^\\)]*?\\)|[^};])+)/);\r\n        const ret = pos({\r\n            type: 'declaration',\r\n            property: prop.replace(commentre, ''),\r\n            value: val ? trim(val[0]).replace(commentre, '') : '',\r\n        });\r\n        match(/^[;\\s]*/);\r\n        return ret;\r\n    }\r\n    function declarations() {\r\n        const decls = [];\r\n        if (!open()) {\r\n            return error(`missing '{'`);\r\n        }\r\n        comments(decls);\r\n        let decl;\r\n        while ((decl = declaration())) {\r\n            if (decl !== false) {\r\n                decls.push(decl);\r\n                comments(decls);\r\n            }\r\n            decl = declaration();\r\n        }\r\n        if (!close()) {\r\n            return error(`missing '}'`);\r\n        }\r\n        return decls;\r\n    }\r\n    function keyframe() {\r\n        let m;\r\n        const vals = [];\r\n        const pos = position();\r\n        while ((m = match(/^((\\d+\\.\\d+|\\.\\d+|\\d+)%?|[a-z]+)\\s*/))) {\r\n            vals.push(m[1]);\r\n            match(/^,\\s*/);\r\n        }\r\n        if (!vals.length) {\r\n            return;\r\n        }\r\n        return pos({\r\n            type: 'keyframe',\r\n            values: vals,\r\n            declarations: declarations(),\r\n        });\r\n    }\r\n    function atkeyframes() {\r\n        const pos = position();\r\n        let m = match(/^@([-\\w]+)?keyframes\\s*/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        const vendor = m[1];\r\n        m = match(/^([-\\w]+)\\s*/);\r\n        if (!m) {\r\n            return error('@keyframes missing name');\r\n        }\r\n        const name = m[1];\r\n        if (!open()) {\r\n            return error(`@keyframes missing '{'`);\r\n        }\r\n        let frame;\r\n        let frames = comments();\r\n        while ((frame = keyframe())) {\r\n            frames.push(frame);\r\n            frames = frames.concat(comments());\r\n        }\r\n        if (!close()) {\r\n            return error(`@keyframes missing '}'`);\r\n        }\r\n        return pos({\r\n            type: 'keyframes',\r\n            name,\r\n            vendor,\r\n            keyframes: frames,\r\n        });\r\n    }\r\n    function atsupports() {\r\n        const pos = position();\r\n        const m = match(/^@supports *([^{]+)/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        const supports = trim(m[1]);\r\n        if (!open()) {\r\n            return error(`@supports missing '{'`);\r\n        }\r\n        const style = comments().concat(rules());\r\n        if (!close()) {\r\n            return error(`@supports missing '}'`);\r\n        }\r\n        return pos({\r\n            type: 'supports',\r\n            supports,\r\n            rules: style,\r\n        });\r\n    }\r\n    function athost() {\r\n        const pos = position();\r\n        const m = match(/^@host\\s*/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        if (!open()) {\r\n            return error(`@host missing '{'`);\r\n        }\r\n        const style = comments().concat(rules());\r\n        if (!close()) {\r\n            return error(`@host missing '}'`);\r\n        }\r\n        return pos({\r\n            type: 'host',\r\n            rules: style,\r\n        });\r\n    }\r\n    function atmedia() {\r\n        const pos = position();\r\n        const m = match(/^@media *([^{]+)/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        const media = trim(m[1]);\r\n        if (!open()) {\r\n            return error(`@media missing '{'`);\r\n        }\r\n        const style = comments().concat(rules());\r\n        if (!close()) {\r\n            return error(`@media missing '}'`);\r\n        }\r\n        return pos({\r\n            type: 'media',\r\n            media,\r\n            rules: style,\r\n        });\r\n    }\r\n    function atcustommedia() {\r\n        const pos = position();\r\n        const m = match(/^@custom-media\\s+(--[^\\s]+)\\s*([^{;]+);/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        return pos({\r\n            type: 'custom-media',\r\n            name: trim(m[1]),\r\n            media: trim(m[2]),\r\n        });\r\n    }\r\n    function atpage() {\r\n        const pos = position();\r\n        const m = match(/^@page */);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        const sel = selector() || [];\r\n        if (!open()) {\r\n            return error(`@page missing '{'`);\r\n        }\r\n        let decls = comments();\r\n        let decl;\r\n        while ((decl = declaration())) {\r\n            decls.push(decl);\r\n            decls = decls.concat(comments());\r\n        }\r\n        if (!close()) {\r\n            return error(`@page missing '}'`);\r\n        }\r\n        return pos({\r\n            type: 'page',\r\n            selectors: sel,\r\n            declarations: decls,\r\n        });\r\n    }\r\n    function atdocument() {\r\n        const pos = position();\r\n        const m = match(/^@([-\\w]+)?document *([^{]+)/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        const vendor = trim(m[1]);\r\n        const doc = trim(m[2]);\r\n        if (!open()) {\r\n            return error(`@document missing '{'`);\r\n        }\r\n        const style = comments().concat(rules());\r\n        if (!close()) {\r\n            return error(`@document missing '}'`);\r\n        }\r\n        return pos({\r\n            type: 'document',\r\n            document: doc,\r\n            vendor,\r\n            rules: style,\r\n        });\r\n    }\r\n    function atfontface() {\r\n        const pos = position();\r\n        const m = match(/^@font-face\\s*/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        if (!open()) {\r\n            return error(`@font-face missing '{'`);\r\n        }\r\n        let decls = comments();\r\n        let decl;\r\n        while ((decl = declaration())) {\r\n            decls.push(decl);\r\n            decls = decls.concat(comments());\r\n        }\r\n        if (!close()) {\r\n            return error(`@font-face missing '}'`);\r\n        }\r\n        return pos({\r\n            type: 'font-face',\r\n            declarations: decls,\r\n        });\r\n    }\r\n    const atimport = _compileAtrule('import');\r\n    const atcharset = _compileAtrule('charset');\r\n    const atnamespace = _compileAtrule('namespace');\r\n    function _compileAtrule(name) {\r\n        const re = new RegExp('^@' + name + '\\\\s*([^;]+);');\r\n        return () => {\r\n            const pos = position();\r\n            const m = match(re);\r\n            if (!m) {\r\n                return;\r\n            }\r\n            const ret = { type: name };\r\n            ret[name] = m[1].trim();\r\n            return pos(ret);\r\n        };\r\n    }\r\n    function atrule() {\r\n        if (css[0] !== '@') {\r\n            return;\r\n        }\r\n        return (atkeyframes() ||\r\n            atmedia() ||\r\n            atcustommedia() ||\r\n            atsupports() ||\r\n            atimport() ||\r\n            atcharset() ||\r\n            atnamespace() ||\r\n            atdocument() ||\r\n            atpage() ||\r\n            athost() ||\r\n            atfontface());\r\n    }\r\n    function rule() {\r\n        const pos = position();\r\n        const sel = selector();\r\n        if (!sel) {\r\n            return error('selector missing');\r\n        }\r\n        comments();\r\n        return pos({\r\n            type: 'rule',\r\n            selectors: sel,\r\n            declarations: declarations(),\r\n        });\r\n    }\r\n    return addParent(stylesheet());\r\n}\r\nfunction trim(str) {\r\n    return str ? str.replace(/^\\s+|\\s+$/g, '') : '';\r\n}\r\nfunction addParent(obj, parent) {\r\n    const isNode = obj && typeof obj.type === 'string';\r\n    const childParent = isNode ? obj : parent;\r\n    for (const k of Object.keys(obj)) {\r\n        const value = obj[k];\r\n        if (Array.isArray(value)) {\r\n            value.forEach((v) => {\r\n                addParent(v, childParent);\r\n            });\r\n        }\r\n        else if (value && typeof value === 'object') {\r\n            addParent(value, childParent);\r\n        }\r\n    }\r\n    if (isNode) {\r\n        Object.defineProperty(obj, 'parent', {\r\n            configurable: true,\r\n            writable: true,\r\n            enumerable: false,\r\n            value: parent || null,\r\n        });\r\n    }\r\n    return obj;\r\n}\n\nconst tagMap = {\r\n    script: 'noscript',\r\n    altglyph: 'altGlyph',\r\n    altglyphdef: 'altGlyphDef',\r\n    altglyphitem: 'altGlyphItem',\r\n    animatecolor: 'animateColor',\r\n    animatemotion: 'animateMotion',\r\n    animatetransform: 'animateTransform',\r\n    clippath: 'clipPath',\r\n    feblend: 'feBlend',\r\n    fecolormatrix: 'feColorMatrix',\r\n    fecomponenttransfer: 'feComponentTransfer',\r\n    fecomposite: 'feComposite',\r\n    feconvolvematrix: 'feConvolveMatrix',\r\n    fediffuselighting: 'feDiffuseLighting',\r\n    fedisplacementmap: 'feDisplacementMap',\r\n    fedistantlight: 'feDistantLight',\r\n    fedropshadow: 'feDropShadow',\r\n    feflood: 'feFlood',\r\n    fefunca: 'feFuncA',\r\n    fefuncb: 'feFuncB',\r\n    fefuncg: 'feFuncG',\r\n    fefuncr: 'feFuncR',\r\n    fegaussianblur: 'feGaussianBlur',\r\n    feimage: 'feImage',\r\n    femerge: 'feMerge',\r\n    femergenode: 'feMergeNode',\r\n    femorphology: 'feMorphology',\r\n    feoffset: 'feOffset',\r\n    fepointlight: 'fePointLight',\r\n    fespecularlighting: 'feSpecularLighting',\r\n    fespotlight: 'feSpotLight',\r\n    fetile: 'feTile',\r\n    feturbulence: 'feTurbulence',\r\n    foreignobject: 'foreignObject',\r\n    glyphref: 'glyphRef',\r\n    lineargradient: 'linearGradient',\r\n    radialgradient: 'radialGradient',\r\n};\r\nfunction getTagName(n) {\r\n    let tagName = tagMap[n.tagName] ? tagMap[n.tagName] : n.tagName;\r\n    if (tagName === 'link' && n.attributes._cssText) {\r\n        tagName = 'style';\r\n    }\r\n    return tagName;\r\n}\r\nfunction escapeRegExp(str) {\r\n    return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n}\r\nconst MEDIA_SELECTOR = /(max|min)-device-(width|height)/;\r\nconst MEDIA_SELECTOR_GLOBAL = new RegExp(MEDIA_SELECTOR.source, 'g');\r\nconst HOVER_SELECTOR = /([^\\\\]):hover/;\r\nconst HOVER_SELECTOR_GLOBAL = new RegExp(HOVER_SELECTOR.source, 'g');\r\nfunction adaptCssForReplay(cssText, cache) {\r\n    const cachedStyle = cache === null || cache === void 0 ? void 0 : cache.stylesWithHoverClass.get(cssText);\r\n    if (cachedStyle)\r\n        return cachedStyle;\r\n    const ast = parse(cssText, {\r\n        silent: true,\r\n    });\r\n    if (!ast.stylesheet) {\r\n        return cssText;\r\n    }\r\n    const selectors = [];\r\n    const medias = [];\r\n    function getSelectors(rule) {\r\n        if ('selectors' in rule && rule.selectors) {\r\n            rule.selectors.forEach((selector) => {\r\n                if (HOVER_SELECTOR.test(selector)) {\r\n                    selectors.push(selector);\r\n                }\r\n            });\r\n        }\r\n        if ('media' in rule && rule.media && MEDIA_SELECTOR.test(rule.media)) {\r\n            medias.push(rule.media);\r\n        }\r\n        if ('rules' in rule && rule.rules) {\r\n            rule.rules.forEach(getSelectors);\r\n        }\r\n    }\r\n    getSelectors(ast.stylesheet);\r\n    let result = cssText;\r\n    if (selectors.length > 0) {\r\n        const selectorMatcher = new RegExp(selectors\r\n            .filter((selector, index) => selectors.indexOf(selector) === index)\r\n            .sort((a, b) => b.length - a.length)\r\n            .map((selector) => {\r\n            return escapeRegExp(selector);\r\n        })\r\n            .join('|'), 'g');\r\n        result = result.replace(selectorMatcher, (selector) => {\r\n            const newSelector = selector.replace(HOVER_SELECTOR_GLOBAL, '$1.\\\\:hover');\r\n            return `${selector}, ${newSelector}`;\r\n        });\r\n    }\r\n    if (medias.length > 0) {\r\n        const mediaMatcher = new RegExp(medias\r\n            .filter((media, index) => medias.indexOf(media) === index)\r\n            .sort((a, b) => b.length - a.length)\r\n            .map((media) => {\r\n            return escapeRegExp(media);\r\n        })\r\n            .join('|'), 'g');\r\n        result = result.replace(mediaMatcher, (media) => {\r\n            return media.replace(MEDIA_SELECTOR_GLOBAL, '$1-$2');\r\n        });\r\n    }\r\n    cache === null || cache === void 0 ? void 0 : cache.stylesWithHoverClass.set(cssText, result);\r\n    return result;\r\n}\r\nfunction createCache() {\r\n    const stylesWithHoverClass = new Map();\r\n    return {\r\n        stylesWithHoverClass,\r\n    };\r\n}\r\nfunction buildNode(n, options) {\r\n    var _a;\r\n    const { doc, hackCss, cache } = options;\r\n    switch (n.type) {\r\n        case NodeType.Document:\r\n            return doc.implementation.createDocument(null, '', null);\r\n        case NodeType.DocumentType:\r\n            return doc.implementation.createDocumentType(n.name || 'html', n.publicId, n.systemId);\r\n        case NodeType.Element: {\r\n            const tagName = getTagName(n);\r\n            let node;\r\n            if (n.isSVG) {\r\n                node = doc.createElementNS('http://www.w3.org/2000/svg', tagName);\r\n            }\r\n            else {\r\n                if (n.isCustom &&\r\n                    ((_a = doc.defaultView) === null || _a === void 0 ? void 0 : _a.customElements) &&\r\n                    !doc.defaultView.customElements.get(n.tagName))\r\n                    doc.defaultView.customElements.define(n.tagName, class extends doc.defaultView.HTMLElement {\r\n                    });\r\n                node = doc.createElement(tagName);\r\n            }\r\n            const specialAttributes = {};\r\n            for (const name in n.attributes) {\r\n                if (!Object.prototype.hasOwnProperty.call(n.attributes, name)) {\r\n                    continue;\r\n                }\r\n                let value = n.attributes[name];\r\n                if (tagName === 'option' &&\r\n                    name === 'selected' &&\r\n                    value === false) {\r\n                    continue;\r\n                }\r\n                if (value === null) {\r\n                    continue;\r\n                }\r\n                if (value === true)\r\n                    value = '';\r\n                if (name.startsWith('rr_')) {\r\n                    specialAttributes[name] = value;\r\n                    continue;\r\n                }\r\n                const isTextarea = tagName === 'textarea' && name === 'value';\r\n                const isRemoteOrDynamicCss = tagName === 'style' && name === '_cssText';\r\n                if (isRemoteOrDynamicCss && hackCss && typeof value === 'string') {\r\n                    value = adaptCssForReplay(value, cache);\r\n                }\r\n                if ((isTextarea || isRemoteOrDynamicCss) && typeof value === 'string') {\r\n                    node.appendChild(doc.createTextNode(value));\r\n                    n.childNodes = [];\r\n                    continue;\r\n                }\r\n                try {\r\n                    if (n.isSVG && name === 'xlink:href') {\r\n                        node.setAttributeNS('http://www.w3.org/1999/xlink', name, value.toString());\r\n                    }\r\n                    else if (name === 'onload' ||\r\n                        name === 'onclick' ||\r\n                        name.substring(0, 7) === 'onmouse') {\r\n                        node.setAttribute('_' + name, value.toString());\r\n                    }\r\n                    else if (tagName === 'meta' &&\r\n                        n.attributes['http-equiv'] === 'Content-Security-Policy' &&\r\n                        name === 'content') {\r\n                        node.setAttribute('csp-content', value.toString());\r\n                        continue;\r\n                    }\r\n                    else if (tagName === 'link' &&\r\n                        (n.attributes.rel === 'preload' ||\r\n                            n.attributes.rel === 'modulepreload') &&\r\n                        n.attributes.as === 'script') {\r\n                    }\r\n                    else if (tagName === 'link' &&\r\n                        n.attributes.rel === 'prefetch' &&\r\n                        typeof n.attributes.href === 'string' &&\r\n                        n.attributes.href.endsWith('.js')) {\r\n                    }\r\n                    else if (tagName === 'img' &&\r\n                        n.attributes.srcset &&\r\n                        n.attributes.rr_dataURL) {\r\n                        node.setAttribute('rrweb-original-srcset', n.attributes.srcset);\r\n                    }\r\n                    else {\r\n                        node.setAttribute(name, value.toString());\r\n                    }\r\n                }\r\n                catch (error) {\r\n                }\r\n            }\r\n            for (const name in specialAttributes) {\r\n                const value = specialAttributes[name];\r\n                if (tagName === 'canvas' && name === 'rr_dataURL') {\r\n                    const image = document.createElement('img');\r\n                    image.onload = () => {\r\n                        const ctx = node.getContext('2d');\r\n                        if (ctx) {\r\n                            ctx.drawImage(image, 0, 0, image.width, image.height);\r\n                        }\r\n                    };\r\n                    image.src = value.toString();\r\n                    if (node.RRNodeType)\r\n                        node.rr_dataURL = value.toString();\r\n                }\r\n                else if (tagName === 'img' && name === 'rr_dataURL') {\r\n                    const image = node;\r\n                    if (!image.currentSrc.startsWith('data:')) {\r\n                        image.setAttribute('rrweb-original-src', n.attributes.src);\r\n                        image.src = value.toString();\r\n                    }\r\n                }\r\n                if (name === 'rr_width') {\r\n                    node.style.width = value.toString();\r\n                }\r\n                else if (name === 'rr_height') {\r\n                    node.style.height = value.toString();\r\n                }\r\n                else if (name === 'rr_mediaCurrentTime' &&\r\n                    typeof value === 'number') {\r\n                    node.currentTime = value;\r\n                }\r\n                else if (name === 'rr_mediaState') {\r\n                    switch (value) {\r\n                        case 'played':\r\n                            node\r\n                                .play()\r\n                                .catch((e) => console.warn('media playback error', e));\r\n                            break;\r\n                        case 'paused':\r\n                            node.pause();\r\n                            break;\r\n                    }\r\n                }\r\n                else if (name === 'rr_mediaPlaybackRate' &&\r\n                    typeof value === 'number') {\r\n                    node.playbackRate = value;\r\n                }\r\n                else if (name === 'rr_mediaMuted' && typeof value === 'boolean') {\r\n                    node.muted = value;\r\n                }\r\n                else if (name === 'rr_mediaLoop' && typeof value === 'boolean') {\r\n                    node.loop = value;\r\n                }\r\n                else if (name === 'rr_mediaVolume' && typeof value === 'number') {\r\n                    node.volume = value;\r\n                }\r\n            }\r\n            if (n.isShadowHost) {\r\n                if (!node.shadowRoot) {\r\n                    node.attachShadow({ mode: 'open' });\r\n                }\r\n                else {\r\n                    while (node.shadowRoot.firstChild) {\r\n                        node.shadowRoot.removeChild(node.shadowRoot.firstChild);\r\n                    }\r\n                }\r\n            }\r\n            return node;\r\n        }\r\n        case NodeType.Text:\r\n            return doc.createTextNode(n.isStyle && hackCss\r\n                ? adaptCssForReplay(n.textContent, cache)\r\n                : n.textContent);\r\n        case NodeType.CDATA:\r\n            return doc.createCDATASection(n.textContent);\r\n        case NodeType.Comment:\r\n            return doc.createComment(n.textContent);\r\n        default:\r\n            return null;\r\n    }\r\n}\r\nfunction buildNodeWithSN(n, options) {\r\n    const { doc, mirror, skipChild = false, hackCss = true, afterAppend, cache, } = options;\r\n    if (mirror.has(n.id)) {\r\n        const nodeInMirror = mirror.getNode(n.id);\r\n        const meta = mirror.getMeta(nodeInMirror);\r\n        if (isNodeMetaEqual(meta, n))\r\n            return mirror.getNode(n.id);\r\n    }\r\n    let node = buildNode(n, { doc, hackCss, cache });\r\n    if (!node) {\r\n        return null;\r\n    }\r\n    if (n.rootId && mirror.getNode(n.rootId) !== doc) {\r\n        mirror.replace(n.rootId, doc);\r\n    }\r\n    if (n.type === NodeType.Document) {\r\n        doc.close();\r\n        doc.open();\r\n        if (n.compatMode === 'BackCompat' &&\r\n            n.childNodes &&\r\n            n.childNodes[0].type !== NodeType.DocumentType) {\r\n            if (n.childNodes[0].type === NodeType.Element &&\r\n                'xmlns' in n.childNodes[0].attributes &&\r\n                n.childNodes[0].attributes.xmlns === 'http://www.w3.org/1999/xhtml') {\r\n                doc.write('<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"\">');\r\n            }\r\n            else {\r\n                doc.write('<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.0 Transitional//EN\" \"\">');\r\n            }\r\n        }\r\n        node = doc;\r\n    }\r\n    mirror.add(node, n);\r\n    if ((n.type === NodeType.Document || n.type === NodeType.Element) &&\r\n        !skipChild) {\r\n        for (const childN of n.childNodes) {\r\n            const childNode = buildNodeWithSN(childN, {\r\n                doc,\r\n                mirror,\r\n                skipChild: false,\r\n                hackCss,\r\n                afterAppend,\r\n                cache,\r\n            });\r\n            if (!childNode) {\r\n                console.warn('Failed to rebuild', childN);\r\n                continue;\r\n            }\r\n            if (childN.isShadow && isElement(node) && node.shadowRoot) {\r\n                node.shadowRoot.appendChild(childNode);\r\n            }\r\n            else if (n.type === NodeType.Document &&\r\n                childN.type == NodeType.Element) {\r\n                const htmlElement = childNode;\r\n                let body = null;\r\n                htmlElement.childNodes.forEach((child) => {\r\n                    if (child.nodeName === 'BODY')\r\n                        body = child;\r\n                });\r\n                if (body) {\r\n                    htmlElement.removeChild(body);\r\n                    node.appendChild(childNode);\r\n                    htmlElement.appendChild(body);\r\n                }\r\n                else {\r\n                    node.appendChild(childNode);\r\n                }\r\n            }\r\n            else {\r\n                node.appendChild(childNode);\r\n            }\r\n            if (afterAppend) {\r\n                afterAppend(childNode, childN.id);\r\n            }\r\n        }\r\n    }\r\n    return node;\r\n}\r\nfunction visit(mirror, onVisit) {\r\n    function walk(node) {\r\n        onVisit(node);\r\n    }\r\n    for (const id of mirror.getIds()) {\r\n        if (mirror.has(id)) {\r\n            walk(mirror.getNode(id));\r\n        }\r\n    }\r\n}\r\nfunction handleScroll(node, mirror) {\r\n    const n = mirror.getMeta(node);\r\n    if ((n === null || n === void 0 ? void 0 : n.type) !== NodeType.Element) {\r\n        return;\r\n    }\r\n    const el = node;\r\n    for (const name in n.attributes) {\r\n        if (!(Object.prototype.hasOwnProperty.call(n.attributes, name) &&\r\n            name.startsWith('rr_'))) {\r\n            continue;\r\n        }\r\n        const value = n.attributes[name];\r\n        if (name === 'rr_scrollLeft') {\r\n            el.scrollLeft = value;\r\n        }\r\n        if (name === 'rr_scrollTop') {\r\n            el.scrollTop = value;\r\n        }\r\n    }\r\n}\r\nfunction rebuild(n, options) {\r\n    const { doc, onVisit, hackCss = true, afterAppend, cache, mirror = new Mirror(), } = options;\r\n    const node = buildNodeWithSN(n, {\r\n        doc,\r\n        mirror,\r\n        skipChild: false,\r\n        hackCss,\r\n        afterAppend,\r\n        cache,\r\n    });\r\n    visit(mirror, (visitedNode) => {\r\n        if (onVisit) {\r\n            onVisit(visitedNode);\r\n        }\r\n        handleScroll(visitedNode, mirror);\r\n    });\r\n    return node;\r\n}\n\nexport { IGNORED_NODE, Mirror, NodeType, adaptCssForReplay, buildNodeWithSN, classMatchesRegex, createCache, createMirror, escapeImportStatement, extractFileExtension, fixSafariColons, genId, getInputType, ignoreAttribute, is2DCanvasBlank, isCSSImportRule, isCSSStyleRule, isElement, isNativeShadowDom, isNodeMetaEqual, isShadowRoot, maskInputValue, needMaskingText, rebuild, serializeNodeWithId, snapshot, stringifyRule, stringifyStylesheet, toLowerCase, transformAttribute };\n","import { classMatchesRegex, IGNORED_NODE, isShadowRoot } from '../../rrweb-snapshot/es/rrweb-snapshot.js';\n\nfunction on(type, fn, target = document) {\r\n    const options = { capture: true, passive: true };\r\n    target.addEventListener(type, fn, options);\r\n    return () => target.removeEventListener(type, fn, options);\r\n}\r\nconst DEPARTED_MIRROR_ACCESS_WARNING = 'Please stop import mirror directly. Instead of that,' +\r\n    '\\r\\n' +\r\n    'now you can use replayer.getMirror() to access the mirror instance of a replayer,' +\r\n    '\\r\\n' +\r\n    'or you can use record.mirror to access the mirror instance during recording.';\r\nlet _mirror = {\r\n    map: {},\r\n    getId() {\r\n        console.error(DEPARTED_MIRROR_ACCESS_WARNING);\r\n        return -1;\r\n    },\r\n    getNode() {\r\n        console.error(DEPARTED_MIRROR_ACCESS_WARNING);\r\n        return null;\r\n    },\r\n    removeNodeFromMap() {\r\n        console.error(DEPARTED_MIRROR_ACCESS_WARNING);\r\n    },\r\n    has() {\r\n        console.error(DEPARTED_MIRROR_ACCESS_WARNING);\r\n        return false;\r\n    },\r\n    reset() {\r\n        console.error(DEPARTED_MIRROR_ACCESS_WARNING);\r\n    },\r\n};\r\nif (typeof window !== 'undefined' && window.Proxy && window.Reflect) {\r\n    _mirror = new Proxy(_mirror, {\r\n        get(target, prop, receiver) {\r\n            if (prop === 'map') {\r\n                console.error(DEPARTED_MIRROR_ACCESS_WARNING);\r\n            }\r\n            return Reflect.get(target, prop, receiver);\r\n        },\r\n    });\r\n}\r\nfunction throttle(func, wait, options = {}) {\r\n    let timeout = null;\r\n    let previous = 0;\r\n    return function (...args) {\r\n        const now = Date.now();\r\n        if (!previous && options.leading === false) {\r\n            previous = now;\r\n        }\r\n        const remaining = wait - (now - previous);\r\n        const context = this;\r\n        if (remaining <= 0 || remaining > wait) {\r\n            if (timeout) {\r\n                clearTimeout(timeout);\r\n                timeout = null;\r\n            }\r\n            previous = now;\r\n            func.apply(context, args);\r\n        }\r\n        else if (!timeout && options.trailing !== false) {\r\n            timeout = setTimeout(() => {\r\n                previous = options.leading === false ? 0 : Date.now();\r\n                timeout = null;\r\n                func.apply(context, args);\r\n            }, remaining);\r\n        }\r\n    };\r\n}\r\nfunction hookSetter(target, key, d, isRevoked, win = window) {\r\n    const original = win.Object.getOwnPropertyDescriptor(target, key);\r\n    win.Object.defineProperty(target, key, isRevoked\r\n        ? d\r\n        : {\r\n            set(value) {\r\n                setTimeout(() => {\r\n                    d.set.call(this, value);\r\n                }, 0);\r\n                if (original && original.set) {\r\n                    original.set.call(this, value);\r\n                }\r\n            },\r\n        });\r\n    return () => hookSetter(target, key, original || {}, true);\r\n}\r\nfunction patch(source, name, replacement) {\r\n    try {\r\n        if (!(name in source)) {\r\n            return () => {\r\n            };\r\n        }\r\n        const original = source[name];\r\n        const wrapped = replacement(original);\r\n        if (typeof wrapped === 'function') {\r\n            wrapped.prototype = wrapped.prototype || {};\r\n            Object.defineProperties(wrapped, {\r\n                __rrweb_original__: {\r\n                    enumerable: false,\r\n                    value: original,\r\n                },\r\n            });\r\n        }\r\n        source[name] = wrapped;\r\n        return () => {\r\n            source[name] = original;\r\n        };\r\n    }\r\n    catch (_a) {\r\n        return () => {\r\n        };\r\n    }\r\n}\r\nlet nowTimestamp = Date.now;\r\nif (!(/[1-9][0-9]{12}/.test(Date.now().toString()))) {\r\n    nowTimestamp = () => new Date().getTime();\r\n}\r\nfunction getWindowScroll(win) {\r\n    var _a, _b, _c, _d, _e, _f;\r\n    const doc = win.document;\r\n    return {\r\n        left: doc.scrollingElement\r\n            ? doc.scrollingElement.scrollLeft\r\n            : win.pageXOffset !== undefined\r\n                ? win.pageXOffset\r\n                : (doc === null || doc === void 0 ? void 0 : doc.documentElement.scrollLeft) ||\r\n                    ((_b = (_a = doc === null || doc === void 0 ? void 0 : doc.body) === null || _a === void 0 ? void 0 : _a.parentElement) === null || _b === void 0 ? void 0 : _b.scrollLeft) ||\r\n                    ((_c = doc === null || doc === void 0 ? void 0 : doc.body) === null || _c === void 0 ? void 0 : _c.scrollLeft) ||\r\n                    0,\r\n        top: doc.scrollingElement\r\n            ? doc.scrollingElement.scrollTop\r\n            : win.pageYOffset !== undefined\r\n                ? win.pageYOffset\r\n                : (doc === null || doc === void 0 ? void 0 : doc.documentElement.scrollTop) ||\r\n                    ((_e = (_d = doc === null || doc === void 0 ? void 0 : doc.body) === null || _d === void 0 ? void 0 : _d.parentElement) === null || _e === void 0 ? void 0 : _e.scrollTop) ||\r\n                    ((_f = doc === null || doc === void 0 ? void 0 : doc.body) === null || _f === void 0 ? void 0 : _f.scrollTop) ||\r\n                    0,\r\n    };\r\n}\r\nfunction getWindowHeight() {\r\n    return (window.innerHeight ||\r\n        (document.documentElement && document.documentElement.clientHeight) ||\r\n        (document.body && document.body.clientHeight));\r\n}\r\nfunction getWindowWidth() {\r\n    return (window.innerWidth ||\r\n        (document.documentElement && document.documentElement.clientWidth) ||\r\n        (document.body && document.body.clientWidth));\r\n}\r\nfunction closestElementOfNode(node) {\r\n    if (!node) {\r\n        return null;\r\n    }\r\n    const el = node.nodeType === node.ELEMENT_NODE\r\n        ? node\r\n        : node.parentElement;\r\n    return el;\r\n}\r\nfunction isBlocked(node, blockClass, blockSelector, checkAncestors) {\r\n    if (!node) {\r\n        return false;\r\n    }\r\n    const el = closestElementOfNode(node);\r\n    if (!el) {\r\n        return false;\r\n    }\r\n    try {\r\n        if (typeof blockClass === 'string') {\r\n            if (el.classList.contains(blockClass))\r\n                return true;\r\n            if (checkAncestors && el.closest('.' + blockClass) !== null)\r\n                return true;\r\n        }\r\n        else {\r\n            if (classMatchesRegex(el, blockClass, checkAncestors))\r\n                return true;\r\n        }\r\n    }\r\n    catch (e) {\r\n    }\r\n    if (blockSelector) {\r\n        if (el.matches(blockSelector))\r\n            return true;\r\n        if (checkAncestors && el.closest(blockSelector) !== null)\r\n            return true;\r\n    }\r\n    return false;\r\n}\r\nfunction isSerialized(n, mirror) {\r\n    return mirror.getId(n) !== -1;\r\n}\r\nfunction isIgnored(n, mirror) {\r\n    return mirror.getId(n) === IGNORED_NODE;\r\n}\r\nfunction isAncestorRemoved(target, mirror) {\r\n    if (isShadowRoot(target)) {\r\n        return false;\r\n    }\r\n    const id = mirror.getId(target);\r\n    if (!mirror.has(id)) {\r\n        return true;\r\n    }\r\n    if (target.parentNode &&\r\n        target.parentNode.nodeType === target.DOCUMENT_NODE) {\r\n        return false;\r\n    }\r\n    if (!target.parentNode) {\r\n        return true;\r\n    }\r\n    return isAncestorRemoved(target.parentNode, mirror);\r\n}\r\nfunction legacy_isTouchEvent(event) {\r\n    return Boolean(event.changedTouches);\r\n}\r\nfunction polyfill(win = window) {\r\n    if ('NodeList' in win && !win.NodeList.prototype.forEach) {\r\n        win.NodeList.prototype.forEach = Array.prototype\r\n            .forEach;\r\n    }\r\n    if ('DOMTokenList' in win && !win.DOMTokenList.prototype.forEach) {\r\n        win.DOMTokenList.prototype.forEach = Array.prototype\r\n            .forEach;\r\n    }\r\n    if (!Node.prototype.contains) {\r\n        Node.prototype.contains = (...args) => {\r\n            let node = args[0];\r\n            if (!(0 in args)) {\r\n                throw new TypeError('1 argument is required');\r\n            }\r\n            do {\r\n                if (this === node) {\r\n                    return true;\r\n                }\r\n            } while ((node = node && node.parentNode));\r\n            return false;\r\n        };\r\n    }\r\n}\r\nfunction queueToResolveTrees(queue) {\r\n    const queueNodeMap = {};\r\n    const putIntoMap = (m, parent) => {\r\n        const nodeInTree = {\r\n            value: m,\r\n            parent,\r\n            children: [],\r\n        };\r\n        queueNodeMap[m.node.id] = nodeInTree;\r\n        return nodeInTree;\r\n    };\r\n    const queueNodeTrees = [];\r\n    for (const mutation of queue) {\r\n        const { nextId, parentId } = mutation;\r\n        if (nextId && nextId in queueNodeMap) {\r\n            const nextInTree = queueNodeMap[nextId];\r\n            if (nextInTree.parent) {\r\n                const idx = nextInTree.parent.children.indexOf(nextInTree);\r\n                nextInTree.parent.children.splice(idx, 0, putIntoMap(mutation, nextInTree.parent));\r\n            }\r\n            else {\r\n                const idx = queueNodeTrees.indexOf(nextInTree);\r\n                queueNodeTrees.splice(idx, 0, putIntoMap(mutation, null));\r\n            }\r\n            continue;\r\n        }\r\n        if (parentId in queueNodeMap) {\r\n            const parentInTree = queueNodeMap[parentId];\r\n            parentInTree.children.push(putIntoMap(mutation, parentInTree));\r\n            continue;\r\n        }\r\n        queueNodeTrees.push(putIntoMap(mutation, null));\r\n    }\r\n    return queueNodeTrees;\r\n}\r\nfunction iterateResolveTree(tree, cb) {\r\n    cb(tree.value);\r\n    for (let i = tree.children.length - 1; i >= 0; i--) {\r\n        iterateResolveTree(tree.children[i], cb);\r\n    }\r\n}\r\nfunction isSerializedIframe(n, mirror) {\r\n    return Boolean(n.nodeName === 'IFRAME' && mirror.getMeta(n));\r\n}\r\nfunction isSerializedStylesheet(n, mirror) {\r\n    return Boolean(n.nodeName === 'LINK' &&\r\n        n.nodeType === n.ELEMENT_NODE &&\r\n        n.getAttribute &&\r\n        n.getAttribute('rel') === 'stylesheet' &&\r\n        mirror.getMeta(n));\r\n}\r\nfunction getBaseDimension(node, rootIframe) {\r\n    var _a, _b;\r\n    const frameElement = (_b = (_a = node.ownerDocument) === null || _a === void 0 ? void 0 : _a.defaultView) === null || _b === void 0 ? void 0 : _b.frameElement;\r\n    if (!frameElement || frameElement === rootIframe) {\r\n        return {\r\n            x: 0,\r\n            y: 0,\r\n            relativeScale: 1,\r\n            absoluteScale: 1,\r\n        };\r\n    }\r\n    const frameDimension = frameElement.getBoundingClientRect();\r\n    const frameBaseDimension = getBaseDimension(frameElement, rootIframe);\r\n    const relativeScale = frameDimension.height / frameElement.clientHeight;\r\n    return {\r\n        x: frameDimension.x * frameBaseDimension.relativeScale +\r\n            frameBaseDimension.x,\r\n        y: frameDimension.y * frameBaseDimension.relativeScale +\r\n            frameBaseDimension.y,\r\n        relativeScale,\r\n        absoluteScale: frameBaseDimension.absoluteScale * relativeScale,\r\n    };\r\n}\r\nfunction hasShadowRoot(n) {\r\n    return Boolean(n === null || n === void 0 ? void 0 : n.shadowRoot);\r\n}\r\nfunction getNestedRule(rules, position) {\r\n    const rule = rules[position[0]];\r\n    if (position.length === 1) {\r\n        return rule;\r\n    }\r\n    else {\r\n        return getNestedRule(rule.cssRules[position[1]].cssRules, position.slice(2));\r\n    }\r\n}\r\nfunction getPositionsAndIndex(nestedIndex) {\r\n    const positions = [...nestedIndex];\r\n    const index = positions.pop();\r\n    return { positions, index };\r\n}\r\nfunction uniqueTextMutations(mutations) {\r\n    const idSet = new Set();\r\n    const uniqueMutations = [];\r\n    for (let i = mutations.length; i--;) {\r\n        const mutation = mutations[i];\r\n        if (!idSet.has(mutation.id)) {\r\n            uniqueMutations.push(mutation);\r\n            idSet.add(mutation.id);\r\n        }\r\n    }\r\n    return uniqueMutations;\r\n}\r\nclass StyleSheetMirror {\r\n    constructor() {\r\n        this.id = 1;\r\n        this.styleIDMap = new WeakMap();\r\n        this.idStyleMap = new Map();\r\n    }\r\n    getId(stylesheet) {\r\n        var _a;\r\n        return (_a = this.styleIDMap.get(stylesheet)) !== null && _a !== void 0 ? _a : -1;\r\n    }\r\n    has(stylesheet) {\r\n        return this.styleIDMap.has(stylesheet);\r\n    }\r\n    add(stylesheet, id) {\r\n        if (this.has(stylesheet))\r\n            return this.getId(stylesheet);\r\n        let newId;\r\n        if (id === undefined) {\r\n            newId = this.id++;\r\n        }\r\n        else\r\n            newId = id;\r\n        this.styleIDMap.set(stylesheet, newId);\r\n        this.idStyleMap.set(newId, stylesheet);\r\n        return newId;\r\n    }\r\n    getStyle(id) {\r\n        return this.idStyleMap.get(id) || null;\r\n    }\r\n    reset() {\r\n        this.styleIDMap = new WeakMap();\r\n        this.idStyleMap = new Map();\r\n        this.id = 1;\r\n    }\r\n    generateId() {\r\n        return this.id++;\r\n    }\r\n}\r\nfunction getShadowHost(n) {\r\n    var _a, _b;\r\n    let shadowHost = null;\r\n    if (((_b = (_a = n.getRootNode) === null || _a === void 0 ? void 0 : _a.call(n)) === null || _b === void 0 ? void 0 : _b.nodeType) === Node.DOCUMENT_FRAGMENT_NODE &&\r\n        n.getRootNode().host)\r\n        shadowHost = n.getRootNode().host;\r\n    return shadowHost;\r\n}\r\nfunction getRootShadowHost(n) {\r\n    let rootShadowHost = n;\r\n    let shadowHost;\r\n    while ((shadowHost = getShadowHost(rootShadowHost)))\r\n        rootShadowHost = shadowHost;\r\n    return rootShadowHost;\r\n}\r\nfunction shadowHostInDom(n) {\r\n    const doc = n.ownerDocument;\r\n    if (!doc)\r\n        return false;\r\n    const shadowHost = getRootShadowHost(n);\r\n    return doc.contains(shadowHost);\r\n}\r\nfunction inDom(n) {\r\n    const doc = n.ownerDocument;\r\n    if (!doc)\r\n        return false;\r\n    return doc.contains(n) || shadowHostInDom(n);\r\n}\n\nexport { StyleSheetMirror, _mirror, closestElementOfNode, getBaseDimension, getNestedRule, getPositionsAndIndex, getRootShadowHost, getShadowHost, getWindowHeight, getWindowScroll, getWindowWidth, hasShadowRoot, hookSetter, inDom, isAncestorRemoved, isBlocked, isIgnored, isSerialized, isSerializedIframe, isSerializedStylesheet, iterateResolveTree, legacy_isTouchEvent, nowTimestamp, on, patch, polyfill, queueToResolveTrees, shadowHostInDom, throttle, uniqueTextMutations };\n","var EventType = /* @__PURE__ */ ((EventType2) => {\n  EventType2[EventType2[\"DomContentLoaded\"] = 0] = \"DomContentLoaded\";\n  EventType2[EventType2[\"Load\"] = 1] = \"Load\";\n  EventType2[EventType2[\"FullSnapshot\"] = 2] = \"FullSnapshot\";\n  EventType2[EventType2[\"IncrementalSnapshot\"] = 3] = \"IncrementalSnapshot\";\n  EventType2[EventType2[\"Meta\"] = 4] = \"Meta\";\n  EventType2[EventType2[\"Custom\"] = 5] = \"Custom\";\n  EventType2[EventType2[\"Plugin\"] = 6] = \"Plugin\";\n  return EventType2;\n})(EventType || {});\nvar IncrementalSource = /* @__PURE__ */ ((IncrementalSource2) => {\n  IncrementalSource2[IncrementalSource2[\"Mutation\"] = 0] = \"Mutation\";\n  IncrementalSource2[IncrementalSource2[\"MouseMove\"] = 1] = \"MouseMove\";\n  IncrementalSource2[IncrementalSource2[\"MouseInteraction\"] = 2] = \"MouseInteraction\";\n  IncrementalSource2[IncrementalSource2[\"Scroll\"] = 3] = \"Scroll\";\n  IncrementalSource2[IncrementalSource2[\"ViewportResize\"] = 4] = \"ViewportResize\";\n  IncrementalSource2[IncrementalSource2[\"Input\"] = 5] = \"Input\";\n  IncrementalSource2[IncrementalSource2[\"TouchMove\"] = 6] = \"TouchMove\";\n  IncrementalSource2[IncrementalSource2[\"MediaInteraction\"] = 7] = \"MediaInteraction\";\n  IncrementalSource2[IncrementalSource2[\"StyleSheetRule\"] = 8] = \"StyleSheetRule\";\n  IncrementalSource2[IncrementalSource2[\"CanvasMutation\"] = 9] = \"CanvasMutation\";\n  IncrementalSource2[IncrementalSource2[\"Font\"] = 10] = \"Font\";\n  IncrementalSource2[IncrementalSource2[\"Log\"] = 11] = \"Log\";\n  IncrementalSource2[IncrementalSource2[\"Drag\"] = 12] = \"Drag\";\n  IncrementalSource2[IncrementalSource2[\"StyleDeclaration\"] = 13] = \"StyleDeclaration\";\n  IncrementalSource2[IncrementalSource2[\"Selection\"] = 14] = \"Selection\";\n  IncrementalSource2[IncrementalSource2[\"AdoptedStyleSheet\"] = 15] = \"AdoptedStyleSheet\";\n  IncrementalSource2[IncrementalSource2[\"CustomElement\"] = 16] = \"CustomElement\";\n  return IncrementalSource2;\n})(IncrementalSource || {});\nvar MouseInteractions = /* @__PURE__ */ ((MouseInteractions2) => {\n  MouseInteractions2[MouseInteractions2[\"MouseUp\"] = 0] = \"MouseUp\";\n  MouseInteractions2[MouseInteractions2[\"MouseDown\"] = 1] = \"MouseDown\";\n  MouseInteractions2[MouseInteractions2[\"Click\"] = 2] = \"Click\";\n  MouseInteractions2[MouseInteractions2[\"ContextMenu\"] = 3] = \"ContextMenu\";\n  MouseInteractions2[MouseInteractions2[\"DblClick\"] = 4] = \"DblClick\";\n  MouseInteractions2[MouseInteractions2[\"Focus\"] = 5] = \"Focus\";\n  MouseInteractions2[MouseInteractions2[\"Blur\"] = 6] = \"Blur\";\n  MouseInteractions2[MouseInteractions2[\"TouchStart\"] = 7] = \"TouchStart\";\n  MouseInteractions2[MouseInteractions2[\"TouchMove_Departed\"] = 8] = \"TouchMove_Departed\";\n  MouseInteractions2[MouseInteractions2[\"TouchEnd\"] = 9] = \"TouchEnd\";\n  MouseInteractions2[MouseInteractions2[\"TouchCancel\"] = 10] = \"TouchCancel\";\n  return MouseInteractions2;\n})(MouseInteractions || {});\nvar PointerTypes = /* @__PURE__ */ ((PointerTypes2) => {\n  PointerTypes2[PointerTypes2[\"Mouse\"] = 0] = \"Mouse\";\n  PointerTypes2[PointerTypes2[\"Pen\"] = 1] = \"Pen\";\n  PointerTypes2[PointerTypes2[\"Touch\"] = 2] = \"Touch\";\n  return PointerTypes2;\n})(PointerTypes || {});\nvar CanvasContext = /* @__PURE__ */ ((CanvasContext2) => {\n  CanvasContext2[CanvasContext2[\"2D\"] = 0] = \"2D\";\n  CanvasContext2[CanvasContext2[\"WebGL\"] = 1] = \"WebGL\";\n  CanvasContext2[CanvasContext2[\"WebGL2\"] = 2] = \"WebGL2\";\n  return CanvasContext2;\n})(CanvasContext || {});\nvar ReplayerEvents = /* @__PURE__ */ ((ReplayerEvents2) => {\n  ReplayerEvents2[\"Start\"] = \"start\";\n  ReplayerEvents2[\"Pause\"] = \"pause\";\n  ReplayerEvents2[\"Resume\"] = \"resume\";\n  ReplayerEvents2[\"Resize\"] = \"resize\";\n  ReplayerEvents2[\"Finish\"] = \"finish\";\n  ReplayerEvents2[\"FullsnapshotRebuilded\"] = \"fullsnapshot-rebuilded\";\n  ReplayerEvents2[\"LoadStylesheetStart\"] = \"load-stylesheet-start\";\n  ReplayerEvents2[\"LoadStylesheetEnd\"] = \"load-stylesheet-end\";\n  ReplayerEvents2[\"SkipStart\"] = \"skip-start\";\n  ReplayerEvents2[\"SkipEnd\"] = \"skip-end\";\n  ReplayerEvents2[\"MouseInteraction\"] = \"mouse-interaction\";\n  ReplayerEvents2[\"EventCast\"] = \"event-cast\";\n  ReplayerEvents2[\"CustomEvent\"] = \"custom-event\";\n  ReplayerEvents2[\"Flush\"] = \"flush\";\n  ReplayerEvents2[\"StateChange\"] = \"state-change\";\n  ReplayerEvents2[\"PlayBack\"] = \"play-back\";\n  ReplayerEvents2[\"Destroy\"] = \"destroy\";\n  return ReplayerEvents2;\n})(ReplayerEvents || {});\n\nexport { CanvasContext, EventType, IncrementalSource, MouseInteractions, PointerTypes, ReplayerEvents };\n","import { isShadowRoot, isNativeShadowDom, getInputType, maskInputValue, ignoreAttribute, transformAttribute, toLowerCase, needMaskingText, IGNORED_NODE, serializeNodeWithId } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport { isIgnored, isBlocked, isSerialized, isAncestorRemoved, closestElementOfNode, hasShadowRoot, inDom, getShadowHost, isSerializedIframe, isSerializedStylesheet } from '../utils.js';\n\nfunction isNodeInLinkedList(n) {\r\n    return '__ln' in n;\r\n}\r\nclass DoubleLinkedList {\r\n    constructor() {\r\n        this.length = 0;\r\n        this.head = null;\r\n        this.tail = null;\r\n    }\r\n    get(position) {\r\n        if (position >= this.length) {\r\n            throw new Error('Position outside of list range');\r\n        }\r\n        let current = this.head;\r\n        for (let index = 0; index < position; index++) {\r\n            current = (current === null || current === void 0 ? void 0 : current.next) || null;\r\n        }\r\n        return current;\r\n    }\r\n    addNode(n) {\r\n        const node = {\r\n            value: n,\r\n            previous: null,\r\n            next: null,\r\n        };\r\n        n.__ln = node;\r\n        if (n.previousSibling && isNodeInLinkedList(n.previousSibling)) {\r\n            const current = n.previousSibling.__ln.next;\r\n            node.next = current;\r\n            node.previous = n.previousSibling.__ln;\r\n            n.previousSibling.__ln.next = node;\r\n            if (current) {\r\n                current.previous = node;\r\n            }\r\n        }\r\n        else if (n.nextSibling &&\r\n            isNodeInLinkedList(n.nextSibling) &&\r\n            n.nextSibling.__ln.previous) {\r\n            const current = n.nextSibling.__ln.previous;\r\n            node.previous = current;\r\n            node.next = n.nextSibling.__ln;\r\n            n.nextSibling.__ln.previous = node;\r\n            if (current) {\r\n                current.next = node;\r\n            }\r\n        }\r\n        else {\r\n            if (this.head) {\r\n                this.head.previous = node;\r\n            }\r\n            node.next = this.head;\r\n            this.head = node;\r\n        }\r\n        if (node.next === null) {\r\n            this.tail = node;\r\n        }\r\n        this.length++;\r\n    }\r\n    removeNode(n) {\r\n        const current = n.__ln;\r\n        if (!this.head) {\r\n            return;\r\n        }\r\n        if (!current.previous) {\r\n            this.head = current.next;\r\n            if (this.head) {\r\n                this.head.previous = null;\r\n            }\r\n            else {\r\n                this.tail = null;\r\n            }\r\n        }\r\n        else {\r\n            current.previous.next = current.next;\r\n            if (current.next) {\r\n                current.next.previous = current.previous;\r\n            }\r\n            else {\r\n                this.tail = current.previous;\r\n            }\r\n        }\r\n        if (n.__ln) {\r\n            delete n.__ln;\r\n        }\r\n        this.length--;\r\n    }\r\n}\r\nconst moveKey = (id, parentId) => `${id}@${parentId}`;\r\nclass MutationBuffer {\r\n    constructor() {\r\n        this.frozen = false;\r\n        this.locked = false;\r\n        this.texts = [];\r\n        this.attributes = [];\r\n        this.attributeMap = new WeakMap();\r\n        this.removes = [];\r\n        this.mapRemoves = [];\r\n        this.movedMap = {};\r\n        this.addedSet = new Set();\r\n        this.movedSet = new Set();\r\n        this.droppedSet = new Set();\r\n        this.processMutations = (mutations) => {\r\n            mutations.forEach(this.processMutation);\r\n            this.emit();\r\n        };\r\n        this.emit = () => {\r\n            if (this.frozen || this.locked) {\r\n                return;\r\n            }\r\n            const adds = [];\r\n            const addedIds = new Set();\r\n            const addList = new DoubleLinkedList();\r\n            const getNextId = (n) => {\r\n                let ns = n;\r\n                let nextId = IGNORED_NODE;\r\n                while (nextId === IGNORED_NODE) {\r\n                    ns = ns && ns.nextSibling;\r\n                    nextId = ns && this.mirror.getId(ns);\r\n                }\r\n                return nextId;\r\n            };\r\n            const pushAdd = (n) => {\r\n                if (!n.parentNode ||\r\n                    !inDom(n) ||\r\n                    n.parentNode.tagName === 'TEXTAREA') {\r\n                    return;\r\n                }\r\n                const parentId = isShadowRoot(n.parentNode)\r\n                    ? this.mirror.getId(getShadowHost(n))\r\n                    : this.mirror.getId(n.parentNode);\r\n                const nextId = getNextId(n);\r\n                if (parentId === -1 || nextId === -1) {\r\n                    return addList.addNode(n);\r\n                }\r\n                const sn = serializeNodeWithId(n, {\r\n                    doc: this.doc,\r\n                    mirror: this.mirror,\r\n                    blockClass: this.blockClass,\r\n                    blockSelector: this.blockSelector,\r\n                    maskTextClass: this.maskTextClass,\r\n                    maskTextSelector: this.maskTextSelector,\r\n                    skipChild: true,\r\n                    newlyAddedElement: true,\r\n                    inlineStylesheet: this.inlineStylesheet,\r\n                    maskInputOptions: this.maskInputOptions,\r\n                    maskTextFn: this.maskTextFn,\r\n                    maskInputFn: this.maskInputFn,\r\n                    slimDOMOptions: this.slimDOMOptions,\r\n                    dataURLOptions: this.dataURLOptions,\r\n                    recordCanvas: this.recordCanvas,\r\n                    inlineImages: this.inlineImages,\r\n                    onSerialize: (currentN) => {\r\n                        if (isSerializedIframe(currentN, this.mirror)) {\r\n                            this.iframeManager.addIframe(currentN);\r\n                        }\r\n                        if (isSerializedStylesheet(currentN, this.mirror)) {\r\n                            this.stylesheetManager.trackLinkElement(currentN);\r\n                        }\r\n                        if (hasShadowRoot(n)) {\r\n                            this.shadowDomManager.addShadowRoot(n.shadowRoot, this.doc);\r\n                        }\r\n                    },\r\n                    onIframeLoad: (iframe, childSn) => {\r\n                        this.iframeManager.attachIframe(iframe, childSn);\r\n                        this.shadowDomManager.observeAttachShadow(iframe);\r\n                    },\r\n                    onStylesheetLoad: (link, childSn) => {\r\n                        this.stylesheetManager.attachLinkElement(link, childSn);\r\n                    },\r\n                });\r\n                if (sn) {\r\n                    adds.push({\r\n                        parentId,\r\n                        nextId,\r\n                        node: sn,\r\n                    });\r\n                    addedIds.add(sn.id);\r\n                }\r\n            };\r\n            while (this.mapRemoves.length) {\r\n                this.mirror.removeNodeFromMap(this.mapRemoves.shift());\r\n            }\r\n            for (const n of this.movedSet) {\r\n                if (isParentRemoved(this.removes, n, this.mirror) &&\r\n                    !this.movedSet.has(n.parentNode)) {\r\n                    continue;\r\n                }\r\n                pushAdd(n);\r\n            }\r\n            for (const n of this.addedSet) {\r\n                if (!isAncestorInSet(this.droppedSet, n) &&\r\n                    !isParentRemoved(this.removes, n, this.mirror)) {\r\n                    pushAdd(n);\r\n                }\r\n                else if (isAncestorInSet(this.movedSet, n)) {\r\n                    pushAdd(n);\r\n                }\r\n                else {\r\n                    this.droppedSet.add(n);\r\n                }\r\n            }\r\n            let candidate = null;\r\n            while (addList.length) {\r\n                let node = null;\r\n                if (candidate) {\r\n                    const parentId = this.mirror.getId(candidate.value.parentNode);\r\n                    const nextId = getNextId(candidate.value);\r\n                    if (parentId !== -1 && nextId !== -1) {\r\n                        node = candidate;\r\n                    }\r\n                }\r\n                if (!node) {\r\n                    let tailNode = addList.tail;\r\n                    while (tailNode) {\r\n                        const _node = tailNode;\r\n                        tailNode = tailNode.previous;\r\n                        if (_node) {\r\n                            const parentId = this.mirror.getId(_node.value.parentNode);\r\n                            const nextId = getNextId(_node.value);\r\n                            if (nextId === -1)\r\n                                continue;\r\n                            else if (parentId !== -1) {\r\n                                node = _node;\r\n                                break;\r\n                            }\r\n                            else {\r\n                                const unhandledNode = _node.value;\r\n                                if (unhandledNode.parentNode &&\r\n                                    unhandledNode.parentNode.nodeType ===\r\n                                        Node.DOCUMENT_FRAGMENT_NODE) {\r\n                                    const shadowHost = unhandledNode.parentNode\r\n                                        .host;\r\n                                    const parentId = this.mirror.getId(shadowHost);\r\n                                    if (parentId !== -1) {\r\n                                        node = _node;\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                if (!node) {\r\n                    while (addList.head) {\r\n                        addList.removeNode(addList.head.value);\r\n                    }\r\n                    break;\r\n                }\r\n                candidate = node.previous;\r\n                addList.removeNode(node.value);\r\n                pushAdd(node.value);\r\n            }\r\n            const payload = {\r\n                texts: this.texts\r\n                    .map((text) => {\r\n                    const n = text.node;\r\n                    if (n.parentNode &&\r\n                        n.parentNode.tagName === 'TEXTAREA') {\r\n                        this.genTextAreaValueMutation(n.parentNode);\r\n                    }\r\n                    return {\r\n                        id: this.mirror.getId(n),\r\n                        value: text.value,\r\n                    };\r\n                })\r\n                    .filter((text) => !addedIds.has(text.id))\r\n                    .filter((text) => this.mirror.has(text.id)),\r\n                attributes: this.attributes\r\n                    .map((attribute) => {\r\n                    const { attributes } = attribute;\r\n                    if (typeof attributes.style === 'string') {\r\n                        const diffAsStr = JSON.stringify(attribute.styleDiff);\r\n                        const unchangedAsStr = JSON.stringify(attribute._unchangedStyles);\r\n                        if (diffAsStr.length < attributes.style.length) {\r\n                            if ((diffAsStr + unchangedAsStr).split('var(').length ===\r\n                                attributes.style.split('var(').length) {\r\n                                attributes.style = attribute.styleDiff;\r\n                            }\r\n                        }\r\n                    }\r\n                    return {\r\n                        id: this.mirror.getId(attribute.node),\r\n                        attributes: attributes,\r\n                    };\r\n                })\r\n                    .filter((attribute) => !addedIds.has(attribute.id))\r\n                    .filter((attribute) => this.mirror.has(attribute.id)),\r\n                removes: this.removes,\r\n                adds,\r\n            };\r\n            if (!payload.texts.length &&\r\n                !payload.attributes.length &&\r\n                !payload.removes.length &&\r\n                !payload.adds.length) {\r\n                return;\r\n            }\r\n            this.texts = [];\r\n            this.attributes = [];\r\n            this.attributeMap = new WeakMap();\r\n            this.removes = [];\r\n            this.addedSet = new Set();\r\n            this.movedSet = new Set();\r\n            this.droppedSet = new Set();\r\n            this.movedMap = {};\r\n            this.mutationCb(payload);\r\n        };\r\n        this.genTextAreaValueMutation = (textarea) => {\r\n            let item = this.attributeMap.get(textarea);\r\n            if (!item) {\r\n                item = {\r\n                    node: textarea,\r\n                    attributes: {},\r\n                    styleDiff: {},\r\n                    _unchangedStyles: {},\r\n                };\r\n                this.attributes.push(item);\r\n                this.attributeMap.set(textarea, item);\r\n            }\r\n            item.attributes.value = Array.from(textarea.childNodes, (cn) => cn.textContent || '').join('');\r\n        };\r\n        this.processMutation = (m) => {\r\n            if (isIgnored(m.target, this.mirror)) {\r\n                return;\r\n            }\r\n            switch (m.type) {\r\n                case 'characterData': {\r\n                    const value = m.target.textContent;\r\n                    if (!isBlocked(m.target, this.blockClass, this.blockSelector, false) &&\r\n                        value !== m.oldValue) {\r\n                        this.texts.push({\r\n                            value: needMaskingText(m.target, this.maskTextClass, this.maskTextSelector, true) && value\r\n                                ? this.maskTextFn\r\n                                    ? this.maskTextFn(value, closestElementOfNode(m.target))\r\n                                    : value.replace(/[\\S]/g, '*')\r\n                                : value,\r\n                            node: m.target,\r\n                        });\r\n                    }\r\n                    break;\r\n                }\r\n                case 'attributes': {\r\n                    const target = m.target;\r\n                    let attributeName = m.attributeName;\r\n                    let value = m.target.getAttribute(attributeName);\r\n                    if (attributeName === 'value') {\r\n                        const type = getInputType(target);\r\n                        value = maskInputValue({\r\n                            element: target,\r\n                            maskInputOptions: this.maskInputOptions,\r\n                            tagName: target.tagName,\r\n                            type,\r\n                            value,\r\n                            maskInputFn: this.maskInputFn,\r\n                        });\r\n                    }\r\n                    if (isBlocked(m.target, this.blockClass, this.blockSelector, false) ||\r\n                        value === m.oldValue) {\r\n                        return;\r\n                    }\r\n                    let item = this.attributeMap.get(m.target);\r\n                    if (target.tagName === 'IFRAME' &&\r\n                        attributeName === 'src' &&\r\n                        !this.keepIframeSrcFn(value)) {\r\n                        if (!target.contentDocument) {\r\n                            attributeName = 'rr_src';\r\n                        }\r\n                        else {\r\n                            return;\r\n                        }\r\n                    }\r\n                    if (!item) {\r\n                        item = {\r\n                            node: m.target,\r\n                            attributes: {},\r\n                            styleDiff: {},\r\n                            _unchangedStyles: {},\r\n                        };\r\n                        this.attributes.push(item);\r\n                        this.attributeMap.set(m.target, item);\r\n                    }\r\n                    if (attributeName === 'type' &&\r\n                        target.tagName === 'INPUT' &&\r\n                        (m.oldValue || '').toLowerCase() === 'password') {\r\n                        target.setAttribute('data-rr-is-password', 'true');\r\n                    }\r\n                    if (!ignoreAttribute(target.tagName, attributeName)) {\r\n                        item.attributes[attributeName] = transformAttribute(this.doc, toLowerCase(target.tagName), toLowerCase(attributeName), value);\r\n                        if (attributeName === 'style') {\r\n                            if (!this.unattachedDoc) {\r\n                                try {\r\n                                    this.unattachedDoc =\r\n                                        document.implementation.createHTMLDocument();\r\n                                }\r\n                                catch (e) {\r\n                                    this.unattachedDoc = this.doc;\r\n                                }\r\n                            }\r\n                            const old = this.unattachedDoc.createElement('span');\r\n                            if (m.oldValue) {\r\n                                old.setAttribute('style', m.oldValue);\r\n                            }\r\n                            for (const pname of Array.from(target.style)) {\r\n                                const newValue = target.style.getPropertyValue(pname);\r\n                                const newPriority = target.style.getPropertyPriority(pname);\r\n                                if (newValue !== old.style.getPropertyValue(pname) ||\r\n                                    newPriority !== old.style.getPropertyPriority(pname)) {\r\n                                    if (newPriority === '') {\r\n                                        item.styleDiff[pname] = newValue;\r\n                                    }\r\n                                    else {\r\n                                        item.styleDiff[pname] = [newValue, newPriority];\r\n                                    }\r\n                                }\r\n                                else {\r\n                                    item._unchangedStyles[pname] = [newValue, newPriority];\r\n                                }\r\n                            }\r\n                            for (const pname of Array.from(old.style)) {\r\n                                if (target.style.getPropertyValue(pname) === '') {\r\n                                    item.styleDiff[pname] = false;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                case 'childList': {\r\n                    if (isBlocked(m.target, this.blockClass, this.blockSelector, true))\r\n                        return;\r\n                    if (m.target.tagName === 'TEXTAREA') {\r\n                        this.genTextAreaValueMutation(m.target);\r\n                        return;\r\n                    }\r\n                    m.addedNodes.forEach((n) => this.genAdds(n, m.target));\r\n                    m.removedNodes.forEach((n) => {\r\n                        const nodeId = this.mirror.getId(n);\r\n                        const parentId = isShadowRoot(m.target)\r\n                            ? this.mirror.getId(m.target.host)\r\n                            : this.mirror.getId(m.target);\r\n                        if (isBlocked(m.target, this.blockClass, this.blockSelector, false) ||\r\n                            isIgnored(n, this.mirror) ||\r\n                            !isSerialized(n, this.mirror)) {\r\n                            return;\r\n                        }\r\n                        if (this.addedSet.has(n)) {\r\n                            deepDelete(this.addedSet, n);\r\n                            this.droppedSet.add(n);\r\n                        }\r\n                        else if (this.addedSet.has(m.target) && nodeId === -1) ;\r\n                        else if (isAncestorRemoved(m.target, this.mirror)) ;\r\n                        else if (this.movedSet.has(n) &&\r\n                            this.movedMap[moveKey(nodeId, parentId)]) {\r\n                            deepDelete(this.movedSet, n);\r\n                        }\r\n                        else {\r\n                            this.removes.push({\r\n                                parentId,\r\n                                id: nodeId,\r\n                                isShadow: isShadowRoot(m.target) && isNativeShadowDom(m.target)\r\n                                    ? true\r\n                                    : undefined,\r\n                            });\r\n                        }\r\n                        this.mapRemoves.push(n);\r\n                    });\r\n                    break;\r\n                }\r\n            }\r\n        };\r\n        this.genAdds = (n, target) => {\r\n            if (this.processedNodeManager.inOtherBuffer(n, this))\r\n                return;\r\n            if (this.addedSet.has(n) || this.movedSet.has(n))\r\n                return;\r\n            if (this.mirror.hasNode(n)) {\r\n                if (isIgnored(n, this.mirror)) {\r\n                    return;\r\n                }\r\n                this.movedSet.add(n);\r\n                let targetId = null;\r\n                if (target && this.mirror.hasNode(target)) {\r\n                    targetId = this.mirror.getId(target);\r\n                }\r\n                if (targetId && targetId !== -1) {\r\n                    this.movedMap[moveKey(this.mirror.getId(n), targetId)] = true;\r\n                }\r\n            }\r\n            else {\r\n                this.addedSet.add(n);\r\n                this.droppedSet.delete(n);\r\n            }\r\n            if (!isBlocked(n, this.blockClass, this.blockSelector, false)) {\r\n                n.childNodes.forEach((childN) => this.genAdds(childN));\r\n                if (hasShadowRoot(n)) {\r\n                    n.shadowRoot.childNodes.forEach((childN) => {\r\n                        this.processedNodeManager.add(childN, this);\r\n                        this.genAdds(childN, n);\r\n                    });\r\n                }\r\n            }\r\n        };\r\n    }\r\n    init(options) {\r\n        [\r\n            'mutationCb',\r\n            'blockClass',\r\n            'blockSelector',\r\n            'maskTextClass',\r\n            'maskTextSelector',\r\n            'inlineStylesheet',\r\n            'maskInputOptions',\r\n            'maskTextFn',\r\n            'maskInputFn',\r\n            'keepIframeSrcFn',\r\n            'recordCanvas',\r\n            'inlineImages',\r\n            'slimDOMOptions',\r\n            'dataURLOptions',\r\n            'doc',\r\n            'mirror',\r\n            'iframeManager',\r\n            'stylesheetManager',\r\n            'shadowDomManager',\r\n            'canvasManager',\r\n            'processedNodeManager',\r\n        ].forEach((key) => {\r\n            this[key] = options[key];\r\n        });\r\n    }\r\n    freeze() {\r\n        this.frozen = true;\r\n        this.canvasManager.freeze();\r\n    }\r\n    unfreeze() {\r\n        this.frozen = false;\r\n        this.canvasManager.unfreeze();\r\n        this.emit();\r\n    }\r\n    isFrozen() {\r\n        return this.frozen;\r\n    }\r\n    lock() {\r\n        this.locked = true;\r\n        this.canvasManager.lock();\r\n    }\r\n    unlock() {\r\n        this.locked = false;\r\n        this.canvasManager.unlock();\r\n        this.emit();\r\n    }\r\n    reset() {\r\n        this.shadowDomManager.reset();\r\n        this.canvasManager.reset();\r\n    }\r\n}\r\nfunction deepDelete(addsSet, n) {\r\n    addsSet.delete(n);\r\n    n.childNodes.forEach((childN) => deepDelete(addsSet, childN));\r\n}\r\nfunction isParentRemoved(removes, n, mirror) {\r\n    if (removes.length === 0)\r\n        return false;\r\n    return _isParentRemoved(removes, n, mirror);\r\n}\r\nfunction _isParentRemoved(removes, n, mirror) {\r\n    const { parentNode } = n;\r\n    if (!parentNode) {\r\n        return false;\r\n    }\r\n    const parentId = mirror.getId(parentNode);\r\n    if (removes.some((r) => r.id === parentId)) {\r\n        return true;\r\n    }\r\n    return _isParentRemoved(removes, parentNode, mirror);\r\n}\r\nfunction isAncestorInSet(set, n) {\r\n    if (set.size === 0)\r\n        return false;\r\n    return _isAncestorInSet(set, n);\r\n}\r\nfunction _isAncestorInSet(set, n) {\r\n    const { parentNode } = n;\r\n    if (!parentNode) {\r\n        return false;\r\n    }\r\n    if (set.has(parentNode)) {\r\n        return true;\r\n    }\r\n    return _isAncestorInSet(set, parentNode);\r\n}\n\nexport { MutationBuffer as default };\n","let errorHandler;\r\nfunction registerErrorHandler(handler) {\r\n    errorHandler = handler;\r\n}\r\nfunction unregisterErrorHandler() {\r\n    errorHandler = undefined;\r\n}\r\nconst callbackWrapper = (cb) => {\r\n    if (!errorHandler) {\r\n        return cb;\r\n    }\r\n    const rrwebWrapped = ((...rest) => {\r\n        try {\r\n            return cb(...rest);\r\n        }\r\n        catch (error) {\r\n            if (errorHandler && errorHandler(error) === true) {\r\n                return;\r\n            }\r\n            throw error;\r\n        }\r\n    });\r\n    return rrwebWrapped;\r\n};\n\nexport { callbackWrapper, registerErrorHandler, unregisterErrorHandler };\n","import { toLowerCase, getInputType, maskInputValue } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport { on, throttle, isBlocked, getWindowScroll, getWindowHeight, getWindowWidth, hookSetter, patch, legacy_isTouchEvent, nowTimestamp } from '../utils.js';\nimport { MouseInteractions, IncrementalSource, PointerTypes } from '../../../types/dist/types.js';\nimport MutationBuffer from './mutation.js';\nimport { callbackWrapper } from './error-handler.js';\n\nconst mutationBuffers = [];\r\nfunction getEventTarget(event) {\r\n    try {\r\n        if ('composedPath' in event) {\r\n            const path = event.composedPath();\r\n            if (path.length) {\r\n                return path[0];\r\n            }\r\n        }\r\n        else if ('path' in event && event.path.length) {\r\n            return event.path[0];\r\n        }\r\n    }\r\n    catch (_a) {\r\n    }\r\n    return event && event.target;\r\n}\r\nfunction initMutationObserver(options, rootEl) {\r\n    var _a, _b;\r\n    const mutationBuffer = new MutationBuffer();\r\n    mutationBuffers.push(mutationBuffer);\r\n    mutationBuffer.init(options);\r\n    let mutationObserverCtor = window.MutationObserver ||\r\n        window.__rrMutationObserver;\r\n    const angularZoneSymbol = (_b = (_a = window === null || window === void 0 ? void 0 : window.Zone) === null || _a === void 0 ? void 0 : _a.__symbol__) === null || _b === void 0 ? void 0 : _b.call(_a, 'MutationObserver');\r\n    if (angularZoneSymbol &&\r\n        window[angularZoneSymbol]) {\r\n        mutationObserverCtor = window[angularZoneSymbol];\r\n    }\r\n    const observer = new mutationObserverCtor(callbackWrapper(mutationBuffer.processMutations.bind(mutationBuffer)));\r\n    observer.observe(rootEl, {\r\n        attributes: true,\r\n        attributeOldValue: true,\r\n        characterData: true,\r\n        characterDataOldValue: true,\r\n        childList: true,\r\n        subtree: true,\r\n    });\r\n    return observer;\r\n}\r\nfunction initMoveObserver({ mousemoveCb, sampling, doc, mirror, }) {\r\n    if (sampling.mousemove === false) {\r\n        return () => {\r\n        };\r\n    }\r\n    const threshold = typeof sampling.mousemove === 'number' ? sampling.mousemove : 50;\r\n    const callbackThreshold = typeof sampling.mousemoveCallback === 'number'\r\n        ? sampling.mousemoveCallback\r\n        : 500;\r\n    let positions = [];\r\n    let timeBaseline;\r\n    const wrappedCb = throttle(callbackWrapper((source) => {\r\n        const totalOffset = Date.now() - timeBaseline;\r\n        mousemoveCb(positions.map((p) => {\r\n            p.timeOffset -= totalOffset;\r\n            return p;\r\n        }), source);\r\n        positions = [];\r\n        timeBaseline = null;\r\n    }), callbackThreshold);\r\n    const updatePosition = callbackWrapper(throttle(callbackWrapper((evt) => {\r\n        const target = getEventTarget(evt);\r\n        const { clientX, clientY } = legacy_isTouchEvent(evt)\r\n            ? evt.changedTouches[0]\r\n            : evt;\r\n        if (!timeBaseline) {\r\n            timeBaseline = nowTimestamp();\r\n        }\r\n        positions.push({\r\n            x: clientX,\r\n            y: clientY,\r\n            id: mirror.getId(target),\r\n            timeOffset: nowTimestamp() - timeBaseline,\r\n        });\r\n        wrappedCb(typeof DragEvent !== 'undefined' && evt instanceof DragEvent\r\n            ? IncrementalSource.Drag\r\n            : evt instanceof MouseEvent\r\n                ? IncrementalSource.MouseMove\r\n                : IncrementalSource.TouchMove);\r\n    }), threshold, {\r\n        trailing: false,\r\n    }));\r\n    const handlers = [\r\n        on('mousemove', updatePosition, doc),\r\n        on('touchmove', updatePosition, doc),\r\n        on('drag', updatePosition, doc),\r\n    ];\r\n    return callbackWrapper(() => {\r\n        handlers.forEach((h) => h());\r\n    });\r\n}\r\nfunction initMouseInteractionObserver({ mouseInteractionCb, doc, mirror, blockClass, blockSelector, sampling, }) {\r\n    if (sampling.mouseInteraction === false) {\r\n        return () => {\r\n        };\r\n    }\r\n    const disableMap = sampling.mouseInteraction === true ||\r\n        sampling.mouseInteraction === undefined\r\n        ? {}\r\n        : sampling.mouseInteraction;\r\n    const handlers = [];\r\n    let currentPointerType = null;\r\n    const getHandler = (eventKey) => {\r\n        return (event) => {\r\n            const target = getEventTarget(event);\r\n            if (isBlocked(target, blockClass, blockSelector, true)) {\r\n                return;\r\n            }\r\n            let pointerType = null;\r\n            let thisEventKey = eventKey;\r\n            if ('pointerType' in event) {\r\n                switch (event.pointerType) {\r\n                    case 'mouse':\r\n                        pointerType = PointerTypes.Mouse;\r\n                        break;\r\n                    case 'touch':\r\n                        pointerType = PointerTypes.Touch;\r\n                        break;\r\n                    case 'pen':\r\n                        pointerType = PointerTypes.Pen;\r\n                        break;\r\n                }\r\n                if (pointerType === PointerTypes.Touch) {\r\n                    if (MouseInteractions[eventKey] === MouseInteractions.MouseDown) {\r\n                        thisEventKey = 'TouchStart';\r\n                    }\r\n                    else if (MouseInteractions[eventKey] === MouseInteractions.MouseUp) {\r\n                        thisEventKey = 'TouchEnd';\r\n                    }\r\n                }\r\n                else if (pointerType === PointerTypes.Pen) ;\r\n            }\r\n            else if (legacy_isTouchEvent(event)) {\r\n                pointerType = PointerTypes.Touch;\r\n            }\r\n            if (pointerType !== null) {\r\n                currentPointerType = pointerType;\r\n                if ((thisEventKey.startsWith('Touch') &&\r\n                    pointerType === PointerTypes.Touch) ||\r\n                    (thisEventKey.startsWith('Mouse') &&\r\n                        pointerType === PointerTypes.Mouse)) {\r\n                    pointerType = null;\r\n                }\r\n            }\r\n            else if (MouseInteractions[eventKey] === MouseInteractions.Click) {\r\n                pointerType = currentPointerType;\r\n                currentPointerType = null;\r\n            }\r\n            const e = legacy_isTouchEvent(event) ? event.changedTouches[0] : event;\r\n            if (!e) {\r\n                return;\r\n            }\r\n            const id = mirror.getId(target);\r\n            const { clientX, clientY } = e;\r\n            callbackWrapper(mouseInteractionCb)(Object.assign({ type: MouseInteractions[thisEventKey], id, x: clientX, y: clientY }, (pointerType !== null && { pointerType })));\r\n        };\r\n    };\r\n    Object.keys(MouseInteractions)\r\n        .filter((key) => Number.isNaN(Number(key)) &&\r\n        !key.endsWith('_Departed') &&\r\n        disableMap[key] !== false)\r\n        .forEach((eventKey) => {\r\n        let eventName = toLowerCase(eventKey);\r\n        const handler = getHandler(eventKey);\r\n        if (window.PointerEvent) {\r\n            switch (MouseInteractions[eventKey]) {\r\n                case MouseInteractions.MouseDown:\r\n                case MouseInteractions.MouseUp:\r\n                    eventName = eventName.replace('mouse', 'pointer');\r\n                    break;\r\n                case MouseInteractions.TouchStart:\r\n                case MouseInteractions.TouchEnd:\r\n                    return;\r\n            }\r\n        }\r\n        handlers.push(on(eventName, handler, doc));\r\n    });\r\n    return callbackWrapper(() => {\r\n        handlers.forEach((h) => h());\r\n    });\r\n}\r\nfunction initScrollObserver({ scrollCb, doc, mirror, blockClass, blockSelector, sampling, }) {\r\n    const updatePosition = callbackWrapper(throttle(callbackWrapper((evt) => {\r\n        const target = getEventTarget(evt);\r\n        if (!target ||\r\n            isBlocked(target, blockClass, blockSelector, true)) {\r\n            return;\r\n        }\r\n        const id = mirror.getId(target);\r\n        if (target === doc && doc.defaultView) {\r\n            const scrollLeftTop = getWindowScroll(doc.defaultView);\r\n            scrollCb({\r\n                id,\r\n                x: scrollLeftTop.left,\r\n                y: scrollLeftTop.top,\r\n            });\r\n        }\r\n        else {\r\n            scrollCb({\r\n                id,\r\n                x: target.scrollLeft,\r\n                y: target.scrollTop,\r\n            });\r\n        }\r\n    }), sampling.scroll || 100));\r\n    return on('scroll', updatePosition, doc);\r\n}\r\nfunction initViewportResizeObserver({ viewportResizeCb }, { win }) {\r\n    let lastH = -1;\r\n    let lastW = -1;\r\n    const updateDimension = callbackWrapper(throttle(callbackWrapper(() => {\r\n        const height = getWindowHeight();\r\n        const width = getWindowWidth();\r\n        if (lastH !== height || lastW !== width) {\r\n            viewportResizeCb({\r\n                width: Number(width),\r\n                height: Number(height),\r\n            });\r\n            lastH = height;\r\n            lastW = width;\r\n        }\r\n    }), 200));\r\n    return on('resize', updateDimension, win);\r\n}\r\nconst INPUT_TAGS = ['INPUT', 'TEXTAREA', 'SELECT'];\r\nconst lastInputValueMap = new WeakMap();\r\nfunction initInputObserver({ inputCb, doc, mirror, blockClass, blockSelector, ignoreClass, ignoreSelector, maskInputOptions, maskInputFn, sampling, userTriggeredOnInput, }) {\r\n    function eventHandler(event) {\r\n        let target = getEventTarget(event);\r\n        const userTriggered = event.isTrusted;\r\n        const tagName = target && target.tagName;\r\n        if (target && tagName === 'OPTION') {\r\n            target = target.parentElement;\r\n        }\r\n        if (!target ||\r\n            !tagName ||\r\n            INPUT_TAGS.indexOf(tagName) < 0 ||\r\n            isBlocked(target, blockClass, blockSelector, true)) {\r\n            return;\r\n        }\r\n        if (target.classList.contains(ignoreClass) ||\r\n            (ignoreSelector && target.matches(ignoreSelector))) {\r\n            return;\r\n        }\r\n        let text = target.value;\r\n        let isChecked = false;\r\n        const type = getInputType(target) || '';\r\n        if (type === 'radio' || type === 'checkbox') {\r\n            isChecked = target.checked;\r\n        }\r\n        else if (maskInputOptions[tagName.toLowerCase()] ||\r\n            maskInputOptions[type]) {\r\n            text = maskInputValue({\r\n                element: target,\r\n                maskInputOptions,\r\n                tagName,\r\n                type,\r\n                value: text,\r\n                maskInputFn,\r\n            });\r\n        }\r\n        cbWithDedup(target, userTriggeredOnInput\r\n            ? { text, isChecked, userTriggered }\r\n            : { text, isChecked });\r\n        const name = target.name;\r\n        if (type === 'radio' && name && isChecked) {\r\n            doc\r\n                .querySelectorAll(`input[type=\"radio\"][name=\"${name}\"]`)\r\n                .forEach((el) => {\r\n                if (el !== target) {\r\n                    const text = el.value;\r\n                    cbWithDedup(el, userTriggeredOnInput\r\n                        ? { text, isChecked: !isChecked, userTriggered: false }\r\n                        : { text, isChecked: !isChecked });\r\n                }\r\n            });\r\n        }\r\n    }\r\n    function cbWithDedup(target, v) {\r\n        const lastInputValue = lastInputValueMap.get(target);\r\n        if (!lastInputValue ||\r\n            lastInputValue.text !== v.text ||\r\n            lastInputValue.isChecked !== v.isChecked) {\r\n            lastInputValueMap.set(target, v);\r\n            const id = mirror.getId(target);\r\n            callbackWrapper(inputCb)(Object.assign(Object.assign({}, v), { id }));\r\n        }\r\n    }\r\n    const events = sampling.input === 'last' ? ['change'] : ['input', 'change'];\r\n    const handlers = events.map((eventName) => on(eventName, callbackWrapper(eventHandler), doc));\r\n    const currentWindow = doc.defaultView;\r\n    if (!currentWindow) {\r\n        return () => {\r\n            handlers.forEach((h) => h());\r\n        };\r\n    }\r\n    const propertyDescriptor = currentWindow.Object.getOwnPropertyDescriptor(currentWindow.HTMLInputElement.prototype, 'value');\r\n    const hookProperties = [\r\n        [currentWindow.HTMLInputElement.prototype, 'value'],\r\n        [currentWindow.HTMLInputElement.prototype, 'checked'],\r\n        [currentWindow.HTMLSelectElement.prototype, 'value'],\r\n        [currentWindow.HTMLTextAreaElement.prototype, 'value'],\r\n        [currentWindow.HTMLSelectElement.prototype, 'selectedIndex'],\r\n        [currentWindow.HTMLOptionElement.prototype, 'selected'],\r\n    ];\r\n    if (propertyDescriptor && propertyDescriptor.set) {\r\n        handlers.push(...hookProperties.map((p) => hookSetter(p[0], p[1], {\r\n            set() {\r\n                callbackWrapper(eventHandler)({\r\n                    target: this,\r\n                    isTrusted: false,\r\n                });\r\n            },\r\n        }, false, currentWindow)));\r\n    }\r\n    return callbackWrapper(() => {\r\n        handlers.forEach((h) => h());\r\n    });\r\n}\r\nfunction getNestedCSSRulePositions(rule) {\r\n    const positions = [];\r\n    function recurse(childRule, pos) {\r\n        if ((hasNestedCSSRule('CSSGroupingRule') &&\r\n            childRule.parentRule instanceof CSSGroupingRule) ||\r\n            (hasNestedCSSRule('CSSMediaRule') &&\r\n                childRule.parentRule instanceof CSSMediaRule) ||\r\n            (hasNestedCSSRule('CSSSupportsRule') &&\r\n                childRule.parentRule instanceof CSSSupportsRule) ||\r\n            (hasNestedCSSRule('CSSConditionRule') &&\r\n                childRule.parentRule instanceof CSSConditionRule)) {\r\n            const rules = Array.from(childRule.parentRule.cssRules);\r\n            const index = rules.indexOf(childRule);\r\n            pos.unshift(index);\r\n        }\r\n        else if (childRule.parentStyleSheet) {\r\n            const rules = Array.from(childRule.parentStyleSheet.cssRules);\r\n            const index = rules.indexOf(childRule);\r\n            pos.unshift(index);\r\n        }\r\n        return pos;\r\n    }\r\n    return recurse(rule, positions);\r\n}\r\nfunction getIdAndStyleId(sheet, mirror, styleMirror) {\r\n    let id, styleId;\r\n    if (!sheet)\r\n        return {};\r\n    if (sheet.ownerNode)\r\n        id = mirror.getId(sheet.ownerNode);\r\n    else\r\n        styleId = styleMirror.getId(sheet);\r\n    return {\r\n        styleId,\r\n        id,\r\n    };\r\n}\r\nfunction initStyleSheetObserver({ styleSheetRuleCb, mirror, stylesheetManager }, { win }) {\r\n    if (!win.CSSStyleSheet || !win.CSSStyleSheet.prototype) {\r\n        return () => {\r\n        };\r\n    }\r\n    const insertRule = win.CSSStyleSheet.prototype.insertRule;\r\n    win.CSSStyleSheet.prototype.insertRule = new Proxy(insertRule, {\r\n        apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n            const [rule, index] = argumentsList;\r\n            const { id, styleId } = getIdAndStyleId(thisArg, mirror, stylesheetManager.styleMirror);\r\n            if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                styleSheetRuleCb({\r\n                    id,\r\n                    styleId,\r\n                    adds: [{ rule, index }],\r\n                });\r\n            }\r\n            return target.apply(thisArg, argumentsList);\r\n        }),\r\n    });\r\n    const deleteRule = win.CSSStyleSheet.prototype.deleteRule;\r\n    win.CSSStyleSheet.prototype.deleteRule = new Proxy(deleteRule, {\r\n        apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n            const [index] = argumentsList;\r\n            const { id, styleId } = getIdAndStyleId(thisArg, mirror, stylesheetManager.styleMirror);\r\n            if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                styleSheetRuleCb({\r\n                    id,\r\n                    styleId,\r\n                    removes: [{ index }],\r\n                });\r\n            }\r\n            return target.apply(thisArg, argumentsList);\r\n        }),\r\n    });\r\n    let replace;\r\n    if (win.CSSStyleSheet.prototype.replace) {\r\n        replace = win.CSSStyleSheet.prototype.replace;\r\n        win.CSSStyleSheet.prototype.replace = new Proxy(replace, {\r\n            apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n                const [text] = argumentsList;\r\n                const { id, styleId } = getIdAndStyleId(thisArg, mirror, stylesheetManager.styleMirror);\r\n                if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                    styleSheetRuleCb({\r\n                        id,\r\n                        styleId,\r\n                        replace: text,\r\n                    });\r\n                }\r\n                return target.apply(thisArg, argumentsList);\r\n            }),\r\n        });\r\n    }\r\n    let replaceSync;\r\n    if (win.CSSStyleSheet.prototype.replaceSync) {\r\n        replaceSync = win.CSSStyleSheet.prototype.replaceSync;\r\n        win.CSSStyleSheet.prototype.replaceSync = new Proxy(replaceSync, {\r\n            apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n                const [text] = argumentsList;\r\n                const { id, styleId } = getIdAndStyleId(thisArg, mirror, stylesheetManager.styleMirror);\r\n                if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                    styleSheetRuleCb({\r\n                        id,\r\n                        styleId,\r\n                        replaceSync: text,\r\n                    });\r\n                }\r\n                return target.apply(thisArg, argumentsList);\r\n            }),\r\n        });\r\n    }\r\n    const supportedNestedCSSRuleTypes = {};\r\n    if (canMonkeyPatchNestedCSSRule('CSSGroupingRule')) {\r\n        supportedNestedCSSRuleTypes.CSSGroupingRule = win.CSSGroupingRule;\r\n    }\r\n    else {\r\n        if (canMonkeyPatchNestedCSSRule('CSSMediaRule')) {\r\n            supportedNestedCSSRuleTypes.CSSMediaRule = win.CSSMediaRule;\r\n        }\r\n        if (canMonkeyPatchNestedCSSRule('CSSConditionRule')) {\r\n            supportedNestedCSSRuleTypes.CSSConditionRule = win.CSSConditionRule;\r\n        }\r\n        if (canMonkeyPatchNestedCSSRule('CSSSupportsRule')) {\r\n            supportedNestedCSSRuleTypes.CSSSupportsRule = win.CSSSupportsRule;\r\n        }\r\n    }\r\n    const unmodifiedFunctions = {};\r\n    Object.entries(supportedNestedCSSRuleTypes).forEach(([typeKey, type]) => {\r\n        unmodifiedFunctions[typeKey] = {\r\n            insertRule: type.prototype.insertRule,\r\n            deleteRule: type.prototype.deleteRule,\r\n        };\r\n        type.prototype.insertRule = new Proxy(unmodifiedFunctions[typeKey].insertRule, {\r\n            apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n                const [rule, index] = argumentsList;\r\n                const { id, styleId } = getIdAndStyleId(thisArg.parentStyleSheet, mirror, stylesheetManager.styleMirror);\r\n                if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                    styleSheetRuleCb({\r\n                        id,\r\n                        styleId,\r\n                        adds: [\r\n                            {\r\n                                rule,\r\n                                index: [\r\n                                    ...getNestedCSSRulePositions(thisArg),\r\n                                    index || 0,\r\n                                ],\r\n                            },\r\n                        ],\r\n                    });\r\n                }\r\n                return target.apply(thisArg, argumentsList);\r\n            }),\r\n        });\r\n        type.prototype.deleteRule = new Proxy(unmodifiedFunctions[typeKey].deleteRule, {\r\n            apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n                const [index] = argumentsList;\r\n                const { id, styleId } = getIdAndStyleId(thisArg.parentStyleSheet, mirror, stylesheetManager.styleMirror);\r\n                if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                    styleSheetRuleCb({\r\n                        id,\r\n                        styleId,\r\n                        removes: [\r\n                            { index: [...getNestedCSSRulePositions(thisArg), index] },\r\n                        ],\r\n                    });\r\n                }\r\n                return target.apply(thisArg, argumentsList);\r\n            }),\r\n        });\r\n    });\r\n    return callbackWrapper(() => {\r\n        win.CSSStyleSheet.prototype.insertRule = insertRule;\r\n        win.CSSStyleSheet.prototype.deleteRule = deleteRule;\r\n        replace && (win.CSSStyleSheet.prototype.replace = replace);\r\n        replaceSync && (win.CSSStyleSheet.prototype.replaceSync = replaceSync);\r\n        Object.entries(supportedNestedCSSRuleTypes).forEach(([typeKey, type]) => {\r\n            type.prototype.insertRule = unmodifiedFunctions[typeKey].insertRule;\r\n            type.prototype.deleteRule = unmodifiedFunctions[typeKey].deleteRule;\r\n        });\r\n    });\r\n}\r\nfunction initAdoptedStyleSheetObserver({ mirror, stylesheetManager, }, host) {\r\n    var _a, _b, _c;\r\n    let hostId = null;\r\n    if (host.nodeName === '#document')\r\n        hostId = mirror.getId(host);\r\n    else\r\n        hostId = mirror.getId(host.host);\r\n    const patchTarget = host.nodeName === '#document'\r\n        ? (_a = host.defaultView) === null || _a === void 0 ? void 0 : _a.Document\r\n        : (_c = (_b = host.ownerDocument) === null || _b === void 0 ? void 0 : _b.defaultView) === null || _c === void 0 ? void 0 : _c.ShadowRoot;\r\n    const originalPropertyDescriptor = (patchTarget === null || patchTarget === void 0 ? void 0 : patchTarget.prototype)\r\n        ? Object.getOwnPropertyDescriptor(patchTarget === null || patchTarget === void 0 ? void 0 : patchTarget.prototype, 'adoptedStyleSheets')\r\n        : undefined;\r\n    if (hostId === null ||\r\n        hostId === -1 ||\r\n        !patchTarget ||\r\n        !originalPropertyDescriptor)\r\n        return () => {\r\n        };\r\n    Object.defineProperty(host, 'adoptedStyleSheets', {\r\n        configurable: originalPropertyDescriptor.configurable,\r\n        enumerable: originalPropertyDescriptor.enumerable,\r\n        get() {\r\n            var _a;\r\n            return (_a = originalPropertyDescriptor.get) === null || _a === void 0 ? void 0 : _a.call(this);\r\n        },\r\n        set(sheets) {\r\n            var _a;\r\n            const result = (_a = originalPropertyDescriptor.set) === null || _a === void 0 ? void 0 : _a.call(this, sheets);\r\n            if (hostId !== null && hostId !== -1) {\r\n                try {\r\n                    stylesheetManager.adoptStyleSheets(sheets, hostId);\r\n                }\r\n                catch (e) {\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n    });\r\n    return callbackWrapper(() => {\r\n        Object.defineProperty(host, 'adoptedStyleSheets', {\r\n            configurable: originalPropertyDescriptor.configurable,\r\n            enumerable: originalPropertyDescriptor.enumerable,\r\n            get: originalPropertyDescriptor.get,\r\n            set: originalPropertyDescriptor.set,\r\n        });\r\n    });\r\n}\r\nfunction initStyleDeclarationObserver({ styleDeclarationCb, mirror, ignoreCSSAttributes, stylesheetManager, }, { win }) {\r\n    const setProperty = win.CSSStyleDeclaration.prototype.setProperty;\r\n    win.CSSStyleDeclaration.prototype.setProperty = new Proxy(setProperty, {\r\n        apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n            var _a;\r\n            const [property, value, priority] = argumentsList;\r\n            if (ignoreCSSAttributes.has(property)) {\r\n                return setProperty.apply(thisArg, [property, value, priority]);\r\n            }\r\n            const { id, styleId } = getIdAndStyleId((_a = thisArg.parentRule) === null || _a === void 0 ? void 0 : _a.parentStyleSheet, mirror, stylesheetManager.styleMirror);\r\n            if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                styleDeclarationCb({\r\n                    id,\r\n                    styleId,\r\n                    set: {\r\n                        property,\r\n                        value,\r\n                        priority,\r\n                    },\r\n                    index: getNestedCSSRulePositions(thisArg.parentRule),\r\n                });\r\n            }\r\n            return target.apply(thisArg, argumentsList);\r\n        }),\r\n    });\r\n    const removeProperty = win.CSSStyleDeclaration.prototype.removeProperty;\r\n    win.CSSStyleDeclaration.prototype.removeProperty = new Proxy(removeProperty, {\r\n        apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n            var _a;\r\n            const [property] = argumentsList;\r\n            if (ignoreCSSAttributes.has(property)) {\r\n                return removeProperty.apply(thisArg, [property]);\r\n            }\r\n            const { id, styleId } = getIdAndStyleId((_a = thisArg.parentRule) === null || _a === void 0 ? void 0 : _a.parentStyleSheet, mirror, stylesheetManager.styleMirror);\r\n            if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                styleDeclarationCb({\r\n                    id,\r\n                    styleId,\r\n                    remove: {\r\n                        property,\r\n                    },\r\n                    index: getNestedCSSRulePositions(thisArg.parentRule),\r\n                });\r\n            }\r\n            return target.apply(thisArg, argumentsList);\r\n        }),\r\n    });\r\n    return callbackWrapper(() => {\r\n        win.CSSStyleDeclaration.prototype.setProperty = setProperty;\r\n        win.CSSStyleDeclaration.prototype.removeProperty = removeProperty;\r\n    });\r\n}\r\nfunction initMediaInteractionObserver({ mediaInteractionCb, blockClass, blockSelector, mirror, sampling, doc, }) {\r\n    const handler = callbackWrapper((type) => throttle(callbackWrapper((event) => {\r\n        const target = getEventTarget(event);\r\n        if (!target ||\r\n            isBlocked(target, blockClass, blockSelector, true)) {\r\n            return;\r\n        }\r\n        const { currentTime, volume, muted, playbackRate, loop } = target;\r\n        mediaInteractionCb({\r\n            type,\r\n            id: mirror.getId(target),\r\n            currentTime,\r\n            volume,\r\n            muted,\r\n            playbackRate,\r\n            loop,\r\n        });\r\n    }), sampling.media || 500));\r\n    const handlers = [\r\n        on('play', handler(0), doc),\r\n        on('pause', handler(1), doc),\r\n        on('seeked', handler(2), doc),\r\n        on('volumechange', handler(3), doc),\r\n        on('ratechange', handler(4), doc),\r\n    ];\r\n    return callbackWrapper(() => {\r\n        handlers.forEach((h) => h());\r\n    });\r\n}\r\nfunction initFontObserver({ fontCb, doc }) {\r\n    const win = doc.defaultView;\r\n    if (!win) {\r\n        return () => {\r\n        };\r\n    }\r\n    const handlers = [];\r\n    const fontMap = new WeakMap();\r\n    const originalFontFace = win.FontFace;\r\n    win.FontFace = function FontFace(family, source, descriptors) {\r\n        const fontFace = new originalFontFace(family, source, descriptors);\r\n        fontMap.set(fontFace, {\r\n            family,\r\n            buffer: typeof source !== 'string',\r\n            descriptors,\r\n            fontSource: typeof source === 'string'\r\n                ? source\r\n                : JSON.stringify(Array.from(new Uint8Array(source))),\r\n        });\r\n        return fontFace;\r\n    };\r\n    const restoreHandler = patch(doc.fonts, 'add', function (original) {\r\n        return function (fontFace) {\r\n            setTimeout(callbackWrapper(() => {\r\n                const p = fontMap.get(fontFace);\r\n                if (p) {\r\n                    fontCb(p);\r\n                    fontMap.delete(fontFace);\r\n                }\r\n            }), 0);\r\n            return original.apply(this, [fontFace]);\r\n        };\r\n    });\r\n    handlers.push(() => {\r\n        win.FontFace = originalFontFace;\r\n    });\r\n    handlers.push(restoreHandler);\r\n    return callbackWrapper(() => {\r\n        handlers.forEach((h) => h());\r\n    });\r\n}\r\nfunction initSelectionObserver(param) {\r\n    const { doc, mirror, blockClass, blockSelector, selectionCb } = param;\r\n    let collapsed = true;\r\n    const updateSelection = callbackWrapper(() => {\r\n        const selection = doc.getSelection();\r\n        if (!selection || (collapsed && (selection === null || selection === void 0 ? void 0 : selection.isCollapsed)))\r\n            return;\r\n        collapsed = selection.isCollapsed || false;\r\n        const ranges = [];\r\n        const count = selection.rangeCount || 0;\r\n        for (let i = 0; i < count; i++) {\r\n            const range = selection.getRangeAt(i);\r\n            const { startContainer, startOffset, endContainer, endOffset } = range;\r\n            const blocked = isBlocked(startContainer, blockClass, blockSelector, true) ||\r\n                isBlocked(endContainer, blockClass, blockSelector, true);\r\n            if (blocked)\r\n                continue;\r\n            ranges.push({\r\n                start: mirror.getId(startContainer),\r\n                startOffset,\r\n                end: mirror.getId(endContainer),\r\n                endOffset,\r\n            });\r\n        }\r\n        selectionCb({ ranges });\r\n    });\r\n    updateSelection();\r\n    return on('selectionchange', updateSelection);\r\n}\r\nfunction initCustomElementObserver({ doc, customElementCb, }) {\r\n    const win = doc.defaultView;\r\n    if (!win || !win.customElements)\r\n        return () => { };\r\n    const restoreHandler = patch(win.customElements, 'define', function (original) {\r\n        return function (name, constructor, options) {\r\n            try {\r\n                customElementCb({\r\n                    define: {\r\n                        name,\r\n                    },\r\n                });\r\n            }\r\n            catch (e) {\r\n                console.warn(`Custom element callback failed for ${name}`);\r\n            }\r\n            return original.apply(this, [name, constructor, options]);\r\n        };\r\n    });\r\n    return restoreHandler;\r\n}\r\nfunction mergeHooks(o, hooks) {\r\n    const { mutationCb, mousemoveCb, mouseInteractionCb, scrollCb, viewportResizeCb, inputCb, mediaInteractionCb, styleSheetRuleCb, styleDeclarationCb, canvasMutationCb, fontCb, selectionCb, customElementCb, } = o;\r\n    o.mutationCb = (...p) => {\r\n        if (hooks.mutation) {\r\n            hooks.mutation(...p);\r\n        }\r\n        mutationCb(...p);\r\n    };\r\n    o.mousemoveCb = (...p) => {\r\n        if (hooks.mousemove) {\r\n            hooks.mousemove(...p);\r\n        }\r\n        mousemoveCb(...p);\r\n    };\r\n    o.mouseInteractionCb = (...p) => {\r\n        if (hooks.mouseInteraction) {\r\n            hooks.mouseInteraction(...p);\r\n        }\r\n        mouseInteractionCb(...p);\r\n    };\r\n    o.scrollCb = (...p) => {\r\n        if (hooks.scroll) {\r\n            hooks.scroll(...p);\r\n        }\r\n        scrollCb(...p);\r\n    };\r\n    o.viewportResizeCb = (...p) => {\r\n        if (hooks.viewportResize) {\r\n            hooks.viewportResize(...p);\r\n        }\r\n        viewportResizeCb(...p);\r\n    };\r\n    o.inputCb = (...p) => {\r\n        if (hooks.input) {\r\n            hooks.input(...p);\r\n        }\r\n        inputCb(...p);\r\n    };\r\n    o.mediaInteractionCb = (...p) => {\r\n        if (hooks.mediaInteaction) {\r\n            hooks.mediaInteaction(...p);\r\n        }\r\n        mediaInteractionCb(...p);\r\n    };\r\n    o.styleSheetRuleCb = (...p) => {\r\n        if (hooks.styleSheetRule) {\r\n            hooks.styleSheetRule(...p);\r\n        }\r\n        styleSheetRuleCb(...p);\r\n    };\r\n    o.styleDeclarationCb = (...p) => {\r\n        if (hooks.styleDeclaration) {\r\n            hooks.styleDeclaration(...p);\r\n        }\r\n        styleDeclarationCb(...p);\r\n    };\r\n    o.canvasMutationCb = (...p) => {\r\n        if (hooks.canvasMutation) {\r\n            hooks.canvasMutation(...p);\r\n        }\r\n        canvasMutationCb(...p);\r\n    };\r\n    o.fontCb = (...p) => {\r\n        if (hooks.font) {\r\n            hooks.font(...p);\r\n        }\r\n        fontCb(...p);\r\n    };\r\n    o.selectionCb = (...p) => {\r\n        if (hooks.selection) {\r\n            hooks.selection(...p);\r\n        }\r\n        selectionCb(...p);\r\n    };\r\n    o.customElementCb = (...c) => {\r\n        if (hooks.customElement) {\r\n            hooks.customElement(...c);\r\n        }\r\n        customElementCb(...c);\r\n    };\r\n}\r\nfunction initObservers(o, hooks = {}) {\r\n    const currentWindow = o.doc.defaultView;\r\n    if (!currentWindow) {\r\n        return () => {\r\n        };\r\n    }\r\n    mergeHooks(o, hooks);\r\n    let mutationObserver;\r\n    if (o.recordDOM) {\r\n        mutationObserver = initMutationObserver(o, o.doc);\r\n    }\r\n    const mousemoveHandler = initMoveObserver(o);\r\n    const mouseInteractionHandler = initMouseInteractionObserver(o);\r\n    const scrollHandler = initScrollObserver(o);\r\n    const viewportResizeHandler = initViewportResizeObserver(o, {\r\n        win: currentWindow,\r\n    });\r\n    const inputHandler = initInputObserver(o);\r\n    const mediaInteractionHandler = initMediaInteractionObserver(o);\r\n    let styleSheetObserver = () => { };\r\n    let adoptedStyleSheetObserver = () => { };\r\n    let styleDeclarationObserver = () => { };\r\n    let fontObserver = () => { };\r\n    if (o.recordDOM) {\r\n        styleSheetObserver = initStyleSheetObserver(o, { win: currentWindow });\r\n        adoptedStyleSheetObserver = initAdoptedStyleSheetObserver(o, o.doc);\r\n        styleDeclarationObserver = initStyleDeclarationObserver(o, {\r\n            win: currentWindow,\r\n        });\r\n        if (o.collectFonts) {\r\n            fontObserver = initFontObserver(o);\r\n        }\r\n    }\r\n    const selectionObserver = initSelectionObserver(o);\r\n    const customElementObserver = initCustomElementObserver(o);\r\n    const pluginHandlers = [];\r\n    for (const plugin of o.plugins) {\r\n        pluginHandlers.push(plugin.observer(plugin.callback, currentWindow, plugin.options));\r\n    }\r\n    return callbackWrapper(() => {\r\n        mutationBuffers.forEach((b) => b.reset());\r\n        mutationObserver === null || mutationObserver === void 0 ? void 0 : mutationObserver.disconnect();\r\n        mousemoveHandler();\r\n        mouseInteractionHandler();\r\n        scrollHandler();\r\n        viewportResizeHandler();\r\n        inputHandler();\r\n        mediaInteractionHandler();\r\n        styleSheetObserver();\r\n        adoptedStyleSheetObserver();\r\n        styleDeclarationObserver();\r\n        fontObserver();\r\n        selectionObserver();\r\n        customElementObserver();\r\n        pluginHandlers.forEach((h) => h());\r\n    });\r\n}\r\nfunction hasNestedCSSRule(prop) {\r\n    return typeof window[prop] !== 'undefined';\r\n}\r\nfunction canMonkeyPatchNestedCSSRule(prop) {\r\n    return Boolean(typeof window[prop] !== 'undefined' &&\r\n        window[prop].prototype &&\r\n        'insertRule' in window[prop].prototype &&\r\n        'deleteRule' in window[prop].prototype);\r\n}\n\nexport { INPUT_TAGS, initAdoptedStyleSheetObserver, initMutationObserver, initObservers, initScrollObserver, mutationBuffers };\n","class CrossOriginIframeMirror {\r\n    constructor(generateIdFn) {\r\n        this.generateIdFn = generateIdFn;\r\n        this.iframeIdToRemoteIdMap = new WeakMap();\r\n        this.iframeRemoteIdToIdMap = new WeakMap();\r\n    }\r\n    getId(iframe, remoteId, idToRemoteMap, remoteToIdMap) {\r\n        const idToRemoteIdMap = idToRemoteMap || this.getIdToRemoteIdMap(iframe);\r\n        const remoteIdToIdMap = remoteToIdMap || this.getRemoteIdToIdMap(iframe);\r\n        let id = idToRemoteIdMap.get(remoteId);\r\n        if (!id) {\r\n            id = this.generateIdFn();\r\n            idToRemoteIdMap.set(remoteId, id);\r\n            remoteIdToIdMap.set(id, remoteId);\r\n        }\r\n        return id;\r\n    }\r\n    getIds(iframe, remoteId) {\r\n        const idToRemoteIdMap = this.getIdToRemoteIdMap(iframe);\r\n        const remoteIdToIdMap = this.getRemoteIdToIdMap(iframe);\r\n        return remoteId.map((id) => this.getId(iframe, id, idToRemoteIdMap, remoteIdToIdMap));\r\n    }\r\n    getRemoteId(iframe, id, map) {\r\n        const remoteIdToIdMap = map || this.getRemoteIdToIdMap(iframe);\r\n        if (typeof id !== 'number')\r\n            return id;\r\n        const remoteId = remoteIdToIdMap.get(id);\r\n        if (!remoteId)\r\n            return -1;\r\n        return remoteId;\r\n    }\r\n    getRemoteIds(iframe, ids) {\r\n        const remoteIdToIdMap = this.getRemoteIdToIdMap(iframe);\r\n        return ids.map((id) => this.getRemoteId(iframe, id, remoteIdToIdMap));\r\n    }\r\n    reset(iframe) {\r\n        if (!iframe) {\r\n            this.iframeIdToRemoteIdMap = new WeakMap();\r\n            this.iframeRemoteIdToIdMap = new WeakMap();\r\n            return;\r\n        }\r\n        this.iframeIdToRemoteIdMap.delete(iframe);\r\n        this.iframeRemoteIdToIdMap.delete(iframe);\r\n    }\r\n    getIdToRemoteIdMap(iframe) {\r\n        let idToRemoteIdMap = this.iframeIdToRemoteIdMap.get(iframe);\r\n        if (!idToRemoteIdMap) {\r\n            idToRemoteIdMap = new Map();\r\n            this.iframeIdToRemoteIdMap.set(iframe, idToRemoteIdMap);\r\n        }\r\n        return idToRemoteIdMap;\r\n    }\r\n    getRemoteIdToIdMap(iframe) {\r\n        let remoteIdToIdMap = this.iframeRemoteIdToIdMap.get(iframe);\r\n        if (!remoteIdToIdMap) {\r\n            remoteIdToIdMap = new Map();\r\n            this.iframeRemoteIdToIdMap.set(iframe, remoteIdToIdMap);\r\n        }\r\n        return remoteIdToIdMap;\r\n    }\r\n}\n\nexport { CrossOriginIframeMirror as default };\n","import { genId, NodeType } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport CrossOriginIframeMirror from './cross-origin-iframe-mirror.js';\nimport { EventType, IncrementalSource } from '../../../types/dist/types.js';\n\nclass IframeManager {\r\n    constructor(options) {\r\n        this.iframes = new WeakMap();\r\n        this.crossOriginIframeMap = new WeakMap();\r\n        this.crossOriginIframeMirror = new CrossOriginIframeMirror(genId);\r\n        this.crossOriginIframeRootIdMap = new WeakMap();\r\n        this.mutationCb = options.mutationCb;\r\n        this.wrappedEmit = options.wrappedEmit;\r\n        this.stylesheetManager = options.stylesheetManager;\r\n        this.recordCrossOriginIframes = options.recordCrossOriginIframes;\r\n        this.crossOriginIframeStyleMirror = new CrossOriginIframeMirror(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror));\r\n        this.mirror = options.mirror;\r\n        if (this.recordCrossOriginIframes) {\r\n            window.addEventListener('message', this.handleMessage.bind(this));\r\n        }\r\n    }\r\n    addIframe(iframeEl) {\r\n        this.iframes.set(iframeEl, true);\r\n        if (iframeEl.contentWindow)\r\n            this.crossOriginIframeMap.set(iframeEl.contentWindow, iframeEl);\r\n    }\r\n    addLoadListener(cb) {\r\n        this.loadListener = cb;\r\n    }\r\n    attachIframe(iframeEl, childSn) {\r\n        var _a;\r\n        this.mutationCb({\r\n            adds: [\r\n                {\r\n                    parentId: this.mirror.getId(iframeEl),\r\n                    nextId: null,\r\n                    node: childSn,\r\n                },\r\n            ],\r\n            removes: [],\r\n            texts: [],\r\n            attributes: [],\r\n            isAttachIframe: true,\r\n        });\r\n        (_a = this.loadListener) === null || _a === void 0 ? void 0 : _a.call(this, iframeEl);\r\n        if (iframeEl.contentDocument &&\r\n            iframeEl.contentDocument.adoptedStyleSheets &&\r\n            iframeEl.contentDocument.adoptedStyleSheets.length > 0)\r\n            this.stylesheetManager.adoptStyleSheets(iframeEl.contentDocument.adoptedStyleSheets, this.mirror.getId(iframeEl.contentDocument));\r\n    }\r\n    handleMessage(message) {\r\n        const crossOriginMessageEvent = message;\r\n        if (crossOriginMessageEvent.data.type !== 'rrweb' ||\r\n            crossOriginMessageEvent.origin !== crossOriginMessageEvent.data.origin)\r\n            return;\r\n        const iframeSourceWindow = message.source;\r\n        if (!iframeSourceWindow)\r\n            return;\r\n        const iframeEl = this.crossOriginIframeMap.get(message.source);\r\n        if (!iframeEl)\r\n            return;\r\n        const transformedEvent = this.transformCrossOriginEvent(iframeEl, crossOriginMessageEvent.data.event);\r\n        if (transformedEvent)\r\n            this.wrappedEmit(transformedEvent, crossOriginMessageEvent.data.isCheckout);\r\n    }\r\n    transformCrossOriginEvent(iframeEl, e) {\r\n        var _a;\r\n        switch (e.type) {\r\n            case EventType.FullSnapshot: {\r\n                this.crossOriginIframeMirror.reset(iframeEl);\r\n                this.crossOriginIframeStyleMirror.reset(iframeEl);\r\n                this.replaceIdOnNode(e.data.node, iframeEl);\r\n                const rootId = e.data.node.id;\r\n                this.crossOriginIframeRootIdMap.set(iframeEl, rootId);\r\n                this.patchRootIdOnNode(e.data.node, rootId);\r\n                return {\r\n                    timestamp: e.timestamp,\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: {\r\n                        source: IncrementalSource.Mutation,\r\n                        adds: [\r\n                            {\r\n                                parentId: this.mirror.getId(iframeEl),\r\n                                nextId: null,\r\n                                node: e.data.node,\r\n                            },\r\n                        ],\r\n                        removes: [],\r\n                        texts: [],\r\n                        attributes: [],\r\n                        isAttachIframe: true,\r\n                    },\r\n                };\r\n            }\r\n            case EventType.Meta:\r\n            case EventType.Load:\r\n            case EventType.DomContentLoaded: {\r\n                return false;\r\n            }\r\n            case EventType.Plugin: {\r\n                return e;\r\n            }\r\n            case EventType.Custom: {\r\n                this.replaceIds(e.data.payload, iframeEl, ['id', 'parentId', 'previousId', 'nextId']);\r\n                return e;\r\n            }\r\n            case EventType.IncrementalSnapshot: {\r\n                switch (e.data.source) {\r\n                    case IncrementalSource.Mutation: {\r\n                        e.data.adds.forEach((n) => {\r\n                            this.replaceIds(n, iframeEl, [\r\n                                'parentId',\r\n                                'nextId',\r\n                                'previousId',\r\n                            ]);\r\n                            this.replaceIdOnNode(n.node, iframeEl);\r\n                            const rootId = this.crossOriginIframeRootIdMap.get(iframeEl);\r\n                            rootId && this.patchRootIdOnNode(n.node, rootId);\r\n                        });\r\n                        e.data.removes.forEach((n) => {\r\n                            this.replaceIds(n, iframeEl, ['parentId', 'id']);\r\n                        });\r\n                        e.data.attributes.forEach((n) => {\r\n                            this.replaceIds(n, iframeEl, ['id']);\r\n                        });\r\n                        e.data.texts.forEach((n) => {\r\n                            this.replaceIds(n, iframeEl, ['id']);\r\n                        });\r\n                        return e;\r\n                    }\r\n                    case IncrementalSource.Drag:\r\n                    case IncrementalSource.TouchMove:\r\n                    case IncrementalSource.MouseMove: {\r\n                        e.data.positions.forEach((p) => {\r\n                            this.replaceIds(p, iframeEl, ['id']);\r\n                        });\r\n                        return e;\r\n                    }\r\n                    case IncrementalSource.ViewportResize: {\r\n                        return false;\r\n                    }\r\n                    case IncrementalSource.MediaInteraction:\r\n                    case IncrementalSource.MouseInteraction:\r\n                    case IncrementalSource.Scroll:\r\n                    case IncrementalSource.CanvasMutation:\r\n                    case IncrementalSource.Input: {\r\n                        this.replaceIds(e.data, iframeEl, ['id']);\r\n                        return e;\r\n                    }\r\n                    case IncrementalSource.StyleSheetRule:\r\n                    case IncrementalSource.StyleDeclaration: {\r\n                        this.replaceIds(e.data, iframeEl, ['id']);\r\n                        this.replaceStyleIds(e.data, iframeEl, ['styleId']);\r\n                        return e;\r\n                    }\r\n                    case IncrementalSource.Font: {\r\n                        return e;\r\n                    }\r\n                    case IncrementalSource.Selection: {\r\n                        e.data.ranges.forEach((range) => {\r\n                            this.replaceIds(range, iframeEl, ['start', 'end']);\r\n                        });\r\n                        return e;\r\n                    }\r\n                    case IncrementalSource.AdoptedStyleSheet: {\r\n                        this.replaceIds(e.data, iframeEl, ['id']);\r\n                        this.replaceStyleIds(e.data, iframeEl, ['styleIds']);\r\n                        (_a = e.data.styles) === null || _a === void 0 ? void 0 : _a.forEach((style) => {\r\n                            this.replaceStyleIds(style, iframeEl, ['styleId']);\r\n                        });\r\n                        return e;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    replace(iframeMirror, obj, iframeEl, keys) {\r\n        for (const key of keys) {\r\n            if (!Array.isArray(obj[key]) && typeof obj[key] !== 'number')\r\n                continue;\r\n            if (Array.isArray(obj[key])) {\r\n                obj[key] = iframeMirror.getIds(iframeEl, obj[key]);\r\n            }\r\n            else {\r\n                obj[key] = iframeMirror.getId(iframeEl, obj[key]);\r\n            }\r\n        }\r\n        return obj;\r\n    }\r\n    replaceIds(obj, iframeEl, keys) {\r\n        return this.replace(this.crossOriginIframeMirror, obj, iframeEl, keys);\r\n    }\r\n    replaceStyleIds(obj, iframeEl, keys) {\r\n        return this.replace(this.crossOriginIframeStyleMirror, obj, iframeEl, keys);\r\n    }\r\n    replaceIdOnNode(node, iframeEl) {\r\n        this.replaceIds(node, iframeEl, ['id', 'rootId']);\r\n        if ('childNodes' in node) {\r\n            node.childNodes.forEach((child) => {\r\n                this.replaceIdOnNode(child, iframeEl);\r\n            });\r\n        }\r\n    }\r\n    patchRootIdOnNode(node, rootId) {\r\n        if (node.type !== NodeType.Document && !node.rootId)\r\n            node.rootId = rootId;\r\n        if ('childNodes' in node) {\r\n            node.childNodes.forEach((child) => {\r\n                this.patchRootIdOnNode(child, rootId);\r\n            });\r\n        }\r\n    }\r\n}\n\nexport { IframeManager };\n","import { initMutationObserver, initScrollObserver, initAdoptedStyleSheetObserver } from './observer.js';\nimport { patch, inDom } from '../utils.js';\nimport { isNativeShadowDom } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\n\nclass ShadowDomManager {\r\n    constructor(options) {\r\n        this.shadowDoms = new WeakSet();\r\n        this.restoreHandlers = [];\r\n        this.mutationCb = options.mutationCb;\r\n        this.scrollCb = options.scrollCb;\r\n        this.bypassOptions = options.bypassOptions;\r\n        this.mirror = options.mirror;\r\n        this.init();\r\n    }\r\n    init() {\r\n        this.reset();\r\n        this.patchAttachShadow(Element, document);\r\n    }\r\n    addShadowRoot(shadowRoot, doc) {\r\n        if (!isNativeShadowDom(shadowRoot))\r\n            return;\r\n        if (this.shadowDoms.has(shadowRoot))\r\n            return;\r\n        this.shadowDoms.add(shadowRoot);\r\n        const observer = initMutationObserver(Object.assign(Object.assign({}, this.bypassOptions), { doc, mutationCb: this.mutationCb, mirror: this.mirror, shadowDomManager: this }), shadowRoot);\r\n        this.restoreHandlers.push(() => observer.disconnect());\r\n        this.restoreHandlers.push(initScrollObserver(Object.assign(Object.assign({}, this.bypassOptions), { scrollCb: this.scrollCb, doc: shadowRoot, mirror: this.mirror })));\r\n        setTimeout(() => {\r\n            if (shadowRoot.adoptedStyleSheets &&\r\n                shadowRoot.adoptedStyleSheets.length > 0)\r\n                this.bypassOptions.stylesheetManager.adoptStyleSheets(shadowRoot.adoptedStyleSheets, this.mirror.getId(shadowRoot.host));\r\n            this.restoreHandlers.push(initAdoptedStyleSheetObserver({\r\n                mirror: this.mirror,\r\n                stylesheetManager: this.bypassOptions.stylesheetManager,\r\n            }, shadowRoot));\r\n        }, 0);\r\n    }\r\n    observeAttachShadow(iframeElement) {\r\n        if (!iframeElement.contentWindow || !iframeElement.contentDocument)\r\n            return;\r\n        this.patchAttachShadow(iframeElement.contentWindow.Element, iframeElement.contentDocument);\r\n    }\r\n    patchAttachShadow(element, doc) {\r\n        const manager = this;\r\n        this.restoreHandlers.push(patch(element.prototype, 'attachShadow', function (original) {\r\n            return function (option) {\r\n                const shadowRoot = original.call(this, option);\r\n                if (this.shadowRoot && inDom(this))\r\n                    manager.addShadowRoot(this.shadowRoot, doc);\r\n                return shadowRoot;\r\n            };\r\n        }));\r\n    }\r\n    reset() {\r\n        this.restoreHandlers.forEach((handler) => {\r\n            try {\r\n                handler();\r\n            }\r\n            catch (e) {\r\n            }\r\n        });\r\n        this.restoreHandlers = [];\r\n        this.shadowDoms = new WeakSet();\r\n    }\r\n}\n\nexport { ShadowDomManager };\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\nexport { __awaiter, __rest };\n","/*\n * base64-arraybuffer 1.0.1 <https://github.com/niklasvh/base64-arraybuffer>\n * Copyright (c) 2021 Niklas von Hertzen <https://hertzen.com>\n * Released under MIT License\n */\nvar chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n// Use a lookup table to find the index.\nvar lookup = typeof Uint8Array === 'undefined' ? [] : new Uint8Array(256);\nfor (var i = 0; i < chars.length; i++) {\n    lookup[chars.charCodeAt(i)] = i;\n}\nvar encode = function (arraybuffer) {\n    var bytes = new Uint8Array(arraybuffer), i, len = bytes.length, base64 = '';\n    for (i = 0; i < len; i += 3) {\n        base64 += chars[bytes[i] >> 2];\n        base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n        base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n        base64 += chars[bytes[i + 2] & 63];\n    }\n    if (len % 3 === 2) {\n        base64 = base64.substring(0, base64.length - 1) + '=';\n    }\n    else if (len % 3 === 1) {\n        base64 = base64.substring(0, base64.length - 2) + '==';\n    }\n    return base64;\n};\nvar decode = function (base64) {\n    var bufferLength = base64.length * 0.75, len = base64.length, i, p = 0, encoded1, encoded2, encoded3, encoded4;\n    if (base64[base64.length - 1] === '=') {\n        bufferLength--;\n        if (base64[base64.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n    var arraybuffer = new ArrayBuffer(bufferLength), bytes = new Uint8Array(arraybuffer);\n    for (i = 0; i < len; i += 4) {\n        encoded1 = lookup[base64.charCodeAt(i)];\n        encoded2 = lookup[base64.charCodeAt(i + 1)];\n        encoded3 = lookup[base64.charCodeAt(i + 2)];\n        encoded4 = lookup[base64.charCodeAt(i + 3)];\n        bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n        bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n        bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n    }\n    return arraybuffer;\n};\n\nexport { decode, encode };\n","import { encode } from './../../../../../../ext/base64-arraybuffer/dist/base64-arraybuffer.es5.js';\n\nconst canvasVarMap = new Map();\r\nfunction variableListFor(ctx, ctor) {\r\n    let contextMap = canvasVarMap.get(ctx);\r\n    if (!contextMap) {\r\n        contextMap = new Map();\r\n        canvasVarMap.set(ctx, contextMap);\r\n    }\r\n    if (!contextMap.has(ctor)) {\r\n        contextMap.set(ctor, []);\r\n    }\r\n    return contextMap.get(ctor);\r\n}\r\nconst saveWebGLVar = (value, win, ctx) => {\r\n    if (!value ||\r\n        !(isInstanceOfWebGLObject(value, win) || typeof value === 'object'))\r\n        return;\r\n    const name = value.constructor.name;\r\n    const list = variableListFor(ctx, name);\r\n    let index = list.indexOf(value);\r\n    if (index === -1) {\r\n        index = list.length;\r\n        list.push(value);\r\n    }\r\n    return index;\r\n};\r\nfunction serializeArg(value, win, ctx) {\r\n    if (value instanceof Array) {\r\n        return value.map((arg) => serializeArg(arg, win, ctx));\r\n    }\r\n    else if (value === null) {\r\n        return value;\r\n    }\r\n    else if (value instanceof Float32Array ||\r\n        value instanceof Float64Array ||\r\n        value instanceof Int32Array ||\r\n        value instanceof Uint32Array ||\r\n        value instanceof Uint8Array ||\r\n        value instanceof Uint16Array ||\r\n        value instanceof Int16Array ||\r\n        value instanceof Int8Array ||\r\n        value instanceof Uint8ClampedArray) {\r\n        const name = value.constructor.name;\r\n        return {\r\n            rr_type: name,\r\n            args: [Object.values(value)],\r\n        };\r\n    }\r\n    else if (value instanceof ArrayBuffer) {\r\n        const name = value.constructor.name;\r\n        const base64 = encode(value);\r\n        return {\r\n            rr_type: name,\r\n            base64,\r\n        };\r\n    }\r\n    else if (value instanceof DataView) {\r\n        const name = value.constructor.name;\r\n        return {\r\n            rr_type: name,\r\n            args: [\r\n                serializeArg(value.buffer, win, ctx),\r\n                value.byteOffset,\r\n                value.byteLength,\r\n            ],\r\n        };\r\n    }\r\n    else if (value instanceof HTMLImageElement) {\r\n        const name = value.constructor.name;\r\n        const { src } = value;\r\n        return {\r\n            rr_type: name,\r\n            src,\r\n        };\r\n    }\r\n    else if (value instanceof HTMLCanvasElement) {\r\n        const name = 'HTMLImageElement';\r\n        const src = value.toDataURL();\r\n        return {\r\n            rr_type: name,\r\n            src,\r\n        };\r\n    }\r\n    else if (value instanceof ImageData) {\r\n        const name = value.constructor.name;\r\n        return {\r\n            rr_type: name,\r\n            args: [serializeArg(value.data, win, ctx), value.width, value.height],\r\n        };\r\n    }\r\n    else if (isInstanceOfWebGLObject(value, win) || typeof value === 'object') {\r\n        const name = value.constructor.name;\r\n        const index = saveWebGLVar(value, win, ctx);\r\n        return {\r\n            rr_type: name,\r\n            index: index,\r\n        };\r\n    }\r\n    return value;\r\n}\r\nconst serializeArgs = (args, win, ctx) => {\r\n    return args.map((arg) => serializeArg(arg, win, ctx));\r\n};\r\nconst isInstanceOfWebGLObject = (value, win) => {\r\n    const webGLConstructorNames = [\r\n        'WebGLActiveInfo',\r\n        'WebGLBuffer',\r\n        'WebGLFramebuffer',\r\n        'WebGLProgram',\r\n        'WebGLRenderbuffer',\r\n        'WebGLShader',\r\n        'WebGLShaderPrecisionFormat',\r\n        'WebGLTexture',\r\n        'WebGLUniformLocation',\r\n        'WebGLVertexArrayObject',\r\n        'WebGLVertexArrayObjectOES',\r\n    ];\r\n    const supportedWebGLConstructorNames = webGLConstructorNames.filter((name) => typeof win[name] === 'function');\r\n    return Boolean(supportedWebGLConstructorNames.find((name) => value instanceof win[name]));\r\n};\n\nexport { isInstanceOfWebGLObject, saveWebGLVar, serializeArg, serializeArgs, variableListFor };\n","import { patch, isBlocked } from '../../../utils.js';\n\nfunction getNormalizedContextName(contextType) {\r\n    return contextType === 'experimental-webgl' ? 'webgl' : contextType;\r\n}\r\nfunction initCanvasContextObserver(win, blockClass, blockSelector, setPreserveDrawingBufferToTrue) {\r\n    const handlers = [];\r\n    try {\r\n        const restoreHandler = patch(win.HTMLCanvasElement.prototype, 'getContext', function (original) {\r\n            return function (contextType, ...args) {\r\n                if (!isBlocked(this, blockClass, blockSelector, true)) {\r\n                    const ctxName = getNormalizedContextName(contextType);\r\n                    if (!('__context' in this))\r\n                        this.__context = ctxName;\r\n                    if (setPreserveDrawingBufferToTrue &&\r\n                        ['webgl', 'webgl2'].includes(ctxName)) {\r\n                        if (args[0] && typeof args[0] === 'object') {\r\n                            const contextAttributes = args[0];\r\n                            if (!contextAttributes.preserveDrawingBuffer) {\r\n                                contextAttributes.preserveDrawingBuffer = true;\r\n                            }\r\n                        }\r\n                        else {\r\n                            args.splice(0, 1, {\r\n                                preserveDrawingBuffer: true,\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n                return original.apply(this, [contextType, ...args]);\r\n            };\r\n        });\r\n        handlers.push(restoreHandler);\r\n    }\r\n    catch (_a) {\r\n        console.error('failed to patch HTMLCanvasElement.prototype.getContext');\r\n    }\r\n    return () => {\r\n        handlers.forEach((h) => h());\r\n    };\r\n}\n\nexport { initCanvasContextObserver as default };\n","import { CanvasContext } from '../../../../../types/dist/types.js';\nimport { patch, isBlocked, hookSetter } from '../../../utils.js';\nimport { saveWebGLVar, serializeArgs } from './serialize-args.js';\n\nfunction patchGLPrototype(prototype, type, cb, blockClass, blockSelector, mirror, win) {\r\n    const handlers = [];\r\n    const props = Object.getOwnPropertyNames(prototype);\r\n    for (const prop of props) {\r\n        if ([\r\n            'isContextLost',\r\n            'canvas',\r\n            'drawingBufferWidth',\r\n            'drawingBufferHeight',\r\n        ].includes(prop)) {\r\n            continue;\r\n        }\r\n        try {\r\n            if (typeof prototype[prop] !== 'function') {\r\n                continue;\r\n            }\r\n            const restoreHandler = patch(prototype, prop, function (original) {\r\n                return function (...args) {\r\n                    const result = original.apply(this, args);\r\n                    saveWebGLVar(result, win, this);\r\n                    if ('tagName' in this.canvas &&\r\n                        !isBlocked(this.canvas, blockClass, blockSelector, true)) {\r\n                        const recordArgs = serializeArgs(args, win, this);\r\n                        const mutation = {\r\n                            type,\r\n                            property: prop,\r\n                            args: recordArgs,\r\n                        };\r\n                        cb(this.canvas, mutation);\r\n                    }\r\n                    return result;\r\n                };\r\n            });\r\n            handlers.push(restoreHandler);\r\n        }\r\n        catch (_a) {\r\n            const hookHandler = hookSetter(prototype, prop, {\r\n                set(v) {\r\n                    cb(this.canvas, {\r\n                        type,\r\n                        property: prop,\r\n                        args: [v],\r\n                        setter: true,\r\n                    });\r\n                },\r\n            });\r\n            handlers.push(hookHandler);\r\n        }\r\n    }\r\n    return handlers;\r\n}\r\nfunction initCanvasWebGLMutationObserver(cb, win, blockClass, blockSelector, mirror) {\r\n    const handlers = [];\r\n    handlers.push(...patchGLPrototype(win.WebGLRenderingContext.prototype, CanvasContext.WebGL, cb, blockClass, blockSelector, mirror, win));\r\n    if (typeof win.WebGL2RenderingContext !== 'undefined') {\r\n        handlers.push(...patchGLPrototype(win.WebGL2RenderingContext.prototype, CanvasContext.WebGL2, cb, blockClass, blockSelector, mirror, win));\r\n    }\r\n    return () => {\r\n        handlers.forEach((h) => h());\r\n    };\r\n}\n\nexport { initCanvasWebGLMutationObserver as default };\n","import { createInlineWorkerFactory } from './_rollup-plugin-web-worker-loader__helper__browser__createInlineWorkerFactory.js';\n\nvar WorkerFactory = createInlineWorkerFactory(/* rollup-plugin-web-worker-loader */function () {\n(function () {\n    '__worker_loader_strict__';\n\n    /*! *****************************************************************************\r\n    Copyright (c) Microsoft Corporation.\r\n\r\n    Permission to use, copy, modify, and/or distribute this software for any\r\n    purpose with or without fee is hereby granted.\r\n\r\n    THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\n    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\n    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\n    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\n    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\n    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\n    PERFORMANCE OF THIS SOFTWARE.\r\n    ***************************************************************************** */\r\n\r\n    function __awaiter(thisArg, _arguments, P, generator) {\r\n        function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n        return new (P || (P = Promise))(function (resolve, reject) {\r\n            function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n            function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n            function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n            step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n        });\r\n    }\n\n    /*\n     * base64-arraybuffer 1.0.1 <https://github.com/niklasvh/base64-arraybuffer>\n     * Copyright (c) 2021 Niklas von Hertzen <https://hertzen.com>\n     * Released under MIT License\n     */\n    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n    // Use a lookup table to find the index.\n    var lookup = typeof Uint8Array === 'undefined' ? [] : new Uint8Array(256);\n    for (var i = 0; i < chars.length; i++) {\n        lookup[chars.charCodeAt(i)] = i;\n    }\n    var encode = function (arraybuffer) {\n        var bytes = new Uint8Array(arraybuffer), i, len = bytes.length, base64 = '';\n        for (i = 0; i < len; i += 3) {\n            base64 += chars[bytes[i] >> 2];\n            base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n            base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n            base64 += chars[bytes[i + 2] & 63];\n        }\n        if (len % 3 === 2) {\n            base64 = base64.substring(0, base64.length - 1) + '=';\n        }\n        else if (len % 3 === 1) {\n            base64 = base64.substring(0, base64.length - 2) + '==';\n        }\n        return base64;\n    };\n\n    const lastBlobMap = new Map();\r\n    const transparentBlobMap = new Map();\r\n    function getTransparentBlobFor(width, height, dataURLOptions) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const id = `${width}-${height}`;\r\n            if ('OffscreenCanvas' in globalThis) {\r\n                if (transparentBlobMap.has(id))\r\n                    return transparentBlobMap.get(id);\r\n                const offscreen = new OffscreenCanvas(width, height);\r\n                offscreen.getContext('2d');\r\n                const blob = yield offscreen.convertToBlob(dataURLOptions);\r\n                const arrayBuffer = yield blob.arrayBuffer();\r\n                const base64 = encode(arrayBuffer);\r\n                transparentBlobMap.set(id, base64);\r\n                return base64;\r\n            }\r\n            else {\r\n                return '';\r\n            }\r\n        });\r\n    }\r\n    const worker = self;\r\n    worker.onmessage = function (e) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if ('OffscreenCanvas' in globalThis) {\r\n                const { id, bitmap, width, height, dataURLOptions } = e.data;\r\n                const transparentBase64 = getTransparentBlobFor(width, height, dataURLOptions);\r\n                const offscreen = new OffscreenCanvas(width, height);\r\n                const ctx = offscreen.getContext('2d');\r\n                ctx.drawImage(bitmap, 0, 0);\r\n                bitmap.close();\r\n                const blob = yield offscreen.convertToBlob(dataURLOptions);\r\n                const type = blob.type;\r\n                const arrayBuffer = yield blob.arrayBuffer();\r\n                const base64 = encode(arrayBuffer);\r\n                if (!lastBlobMap.has(id) && (yield transparentBase64) === base64) {\r\n                    lastBlobMap.set(id, base64);\r\n                    return worker.postMessage({ id });\r\n                }\r\n                if (lastBlobMap.get(id) === base64)\r\n                    return worker.postMessage({ id });\r\n                worker.postMessage({\r\n                    id,\r\n                    type,\r\n                    base64,\r\n                    width,\r\n                    height,\r\n                });\r\n                lastBlobMap.set(id, base64);\r\n            }\r\n            else {\r\n                return worker.postMessage({ id: e.data.id });\r\n            }\r\n        });\r\n    };\n\n})();\n}, null);\n/* eslint-enable */\n\nexport { WorkerFactory as default };\n","import { funcToSource } from './_rollup-plugin-web-worker-loader__helper__funcToSource.js';\n\nfunction createURL(fn, sourcemapArg) {\n    var lines = funcToSource(fn, sourcemapArg);\n    var blob = new Blob(lines, { type: 'application/javascript' });\n    return URL.createObjectURL(blob);\n}\n\nfunction createInlineWorkerFactory(fn, sourcemapArg) {\n    var url;\n    return function WorkerFactory(options) {\n        url = url || createURL(fn, sourcemapArg);\n        return new Worker(url, options);\n    };\n}\n\nexport { createInlineWorkerFactory };\n","import { createMirror, snapshot } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport { initObservers, mutationBuffers } from './observer.js';\nimport { polyfill, nowTimestamp, on, getWindowWidth, getWindowHeight, getWindowScroll, isSerializedIframe, isSerializedStylesheet, hasShadowRoot } from '../utils.js';\nimport { EventType, IncrementalSource } from '../../../types/dist/types.js';\nimport { IframeManager } from './iframe-manager.js';\nimport { ShadowDomManager } from './shadow-dom-manager.js';\nimport { CanvasManager } from './observers/canvas/canvas-manager.js';\nimport { StylesheetManager } from './stylesheet-manager.js';\nimport ProcessedNodeManager from './processed-node-manager.js';\nimport { callbackWrapper, unregisterErrorHandler, registerErrorHandler } from './error-handler.js';\n\nfunction wrapEvent(e) {\r\n    return Object.assign(Object.assign({}, e), { timestamp: nowTimestamp() });\r\n}\r\nlet wrappedEmit;\r\nlet takeFullSnapshot;\r\nlet canvasManager;\r\nlet recording = false;\r\nconst mirror = createMirror();\r\nfunction record(options = {}) {\r\n    const { emit, checkoutEveryNms, checkoutEveryNth, blockClass = 'rr-block', blockSelector = null, ignoreClass = 'rr-ignore', ignoreSelector = null, maskTextClass = 'rr-mask', maskTextSelector = null, inlineStylesheet = true, maskAllInputs, maskInputOptions: _maskInputOptions, slimDOMOptions: _slimDOMOptions, maskInputFn, maskTextFn, hooks, packFn, sampling = {}, dataURLOptions = {}, mousemoveWait, recordDOM = true, recordCanvas = false, recordCrossOriginIframes = false, recordAfter = options.recordAfter === 'DOMContentLoaded'\r\n        ? options.recordAfter\r\n        : 'load', userTriggeredOnInput = false, collectFonts = false, inlineImages = false, plugins, keepIframeSrcFn = () => false, ignoreCSSAttributes = new Set([]), errorHandler, } = options;\r\n    registerErrorHandler(errorHandler);\r\n    const inEmittingFrame = recordCrossOriginIframes\r\n        ? window.parent === window\r\n        : true;\r\n    let passEmitsToParent = false;\r\n    if (!inEmittingFrame) {\r\n        try {\r\n            if (window.parent.document) {\r\n                passEmitsToParent = false;\r\n            }\r\n        }\r\n        catch (e) {\r\n            passEmitsToParent = true;\r\n        }\r\n    }\r\n    if (inEmittingFrame && !emit) {\r\n        throw new Error('emit function is required');\r\n    }\r\n    if (mousemoveWait !== undefined && sampling.mousemove === undefined) {\r\n        sampling.mousemove = mousemoveWait;\r\n    }\r\n    mirror.reset();\r\n    const maskInputOptions = maskAllInputs === true\r\n        ? {\r\n            color: true,\r\n            date: true,\r\n            'datetime-local': true,\r\n            email: true,\r\n            month: true,\r\n            number: true,\r\n            range: true,\r\n            search: true,\r\n            tel: true,\r\n            text: true,\r\n            time: true,\r\n            url: true,\r\n            week: true,\r\n            textarea: true,\r\n            select: true,\r\n            password: true,\r\n        }\r\n        : _maskInputOptions !== undefined\r\n            ? _maskInputOptions\r\n            : { password: true };\r\n    const slimDOMOptions = _slimDOMOptions === true || _slimDOMOptions === 'all'\r\n        ? {\r\n            script: true,\r\n            comment: true,\r\n            headFavicon: true,\r\n            headWhitespace: true,\r\n            headMetaSocial: true,\r\n            headMetaRobots: true,\r\n            headMetaHttpEquiv: true,\r\n            headMetaVerification: true,\r\n            headMetaAuthorship: _slimDOMOptions === 'all',\r\n            headMetaDescKeywords: _slimDOMOptions === 'all',\r\n        }\r\n        : _slimDOMOptions\r\n            ? _slimDOMOptions\r\n            : {};\r\n    polyfill();\r\n    let lastFullSnapshotEvent;\r\n    let incrementalSnapshotCount = 0;\r\n    const eventProcessor = (e) => {\r\n        for (const plugin of plugins || []) {\r\n            if (plugin.eventProcessor) {\r\n                e = plugin.eventProcessor(e);\r\n            }\r\n        }\r\n        if (packFn &&\r\n            !passEmitsToParent) {\r\n            e = packFn(e);\r\n        }\r\n        return e;\r\n    };\r\n    wrappedEmit = (e, isCheckout) => {\r\n        var _a;\r\n        if (((_a = mutationBuffers[0]) === null || _a === void 0 ? void 0 : _a.isFrozen()) &&\r\n            e.type !== EventType.FullSnapshot &&\r\n            !(e.type === EventType.IncrementalSnapshot &&\r\n                e.data.source === IncrementalSource.Mutation)) {\r\n            mutationBuffers.forEach((buf) => buf.unfreeze());\r\n        }\r\n        if (inEmittingFrame) {\r\n            emit === null || emit === void 0 ? void 0 : emit(eventProcessor(e), isCheckout);\r\n        }\r\n        else if (passEmitsToParent) {\r\n            const message = {\r\n                type: 'rrweb',\r\n                event: eventProcessor(e),\r\n                origin: window.location.origin,\r\n                isCheckout,\r\n            };\r\n            window.parent.postMessage(message, '*');\r\n        }\r\n        if (e.type === EventType.FullSnapshot) {\r\n            lastFullSnapshotEvent = e;\r\n            incrementalSnapshotCount = 0;\r\n        }\r\n        else if (e.type === EventType.IncrementalSnapshot) {\r\n            if (e.data.source === IncrementalSource.Mutation &&\r\n                e.data.isAttachIframe) {\r\n                return;\r\n            }\r\n            incrementalSnapshotCount++;\r\n            const exceedCount = checkoutEveryNth && incrementalSnapshotCount >= checkoutEveryNth;\r\n            const exceedTime = checkoutEveryNms &&\r\n                e.timestamp - lastFullSnapshotEvent.timestamp > checkoutEveryNms;\r\n            if (exceedCount || exceedTime) {\r\n                takeFullSnapshot(true);\r\n            }\r\n        }\r\n    };\r\n    const wrappedMutationEmit = (m) => {\r\n        wrappedEmit(wrapEvent({\r\n            type: EventType.IncrementalSnapshot,\r\n            data: Object.assign({ source: IncrementalSource.Mutation }, m),\r\n        }));\r\n    };\r\n    const wrappedScrollEmit = (p) => wrappedEmit(wrapEvent({\r\n        type: EventType.IncrementalSnapshot,\r\n        data: Object.assign({ source: IncrementalSource.Scroll }, p),\r\n    }));\r\n    const wrappedCanvasMutationEmit = (p) => wrappedEmit(wrapEvent({\r\n        type: EventType.IncrementalSnapshot,\r\n        data: Object.assign({ source: IncrementalSource.CanvasMutation }, p),\r\n    }));\r\n    const wrappedAdoptedStyleSheetEmit = (a) => wrappedEmit(wrapEvent({\r\n        type: EventType.IncrementalSnapshot,\r\n        data: Object.assign({ source: IncrementalSource.AdoptedStyleSheet }, a),\r\n    }));\r\n    const stylesheetManager = new StylesheetManager({\r\n        mutationCb: wrappedMutationEmit,\r\n        adoptedStyleSheetCb: wrappedAdoptedStyleSheetEmit,\r\n    });\r\n    const iframeManager = new IframeManager({\r\n        mirror,\r\n        mutationCb: wrappedMutationEmit,\r\n        stylesheetManager: stylesheetManager,\r\n        recordCrossOriginIframes,\r\n        wrappedEmit,\r\n    });\r\n    for (const plugin of plugins || []) {\r\n        if (plugin.getMirror)\r\n            plugin.getMirror({\r\n                nodeMirror: mirror,\r\n                crossOriginIframeMirror: iframeManager.crossOriginIframeMirror,\r\n                crossOriginIframeStyleMirror: iframeManager.crossOriginIframeStyleMirror,\r\n            });\r\n    }\r\n    const processedNodeManager = new ProcessedNodeManager();\r\n    canvasManager = new CanvasManager({\r\n        recordCanvas,\r\n        mutationCb: wrappedCanvasMutationEmit,\r\n        win: window,\r\n        blockClass,\r\n        blockSelector,\r\n        mirror,\r\n        sampling: sampling.canvas,\r\n        dataURLOptions,\r\n    });\r\n    const shadowDomManager = new ShadowDomManager({\r\n        mutationCb: wrappedMutationEmit,\r\n        scrollCb: wrappedScrollEmit,\r\n        bypassOptions: {\r\n            blockClass,\r\n            blockSelector,\r\n            maskTextClass,\r\n            maskTextSelector,\r\n            inlineStylesheet,\r\n            maskInputOptions,\r\n            dataURLOptions,\r\n            maskTextFn,\r\n            maskInputFn,\r\n            recordCanvas,\r\n            inlineImages,\r\n            sampling,\r\n            slimDOMOptions,\r\n            iframeManager,\r\n            stylesheetManager,\r\n            canvasManager,\r\n            keepIframeSrcFn,\r\n            processedNodeManager,\r\n        },\r\n        mirror,\r\n    });\r\n    takeFullSnapshot = (isCheckout = false) => {\r\n        if (!recordDOM) {\r\n            return;\r\n        }\r\n        wrappedEmit(wrapEvent({\r\n            type: EventType.Meta,\r\n            data: {\r\n                href: window.location.href,\r\n                width: getWindowWidth(),\r\n                height: getWindowHeight(),\r\n            },\r\n        }), isCheckout);\r\n        stylesheetManager.reset();\r\n        shadowDomManager.init();\r\n        mutationBuffers.forEach((buf) => buf.lock());\r\n        const node = snapshot(document, {\r\n            mirror,\r\n            blockClass,\r\n            blockSelector,\r\n            maskTextClass,\r\n            maskTextSelector,\r\n            inlineStylesheet,\r\n            maskAllInputs: maskInputOptions,\r\n            maskTextFn,\r\n            slimDOM: slimDOMOptions,\r\n            dataURLOptions,\r\n            recordCanvas,\r\n            inlineImages,\r\n            onSerialize: (n) => {\r\n                if (isSerializedIframe(n, mirror)) {\r\n                    iframeManager.addIframe(n);\r\n                }\r\n                if (isSerializedStylesheet(n, mirror)) {\r\n                    stylesheetManager.trackLinkElement(n);\r\n                }\r\n                if (hasShadowRoot(n)) {\r\n                    shadowDomManager.addShadowRoot(n.shadowRoot, document);\r\n                }\r\n            },\r\n            onIframeLoad: (iframe, childSn) => {\r\n                iframeManager.attachIframe(iframe, childSn);\r\n                shadowDomManager.observeAttachShadow(iframe);\r\n            },\r\n            onStylesheetLoad: (linkEl, childSn) => {\r\n                stylesheetManager.attachLinkElement(linkEl, childSn);\r\n            },\r\n            keepIframeSrcFn,\r\n        });\r\n        if (!node) {\r\n            return console.warn('Failed to snapshot the document');\r\n        }\r\n        wrappedEmit(wrapEvent({\r\n            type: EventType.FullSnapshot,\r\n            data: {\r\n                node,\r\n                initialOffset: getWindowScroll(window),\r\n            },\r\n        }), isCheckout);\r\n        mutationBuffers.forEach((buf) => buf.unlock());\r\n        if (document.adoptedStyleSheets && document.adoptedStyleSheets.length > 0)\r\n            stylesheetManager.adoptStyleSheets(document.adoptedStyleSheets, mirror.getId(document));\r\n    };\r\n    try {\r\n        const handlers = [];\r\n        const observe = (doc) => {\r\n            var _a;\r\n            return callbackWrapper(initObservers)({\r\n                mutationCb: wrappedMutationEmit,\r\n                mousemoveCb: (positions, source) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: {\r\n                        source,\r\n                        positions,\r\n                    },\r\n                })),\r\n                mouseInteractionCb: (d) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.MouseInteraction }, d),\r\n                })),\r\n                scrollCb: wrappedScrollEmit,\r\n                viewportResizeCb: (d) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.ViewportResize }, d),\r\n                })),\r\n                inputCb: (v) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.Input }, v),\r\n                })),\r\n                mediaInteractionCb: (p) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.MediaInteraction }, p),\r\n                })),\r\n                styleSheetRuleCb: (r) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.StyleSheetRule }, r),\r\n                })),\r\n                styleDeclarationCb: (r) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.StyleDeclaration }, r),\r\n                })),\r\n                canvasMutationCb: wrappedCanvasMutationEmit,\r\n                fontCb: (p) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.Font }, p),\r\n                })),\r\n                selectionCb: (p) => {\r\n                    wrappedEmit(wrapEvent({\r\n                        type: EventType.IncrementalSnapshot,\r\n                        data: Object.assign({ source: IncrementalSource.Selection }, p),\r\n                    }));\r\n                },\r\n                customElementCb: (c) => {\r\n                    wrappedEmit(wrapEvent({\r\n                        type: EventType.IncrementalSnapshot,\r\n                        data: Object.assign({ source: IncrementalSource.CustomElement }, c),\r\n                    }));\r\n                },\r\n                blockClass,\r\n                ignoreClass,\r\n                ignoreSelector,\r\n                maskTextClass,\r\n                maskTextSelector,\r\n                maskInputOptions,\r\n                inlineStylesheet,\r\n                sampling,\r\n                recordDOM,\r\n                recordCanvas,\r\n                inlineImages,\r\n                userTriggeredOnInput,\r\n                collectFonts,\r\n                doc,\r\n                maskInputFn,\r\n                maskTextFn,\r\n                keepIframeSrcFn,\r\n                blockSelector,\r\n                slimDOMOptions,\r\n                dataURLOptions,\r\n                mirror,\r\n                iframeManager,\r\n                stylesheetManager,\r\n                shadowDomManager,\r\n                processedNodeManager,\r\n                canvasManager,\r\n                ignoreCSSAttributes,\r\n                plugins: ((_a = plugins === null || plugins === void 0 ? void 0 : plugins.filter((p) => p.observer)) === null || _a === void 0 ? void 0 : _a.map((p) => ({\r\n                    observer: p.observer,\r\n                    options: p.options,\r\n                    callback: (payload) => wrappedEmit(wrapEvent({\r\n                        type: EventType.Plugin,\r\n                        data: {\r\n                            plugin: p.name,\r\n                            payload,\r\n                        },\r\n                    })),\r\n                }))) || [],\r\n            }, hooks);\r\n        };\r\n        iframeManager.addLoadListener((iframeEl) => {\r\n            try {\r\n                handlers.push(observe(iframeEl.contentDocument));\r\n            }\r\n            catch (error) {\r\n                console.warn(error);\r\n            }\r\n        });\r\n        const init = () => {\r\n            takeFullSnapshot();\r\n            handlers.push(observe(document));\r\n            recording = true;\r\n        };\r\n        if (document.readyState === 'interactive' ||\r\n            document.readyState === 'complete') {\r\n            init();\r\n        }\r\n        else {\r\n            handlers.push(on('DOMContentLoaded', () => {\r\n                wrappedEmit(wrapEvent({\r\n                    type: EventType.DomContentLoaded,\r\n                    data: {},\r\n                }));\r\n                if (recordAfter === 'DOMContentLoaded')\r\n                    init();\r\n            }));\r\n            handlers.push(on('load', () => {\r\n                wrappedEmit(wrapEvent({\r\n                    type: EventType.Load,\r\n                    data: {},\r\n                }));\r\n                if (recordAfter === 'load')\r\n                    init();\r\n            }, window));\r\n        }\r\n        return () => {\r\n            handlers.forEach((h) => h());\r\n            processedNodeManager.destroy();\r\n            recording = false;\r\n            unregisterErrorHandler();\r\n        };\r\n    }\r\n    catch (error) {\r\n        console.warn(error);\r\n    }\r\n}\r\nrecord.addCustomEvent = (tag, payload) => {\r\n    if (!recording) {\r\n        throw new Error('please add custom event after start recording');\r\n    }\r\n    wrappedEmit(wrapEvent({\r\n        type: EventType.Custom,\r\n        data: {\r\n            tag,\r\n            payload,\r\n        },\r\n    }));\r\n};\r\nrecord.freezePage = () => {\r\n    mutationBuffers.forEach((buf) => buf.freeze());\r\n};\r\nrecord.takeFullSnapshot = (isCheckout) => {\r\n    if (!recording) {\r\n        throw new Error('please take full snapshot after start recording');\r\n    }\r\n    takeFullSnapshot(isCheckout);\r\n};\r\nrecord.mirror = mirror;\n\nexport { record as default };\n","function funcToSource(fn, sourcemapArg) {\n    var sourcemap = sourcemapArg === undefined ? null : sourcemapArg;\n    var source = fn.toString();\n    var lines = source.split('\\n');\n    lines.pop();\n    lines.shift();\n    var blankPrefixLength = lines[0].search(/\\S/);\n    var regex = /(['\"])__worker_loader_strict__(['\"])/g;\n    for (var i = 0, n = lines.length; i < n; ++i) {\n        lines[i] = lines[i].substring(blankPrefixLength).replace(regex, '$1use strict$2') + '\\n';\n    }\n    if (sourcemap) {\n        lines.push('\\/\\/# sourceMappingURL=' + sourcemap + '\\n');\n    }\n    return lines;\n}\n\nexport { funcToSource };\n","import { __rest, __awaiter } from './../../../../../../ext/tslib/tslib.es6.js';\nimport { isBlocked } from '../../../utils.js';\nimport { CanvasContext } from '../../../../../types/dist/types.js';\nimport initCanvas2DMutationObserver from './2d.js';\nimport initCanvasContextObserver from './canvas.js';\nimport initCanvasWebGLMutationObserver from './webgl.js';\nimport WorkerFactory from '../../../../../../_virtual/image-bitmap-data-url-worker.js';\n\nclass CanvasManager {\r\n    reset() {\r\n        this.pendingCanvasMutations.clear();\r\n        this.resetObservers && this.resetObservers();\r\n    }\r\n    freeze() {\r\n        this.frozen = true;\r\n    }\r\n    unfreeze() {\r\n        this.frozen = false;\r\n    }\r\n    lock() {\r\n        this.locked = true;\r\n    }\r\n    unlock() {\r\n        this.locked = false;\r\n    }\r\n    constructor(options) {\r\n        this.pendingCanvasMutations = new Map();\r\n        this.rafStamps = { latestId: 0, invokeId: null };\r\n        this.frozen = false;\r\n        this.locked = false;\r\n        this.processMutation = (target, mutation) => {\r\n            const newFrame = this.rafStamps.invokeId &&\r\n                this.rafStamps.latestId !== this.rafStamps.invokeId;\r\n            if (newFrame || !this.rafStamps.invokeId)\r\n                this.rafStamps.invokeId = this.rafStamps.latestId;\r\n            if (!this.pendingCanvasMutations.has(target)) {\r\n                this.pendingCanvasMutations.set(target, []);\r\n            }\r\n            this.pendingCanvasMutations.get(target).push(mutation);\r\n        };\r\n        const { sampling = 'all', win, blockClass, blockSelector, recordCanvas, dataURLOptions, } = options;\r\n        this.mutationCb = options.mutationCb;\r\n        this.mirror = options.mirror;\r\n        if (recordCanvas && sampling === 'all')\r\n            this.initCanvasMutationObserver(win, blockClass, blockSelector);\r\n        if (recordCanvas && typeof sampling === 'number')\r\n            this.initCanvasFPSObserver(sampling, win, blockClass, blockSelector, {\r\n                dataURLOptions,\r\n            });\r\n    }\r\n    initCanvasFPSObserver(fps, win, blockClass, blockSelector, options) {\r\n        const canvasContextReset = initCanvasContextObserver(win, blockClass, blockSelector, true);\r\n        const snapshotInProgressMap = new Map();\r\n        const worker = new WorkerFactory();\r\n        worker.onmessage = (e) => {\r\n            const { id } = e.data;\r\n            snapshotInProgressMap.set(id, false);\r\n            if (!('base64' in e.data))\r\n                return;\r\n            const { base64, type, width, height } = e.data;\r\n            this.mutationCb({\r\n                id,\r\n                type: CanvasContext['2D'],\r\n                commands: [\r\n                    {\r\n                        property: 'clearRect',\r\n                        args: [0, 0, width, height],\r\n                    },\r\n                    {\r\n                        property: 'drawImage',\r\n                        args: [\r\n                            {\r\n                                rr_type: 'ImageBitmap',\r\n                                args: [\r\n                                    {\r\n                                        rr_type: 'Blob',\r\n                                        data: [{ rr_type: 'ArrayBuffer', base64 }],\r\n                                        type,\r\n                                    },\r\n                                ],\r\n                            },\r\n                            0,\r\n                            0,\r\n                        ],\r\n                    },\r\n                ],\r\n            });\r\n        };\r\n        const timeBetweenSnapshots = 1000 / fps;\r\n        let lastSnapshotTime = 0;\r\n        let rafId;\r\n        const getCanvas = () => {\r\n            const matchedCanvas = [];\r\n            win.document.querySelectorAll('canvas').forEach((canvas) => {\r\n                if (!isBlocked(canvas, blockClass, blockSelector, true)) {\r\n                    matchedCanvas.push(canvas);\r\n                }\r\n            });\r\n            return matchedCanvas;\r\n        };\r\n        const takeCanvasSnapshots = (timestamp) => {\r\n            if (lastSnapshotTime &&\r\n                timestamp - lastSnapshotTime < timeBetweenSnapshots) {\r\n                rafId = requestAnimationFrame(takeCanvasSnapshots);\r\n                return;\r\n            }\r\n            lastSnapshotTime = timestamp;\r\n            getCanvas()\r\n                .forEach((canvas) => __awaiter(this, void 0, void 0, function* () {\r\n                var _a;\r\n                const id = this.mirror.getId(canvas);\r\n                if (snapshotInProgressMap.get(id))\r\n                    return;\r\n                if (canvas.width === 0 || canvas.height === 0)\r\n                    return;\r\n                snapshotInProgressMap.set(id, true);\r\n                if (['webgl', 'webgl2'].includes(canvas.__context)) {\r\n                    const context = canvas.getContext(canvas.__context);\r\n                    if (((_a = context === null || context === void 0 ? void 0 : context.getContextAttributes()) === null || _a === void 0 ? void 0 : _a.preserveDrawingBuffer) === false) {\r\n                        context.clear(context.COLOR_BUFFER_BIT);\r\n                    }\r\n                }\r\n                const bitmap = yield createImageBitmap(canvas);\r\n                worker.postMessage({\r\n                    id,\r\n                    bitmap,\r\n                    width: canvas.width,\r\n                    height: canvas.height,\r\n                    dataURLOptions: options.dataURLOptions,\r\n                }, [bitmap]);\r\n            }));\r\n            rafId = requestAnimationFrame(takeCanvasSnapshots);\r\n        };\r\n        rafId = requestAnimationFrame(takeCanvasSnapshots);\r\n        this.resetObservers = () => {\r\n            canvasContextReset();\r\n            cancelAnimationFrame(rafId);\r\n        };\r\n    }\r\n    initCanvasMutationObserver(win, blockClass, blockSelector) {\r\n        this.startRAFTimestamping();\r\n        this.startPendingCanvasMutationFlusher();\r\n        const canvasContextReset = initCanvasContextObserver(win, blockClass, blockSelector, false);\r\n        const canvas2DReset = initCanvas2DMutationObserver(this.processMutation.bind(this), win, blockClass, blockSelector);\r\n        const canvasWebGL1and2Reset = initCanvasWebGLMutationObserver(this.processMutation.bind(this), win, blockClass, blockSelector, this.mirror);\r\n        this.resetObservers = () => {\r\n            canvasContextReset();\r\n            canvas2DReset();\r\n            canvasWebGL1and2Reset();\r\n        };\r\n    }\r\n    startPendingCanvasMutationFlusher() {\r\n        requestAnimationFrame(() => this.flushPendingCanvasMutations());\r\n    }\r\n    startRAFTimestamping() {\r\n        const setLatestRAFTimestamp = (timestamp) => {\r\n            this.rafStamps.latestId = timestamp;\r\n            requestAnimationFrame(setLatestRAFTimestamp);\r\n        };\r\n        requestAnimationFrame(setLatestRAFTimestamp);\r\n    }\r\n    flushPendingCanvasMutations() {\r\n        this.pendingCanvasMutations.forEach((values, canvas) => {\r\n            const id = this.mirror.getId(canvas);\r\n            this.flushPendingCanvasMutationFor(canvas, id);\r\n        });\r\n        requestAnimationFrame(() => this.flushPendingCanvasMutations());\r\n    }\r\n    flushPendingCanvasMutationFor(canvas, id) {\r\n        if (this.frozen || this.locked) {\r\n            return;\r\n        }\r\n        const valuesWithType = this.pendingCanvasMutations.get(canvas);\r\n        if (!valuesWithType || id === -1)\r\n            return;\r\n        const values = valuesWithType.map((value) => {\r\n            const rest = __rest(value, [\"type\"]);\r\n            return rest;\r\n        });\r\n        const { type } = valuesWithType[0];\r\n        this.mutationCb({ id, type, commands: values });\r\n        this.pendingCanvasMutations.delete(canvas);\r\n    }\r\n}\n\nexport { CanvasManager };\n","import { CanvasContext } from '../../../../../types/dist/types.js';\nimport { patch, isBlocked, hookSetter } from '../../../utils.js';\nimport { serializeArgs } from './serialize-args.js';\n\nfunction initCanvas2DMutationObserver(cb, win, blockClass, blockSelector) {\r\n    const handlers = [];\r\n    const props2D = Object.getOwnPropertyNames(win.CanvasRenderingContext2D.prototype);\r\n    for (const prop of props2D) {\r\n        try {\r\n            if (typeof win.CanvasRenderingContext2D.prototype[prop] !== 'function') {\r\n                continue;\r\n            }\r\n            const restoreHandler = patch(win.CanvasRenderingContext2D.prototype, prop, function (original) {\r\n                return function (...args) {\r\n                    if (!isBlocked(this.canvas, blockClass, blockSelector, true)) {\r\n                        setTimeout(() => {\r\n                            const recordArgs = serializeArgs(args, win, this);\r\n                            cb(this.canvas, {\r\n                                type: CanvasContext['2D'],\r\n                                property: prop,\r\n                                args: recordArgs,\r\n                            });\r\n                        }, 0);\r\n                    }\r\n                    return original.apply(this, args);\r\n                };\r\n            });\r\n            handlers.push(restoreHandler);\r\n        }\r\n        catch (_a) {\r\n            const hookHandler = hookSetter(win.CanvasRenderingContext2D.prototype, prop, {\r\n                set(v) {\r\n                    cb(this.canvas, {\r\n                        type: CanvasContext['2D'],\r\n                        property: prop,\r\n                        args: [v],\r\n                        setter: true,\r\n                    });\r\n                },\r\n            });\r\n            handlers.push(hookHandler);\r\n        }\r\n    }\r\n    return () => {\r\n        handlers.forEach((h) => h());\r\n    };\r\n}\n\nexport { initCanvas2DMutationObserver as default };\n","import { stringifyRule } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport { StyleSheetMirror } from '../utils.js';\n\nclass StylesheetManager {\r\n    constructor(options) {\r\n        this.trackedLinkElements = new WeakSet();\r\n        this.styleMirror = new StyleSheetMirror();\r\n        this.mutationCb = options.mutationCb;\r\n        this.adoptedStyleSheetCb = options.adoptedStyleSheetCb;\r\n    }\r\n    attachLinkElement(linkEl, childSn) {\r\n        if ('_cssText' in childSn.attributes)\r\n            this.mutationCb({\r\n                adds: [],\r\n                removes: [],\r\n                texts: [],\r\n                attributes: [\r\n                    {\r\n                        id: childSn.id,\r\n                        attributes: childSn\r\n                            .attributes,\r\n                    },\r\n                ],\r\n            });\r\n        this.trackLinkElement(linkEl);\r\n    }\r\n    trackLinkElement(linkEl) {\r\n        if (this.trackedLinkElements.has(linkEl))\r\n            return;\r\n        this.trackedLinkElements.add(linkEl);\r\n        this.trackStylesheetInLinkElement(linkEl);\r\n    }\r\n    adoptStyleSheets(sheets, hostId) {\r\n        if (sheets.length === 0)\r\n            return;\r\n        const adoptedStyleSheetData = {\r\n            id: hostId,\r\n            styleIds: [],\r\n        };\r\n        const styles = [];\r\n        for (const sheet of sheets) {\r\n            let styleId;\r\n            if (!this.styleMirror.has(sheet)) {\r\n                styleId = this.styleMirror.add(sheet);\r\n                styles.push({\r\n                    styleId,\r\n                    rules: Array.from(sheet.rules || CSSRule, (r, index) => ({\r\n                        rule: stringifyRule(r),\r\n                        index,\r\n                    })),\r\n                });\r\n            }\r\n            else\r\n                styleId = this.styleMirror.getId(sheet);\r\n            adoptedStyleSheetData.styleIds.push(styleId);\r\n        }\r\n        if (styles.length > 0)\r\n            adoptedStyleSheetData.styles = styles;\r\n        this.adoptedStyleSheetCb(adoptedStyleSheetData);\r\n    }\r\n    reset() {\r\n        this.styleMirror.reset();\r\n        this.trackedLinkElements = new WeakSet();\r\n    }\r\n    trackStylesheetInLinkElement(linkEl) {\r\n    }\r\n}\n\nexport { StylesheetManager };\n","class ProcessedNodeManager {\r\n    constructor() {\r\n        this.nodeMap = new WeakMap();\r\n        this.loop = true;\r\n        this.periodicallyClear();\r\n    }\r\n    periodicallyClear() {\r\n        requestAnimationFrame(() => {\r\n            this.clear();\r\n            if (this.loop)\r\n                this.periodicallyClear();\r\n        });\r\n    }\r\n    inOtherBuffer(node, thisBuffer) {\r\n        const buffers = this.nodeMap.get(node);\r\n        return (buffers && Array.from(buffers).some((buffer) => buffer !== thisBuffer));\r\n    }\r\n    add(node, buffer) {\r\n        this.nodeMap.set(node, (this.nodeMap.get(node) || new Set()).add(buffer));\r\n    }\r\n    clear() {\r\n        this.nodeMap = new WeakMap();\r\n    }\r\n    destroy() {\r\n        this.loop = false;\r\n    }\r\n}\n\nexport { ProcessedNodeManager as default };\n","class StackFrame {\r\n    constructor(obj) {\r\n        this.fileName = obj.fileName || '';\r\n        this.functionName = obj.functionName || '';\r\n        this.lineNumber = obj.lineNumber;\r\n        this.columnNumber = obj.columnNumber;\r\n    }\r\n    toString() {\r\n        const lineNumber = this.lineNumber || '';\r\n        const columnNumber = this.columnNumber || '';\r\n        if (this.functionName)\r\n            return `${this.functionName} (${this.fileName}:${lineNumber}:${columnNumber})`;\r\n        return `${this.fileName}:${lineNumber}:${columnNumber}`;\r\n    }\r\n}\r\nconst FIREFOX_SAFARI_STACK_REGEXP = /(^|@)\\S+:\\d+/;\r\nconst CHROME_IE_STACK_REGEXP = /^\\s*at .*(\\S+:\\d+|\\(native\\))/m;\r\nconst SAFARI_NATIVE_CODE_REGEXP = /^(eval@)?(\\[native code])?$/;\r\nconst ErrorStackParser = {\r\n    parse: function (error) {\r\n        if (!error) {\r\n            return [];\r\n        }\r\n        if (typeof error.stacktrace !== 'undefined' ||\r\n            typeof error['opera#sourceloc'] !== 'undefined') {\r\n            return this.parseOpera(error);\r\n        }\r\n        else if (error.stack && error.stack.match(CHROME_IE_STACK_REGEXP)) {\r\n            return this.parseV8OrIE(error);\r\n        }\r\n        else if (error.stack) {\r\n            return this.parseFFOrSafari(error);\r\n        }\r\n        else {\r\n            console.warn('[console-record-plugin]: Failed to parse error object:', error);\r\n            return [];\r\n        }\r\n    },\r\n    extractLocation: function (urlLike) {\r\n        if (urlLike.indexOf(':') === -1) {\r\n            return [urlLike];\r\n        }\r\n        const regExp = /(.+?)(?::(\\d+))?(?::(\\d+))?$/;\r\n        const parts = regExp.exec(urlLike.replace(/[()]/g, ''));\r\n        if (!parts)\r\n            throw new Error(`Cannot parse given url: ${urlLike}`);\r\n        return [parts[1], parts[2] || undefined, parts[3] || undefined];\r\n    },\r\n    parseV8OrIE: function (error) {\r\n        const filtered = error.stack.split('\\n').filter(function (line) {\r\n            return !!line.match(CHROME_IE_STACK_REGEXP);\r\n        }, this);\r\n        return filtered.map(function (line) {\r\n            if (line.indexOf('(eval ') > -1) {\r\n                line = line\r\n                    .replace(/eval code/g, 'eval')\r\n                    .replace(/(\\(eval at [^()]*)|(\\),.*$)/g, '');\r\n            }\r\n            let sanitizedLine = line.replace(/^\\s+/, '').replace(/\\(eval code/g, '(');\r\n            const location = sanitizedLine.match(/ (\\((.+):(\\d+):(\\d+)\\)$)/);\r\n            sanitizedLine = location\r\n                ? sanitizedLine.replace(location[0], '')\r\n                : sanitizedLine;\r\n            const tokens = sanitizedLine.split(/\\s+/).slice(1);\r\n            const locationParts = this.extractLocation(location ? location[1] : tokens.pop());\r\n            const functionName = tokens.join(' ') || undefined;\r\n            const fileName = ['eval', '<anonymous>'].indexOf(locationParts[0]) > -1\r\n                ? undefined\r\n                : locationParts[0];\r\n            return new StackFrame({\r\n                functionName,\r\n                fileName,\r\n                lineNumber: locationParts[1],\r\n                columnNumber: locationParts[2],\r\n            });\r\n        }, this);\r\n    },\r\n    parseFFOrSafari: function (error) {\r\n        const filtered = error.stack.split('\\n').filter(function (line) {\r\n            return !line.match(SAFARI_NATIVE_CODE_REGEXP);\r\n        }, this);\r\n        return filtered.map(function (line) {\r\n            if (line.indexOf(' > eval') > -1) {\r\n                line = line.replace(/ line (\\d+)(?: > eval line \\d+)* > eval:\\d+:\\d+/g, ':$1');\r\n            }\r\n            if (line.indexOf('@') === -1 && line.indexOf(':') === -1) {\r\n                return new StackFrame({\r\n                    functionName: line,\r\n                });\r\n            }\r\n            else {\r\n                const functionNameRegex = /((.*\".+\"[^@]*)?[^@]*)(?:@)/;\r\n                const matches = line.match(functionNameRegex);\r\n                const functionName = matches && matches[1] ? matches[1] : undefined;\r\n                const locationParts = this.extractLocation(line.replace(functionNameRegex, ''));\r\n                return new StackFrame({\r\n                    functionName,\r\n                    fileName: locationParts[0],\r\n                    lineNumber: locationParts[1],\r\n                    columnNumber: locationParts[2],\r\n                });\r\n            }\r\n        }, this);\r\n    },\r\n    parseOpera: function (e) {\r\n        if (!e.stacktrace ||\r\n            (e.message.indexOf('\\n') > -1 &&\r\n                e.message.split('\\n').length > e.stacktrace.split('\\n').length)) {\r\n            return this.parseOpera9(e);\r\n        }\r\n        else if (!e.stack) {\r\n            return this.parseOpera10(e);\r\n        }\r\n        else {\r\n            return this.parseOpera11(e);\r\n        }\r\n    },\r\n    parseOpera9: function (e) {\r\n        const lineRE = /Line (\\d+).*script (?:in )?(\\S+)/i;\r\n        const lines = e.message.split('\\n');\r\n        const result = [];\r\n        for (let i = 2, len = lines.length; i < len; i += 2) {\r\n            const match = lineRE.exec(lines[i]);\r\n            if (match) {\r\n                result.push(new StackFrame({\r\n                    fileName: match[2],\r\n                    lineNumber: parseFloat(match[1]),\r\n                }));\r\n            }\r\n        }\r\n        return result;\r\n    },\r\n    parseOpera10: function (e) {\r\n        const lineRE = /Line (\\d+).*script (?:in )?(\\S+)(?:: In function (\\S+))?$/i;\r\n        const lines = e.stacktrace.split('\\n');\r\n        const result = [];\r\n        for (let i = 0, len = lines.length; i < len; i += 2) {\r\n            const match = lineRE.exec(lines[i]);\r\n            if (match) {\r\n                result.push(new StackFrame({\r\n                    functionName: match[3] || undefined,\r\n                    fileName: match[2],\r\n                    lineNumber: parseFloat(match[1]),\r\n                }));\r\n            }\r\n        }\r\n        return result;\r\n    },\r\n    parseOpera11: function (error) {\r\n        const filtered = error.stack.split('\\n').filter(function (line) {\r\n            return (!!line.match(FIREFOX_SAFARI_STACK_REGEXP) &&\r\n                !line.match(/^Error created at/));\r\n        }, this);\r\n        return filtered.map(function (line) {\r\n            const tokens = line.split('@');\r\n            const locationParts = this.extractLocation(tokens.pop());\r\n            const functionCall = tokens.shift() || '';\r\n            const functionName = functionCall\r\n                .replace(/<anonymous function(: (\\w+))?>/, '$2')\r\n                .replace(/\\([^)]*\\)/g, '') || undefined;\r\n            return new StackFrame({\r\n                functionName,\r\n                fileName: locationParts[0],\r\n                lineNumber: locationParts[1],\r\n                columnNumber: locationParts[2],\r\n            });\r\n        }, this);\r\n    },\r\n};\n\nexport { ErrorStackParser, StackFrame };\n","function pathToSelector(node) {\r\n    if (!node || !node.outerHTML) {\r\n        return '';\r\n    }\r\n    let path = '';\r\n    while (node.parentElement) {\r\n        let name = node.localName;\r\n        if (!name) {\r\n            break;\r\n        }\r\n        name = name.toLowerCase();\r\n        const parent = node.parentElement;\r\n        const domSiblings = [];\r\n        if (parent.children && parent.children.length > 0) {\r\n            for (let i = 0; i < parent.children.length; i++) {\r\n                const sibling = parent.children[i];\r\n                if (sibling.localName && sibling.localName.toLowerCase) {\r\n                    if (sibling.localName.toLowerCase() === name) {\r\n                        domSiblings.push(sibling);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (domSiblings.length > 1) {\r\n            name += `:eq(${domSiblings.indexOf(node)})`;\r\n        }\r\n        path = name + (path ? '>' + path : '');\r\n        node = parent;\r\n    }\r\n    return path;\r\n}\r\nfunction isObject(obj) {\r\n    return Object.prototype.toString.call(obj) === '[object Object]';\r\n}\r\nfunction isObjTooDeep(obj, limit) {\r\n    if (limit === 0) {\r\n        return true;\r\n    }\r\n    const keys = Object.keys(obj);\r\n    for (const key of keys) {\r\n        if (isObject(obj[key]) &&\r\n            isObjTooDeep(obj[key], limit - 1)) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction stringify(obj, stringifyOptions) {\r\n    const options = {\r\n        numOfKeysLimit: 50,\r\n        depthOfLimit: 4,\r\n    };\r\n    Object.assign(options, stringifyOptions);\r\n    const stack = [];\r\n    const keys = [];\r\n    return JSON.stringify(obj, function (key, value) {\r\n        if (stack.length > 0) {\r\n            const thisPos = stack.indexOf(this);\r\n            ~thisPos ? stack.splice(thisPos + 1) : stack.push(this);\r\n            ~thisPos ? keys.splice(thisPos, Infinity, key) : keys.push(key);\r\n            if (~stack.indexOf(value)) {\r\n                if (stack[0] === value) {\r\n                    value = '[Circular ~]';\r\n                }\r\n                else {\r\n                    value =\r\n                        '[Circular ~.' +\r\n                            keys.slice(0, stack.indexOf(value)).join('.') +\r\n                            ']';\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            stack.push(value);\r\n        }\r\n        if (value === null)\r\n            return value;\r\n        if (value === undefined)\r\n            return 'undefined';\r\n        if (shouldIgnore(value)) {\r\n            return toString(value);\r\n        }\r\n        if (typeof value === 'bigint') {\r\n            return value.toString() + 'n';\r\n        }\r\n        if (value instanceof Event) {\r\n            const eventResult = {};\r\n            for (const eventKey in value) {\r\n                const eventValue = value[eventKey];\r\n                if (Array.isArray(eventValue)) {\r\n                    eventResult[eventKey] = pathToSelector((eventValue.length ? eventValue[0] : null));\r\n                }\r\n                else {\r\n                    eventResult[eventKey] = eventValue;\r\n                }\r\n            }\r\n            return eventResult;\r\n        }\r\n        else if (value instanceof Node) {\r\n            if (value instanceof HTMLElement) {\r\n                return value ? value.outerHTML : '';\r\n            }\r\n            return value.nodeName;\r\n        }\r\n        else if (value instanceof Error) {\r\n            return value.stack\r\n                ? value.stack + '\\nEnd of stack for Error object'\r\n                : value.name + ': ' + value.message;\r\n        }\r\n        return value;\r\n    });\r\n    function shouldIgnore(_obj) {\r\n        if (isObject(_obj) && Object.keys(_obj).length > options.numOfKeysLimit) {\r\n            return true;\r\n        }\r\n        if (typeof _obj === 'function') {\r\n            return true;\r\n        }\r\n        if (isObject(_obj) &&\r\n            isObjTooDeep(_obj, options.depthOfLimit)) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    function toString(_obj) {\r\n        let str = _obj.toString();\r\n        if (options.stringLengthLimit && str.length > options.stringLengthLimit) {\r\n            str = `${str.slice(0, options.stringLengthLimit)}...`;\r\n        }\r\n        return str;\r\n    }\r\n}\n\nexport { stringify };\n","import { patch } from '../../../utils.js';\nimport { ErrorStackParser } from './error-stack-parser.js';\nimport { stringify } from './stringify.js';\n\nconst defaultLogOptions = {\r\n    level: [\r\n        'assert',\r\n        'clear',\r\n        'count',\r\n        'countReset',\r\n        'debug',\r\n        'dir',\r\n        'dirxml',\r\n        'error',\r\n        'group',\r\n        'groupCollapsed',\r\n        'groupEnd',\r\n        'info',\r\n        'log',\r\n        'table',\r\n        'time',\r\n        'timeEnd',\r\n        'timeLog',\r\n        'trace',\r\n        'warn',\r\n    ],\r\n    lengthThreshold: 1000,\r\n    logger: 'console',\r\n};\r\nfunction initLogObserver(cb, win, options) {\r\n    const logOptions = (options ? Object.assign({}, defaultLogOptions, options) : defaultLogOptions);\r\n    const loggerType = logOptions.logger;\r\n    if (!loggerType) {\r\n        return () => {\r\n        };\r\n    }\r\n    let logger;\r\n    if (typeof loggerType === 'string') {\r\n        logger = win[loggerType];\r\n    }\r\n    else {\r\n        logger = loggerType;\r\n    }\r\n    let logCount = 0;\r\n    let inStack = false;\r\n    const cancelHandlers = [];\r\n    if (logOptions.level.includes('error')) {\r\n        const errorHandler = (event) => {\r\n            const message = event.message, error = event.error;\r\n            const trace = ErrorStackParser.parse(error).map((stackFrame) => stackFrame.toString());\r\n            const payload = [stringify(message, logOptions.stringifyOptions)];\r\n            cb({\r\n                level: 'error',\r\n                trace,\r\n                payload,\r\n            });\r\n        };\r\n        win.addEventListener('error', errorHandler);\r\n        cancelHandlers.push(() => {\r\n            win.removeEventListener('error', errorHandler);\r\n        });\r\n        const unhandledrejectionHandler = (event) => {\r\n            let error;\r\n            let payload;\r\n            if (event.reason instanceof Error) {\r\n                error = event.reason;\r\n                payload = [\r\n                    stringify(`Uncaught (in promise) ${error.name}: ${error.message}`, logOptions.stringifyOptions),\r\n                ];\r\n            }\r\n            else {\r\n                error = new Error();\r\n                payload = [\r\n                    stringify('Uncaught (in promise)', logOptions.stringifyOptions),\r\n                    stringify(event.reason, logOptions.stringifyOptions),\r\n                ];\r\n            }\r\n            const trace = ErrorStackParser.parse(error).map((stackFrame) => stackFrame.toString());\r\n            cb({\r\n                level: 'error',\r\n                trace,\r\n                payload,\r\n            });\r\n        };\r\n        win.addEventListener('unhandledrejection', unhandledrejectionHandler);\r\n        cancelHandlers.push(() => {\r\n            win.removeEventListener('unhandledrejection', unhandledrejectionHandler);\r\n        });\r\n    }\r\n    for (const levelType of logOptions.level) {\r\n        cancelHandlers.push(replace(logger, levelType));\r\n    }\r\n    return () => {\r\n        cancelHandlers.forEach((h) => h());\r\n    };\r\n    function replace(_logger, level) {\r\n        if (!_logger[level]) {\r\n            return () => {\r\n            };\r\n        }\r\n        return patch(_logger, level, (original) => {\r\n            return (...args) => {\r\n                original.apply(this, args);\r\n                if (inStack) {\r\n                    return;\r\n                }\r\n                inStack = true;\r\n                try {\r\n                    const trace = ErrorStackParser.parse(new Error())\r\n                        .map((stackFrame) => stackFrame.toString())\r\n                        .splice(1);\r\n                    const payload = args.map((s) => stringify(s, logOptions.stringifyOptions));\r\n                    logCount++;\r\n                    if (logCount < logOptions.lengthThreshold) {\r\n                        cb({\r\n                            level,\r\n                            trace,\r\n                            payload,\r\n                        });\r\n                    }\r\n                    else if (logCount === logOptions.lengthThreshold) {\r\n                        cb({\r\n                            level: 'warn',\r\n                            trace: [],\r\n                            payload: [\r\n                                stringify('The number of log records reached the threshold.'),\r\n                            ],\r\n                        });\r\n                    }\r\n                }\r\n                catch (error) {\r\n                    original('rrweb logger error:', error, ...args);\r\n                }\r\n                finally {\r\n                    inStack = false;\r\n                }\r\n            };\r\n        });\r\n    }\r\n}\r\nconst PLUGIN_NAME = 'rrweb/console@1';\r\nconst getRecordConsolePlugin = (options) => ({\r\n    name: PLUGIN_NAME,\r\n    observer: initLogObserver,\r\n    options: options,\r\n});\n\nexport { PLUGIN_NAME, getRecordConsolePlugin };\n","\n//@ts-ignore\nimport { getRecordConsolePlugin } from 'rrweb/es/rrweb/packages/rrweb/src/plugins/console/record'\n\n\nexport const errorplugin = getRecordConsolePlugin({\n    level: ['info', 'log', 'warn', 'error'],\n    lengthThreshold: 2000,\n    stringifyOptions: {\n        stringLengthLimit: 1000,\n        numOfKeysLimit: 100,\n        depthOfLimit: 4,\n    },\n    logger: window.console,\n})","// @ts-ignore\nimport { RecordPlugin } from \"rrweb/es/rrweb/packages/rrweb/src/plugins\";\n// @ts-ignore\nimport { eventWithTime } from \"rrweb/typings/types\";\n\n// Extend the Window interface to include dataLayer\ndeclare global {\n  interface Window {\n    dataLayer: any[];\n  }\n}\n\n// Function to track data layer changes, similar to what you had in the previous script\nfunction trackDataLayerChanges(cb: (event: eventWithTime) => void) {\n  // Ensure window exists and has a dataLayer property\n  if (\n    typeof window !== \"undefined\" &&\n    window.dataLayer &&\n    window.dataLayer.push\n  ) {\n    const originalPush = window.dataLayer.push;\n    window.dataLayer.push = function (...args: any[]) {\n      Array.prototype.forEach.call(args, (event) => {\n        try {\n          const normalizedEvent = normalizeEventName(event.event);\n\n          const ecommerceEvents = [\n            \"add_to_cart\",\n            \"remove_from_cart\",\n            \"begin_checkout\",\n            \"purchase\",\n          ];\n          if (ecommerceEvents.includes(normalizedEvent)) {\n            const dataLayerEvent = {\n              type: \"custom\",\n              data: {\n                tag: normalizedEvent,\n                payload: event,\n              },\n              timestamp: Date.now(),\n            };\n            cb(dataLayerEvent as unknown as eventWithTime);\n          }\n        } catch (e) {\n          //console.error(\"Error processing dataLayer event\", e);\n        }\n      });\n      return originalPush.apply(window.dataLayer, args);\n    };\n  }\n}\n\n// Normalizes event names\nfunction normalizeEventName(eventName: string): string {\n  const eventMapping: { [key: string]: string } = {\n    addToCart: \"add_to_cart\",\n    add_to_cart: \"add_to_cart\",\n    removeFromCart: \"remove_from_cart\",\n    remove_from_cart: \"remove_from_cart\",\n    beginCheckout: \"begin_checkout\",\n    begin_checkout: \"begin_checkout\",\n    purchase: \"purchase\",\n    transaction: \"purchase\",\n  };\n  return eventMapping[eventName] || eventName;\n}\n\nexport const revenuePlugin: RecordPlugin = {\n  name: \"custom/revenue@1\",\n\n  // This observer will listen for events\n  observer(cb: (event: eventWithTime) => void) {\n    trackDataLayerChanges(cb);\n\n    // Return a cleanup function if necessary\n    return () => {\n      // Cleanup code if necessary\n    };\n  },\n\n  options: {},\n\n  reset: () => {},\n};\n","//@ts-ignore\nimport { RecordPlugin } from \"rrweb/es/rrweb/packages/rrweb/src/plugins\";\n//@ts-ignore\nimport { eventWithTime } from \"rrweb/typings/types\";\n\nfunction getXPath(element: HTMLElement, depth: number): string {\n  if (depth == 100) {\n    return \"<UNK>\";\n  }\n\n  if (element.id !== \"\") {\n    return `//*[@id=\"${element.id}\"]`;\n  }\n  if (element === document.body) {\n    return \"/html/body\";\n  }\n\n  let ix = 0;\n  const siblings = element.parentNode?.childNodes;\n  if (siblings) {\n    for (let i = 0; i < siblings.length; i++) {\n      const sibling = siblings[i];\n      if (sibling === element) {\n        return (\n          getXPath(element.parentNode as HTMLElement, depth + 1) +\n          \"/\" +\n          element.tagName.toLowerCase() +\n          `[${ix + 1}]`\n        );\n      }\n      if (sibling.nodeType === 1 && sibling.nodeName === element.nodeName) {\n        ix++;\n      }\n    }\n  }\n  return \"\";\n}\n\nexport const clickedElementPlugin: RecordPlugin<{ foo: string }> = {\n  name: \"sitewiz/clickedElement@1\",\n  observer: (cb: (event: eventWithTime) => void, doc: Document) => {\n    const clickHandler = (event: MouseEvent) => {\n      const target = event.target as HTMLElement;\n      const clickEvent = {\n        type: \"click\",\n        timestamp: Date.now(),\n        target: target.tagName,\n        outerHTML: target.outerHTML,\n        xPath: getXPath(target, 0),\n        x: event.clientX,\n        y: event.clientY,\n      };\n      cb(clickEvent as unknown as eventWithTime);\n    };\n\n    const hoverHandler = (event: MouseEvent) => {\n      const target = event.target as HTMLElement;\n      const hoverEvent = {\n        type: \"hover\",\n        timestamp: Date.now(),\n        target: target.tagName,\n        xPath: getXPath(target, 0),\n        x: event.clientX,\n        y: event.clientY,\n      };\n      cb(hoverEvent as unknown as eventWithTime);\n    };\n\n    doc.addEventListener(\"click\", clickHandler);\n    doc.addEventListener(\"mouseover\", hoverHandler);\n\n    // Return a cleanup function\n    return () => {\n      doc.removeEventListener(\"click\", clickHandler);\n      doc.removeEventListener(\"mouseover\", hoverHandler);\n    };\n  },\n  options: {},\n  reset: () => {},\n};\n","// @ts-ignore\nimport { eventWithTime } from 'rrweb';\n\n\nconst addToCartRegex = /add[\\W_]*cart/i;\n\n\nfunction getClientId(): string {\n  const name = \"_ga=\";\n  const decodedCookie = decodeURIComponent(document.cookie);\n  const ca = decodedCookie.split(\";\");\n  for (let i = 0; i < ca.length; i++) {\n    const c = ca[i].trim();\n    if (c.indexOf(name) == 0) {\n      const gaValue = c.substring(name.length);\n      const parts = gaValue.split(\".\");\n      if (parts.length == 4) {\n        return parts[2] + \".\" + parts[3]; // Extract the client ID part\n      }\n    }\n  }\n  return \"\";\n}\n\nfunction pollForClientId(cb: (event: eventWithTime) => void) {\n  const intervalId = setInterval(() => {\n    const clientId = getClientId();\n    if (clientId) {\n      const clientIdEvent = {\n        clientId: clientId,\n        timestamp: Date.now(),\n      };\n      cb(clientIdEvent as unknown as eventWithTime);\n      \n      // Stop polling after sending the event once\n      clearInterval(intervalId);\n    }\n  }, 2000);\n}\n\nexport const ga4Plugin = {\n\n  name: 'sitewiz/ga4@1',\n  observer: (cb: (event: eventWithTime) => void) => {\n    pollForClientId(cb);\n\n    // Return a cleanup function (if needed)\n    return () => {\n      // Cleanup code if necessary\n    };\n  },\n  options: {},\n  reset: () => {},\n}\n","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\r\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nvar ownKeys = function(o) {\r\n    ownKeys = Object.getOwnPropertyNames || function (o) {\r\n        var ar = [];\r\n        for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\r\n        return ar;\r\n    };\r\n    return ownKeys(o);\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    var r, s = 0;\r\n    function next() {\r\n        while (r = env.stack.pop()) {\r\n            try {\r\n                if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\r\n                if (r.dispose) {\r\n                    var result = r.dispose.call(r.value);\r\n                    if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n                }\r\n                else s |= 1;\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\r\n    if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\r\n        return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\r\n            return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\r\n        });\r\n    }\r\n    return path;\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __esDecorate: __esDecorate,\r\n    __runInitializers: __runInitializers,\r\n    __propKey: __propKey,\r\n    __setFunctionName: __setFunctionName,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n    __rewriteRelativeImportExtension: __rewriteRelativeImportExtension,\r\n};\r\n","// eslint-disable-next-line posthog-js/no-direct-array-check\nconst nativeIsArray = Array.isArray\nconst ObjProto = Object.prototype\nexport const hasOwnProperty = ObjProto.hasOwnProperty\nconst toString = ObjProto.toString\n\nexport const isArray =\n    nativeIsArray ||\n    function (obj: any): obj is any[] {\n        return toString.call(obj) === '[object Array]'\n    }\nexport const isUint8Array = function (x: unknown): x is Uint8Array {\n    return toString.call(x) === '[object Uint8Array]'\n}\n// from a comment on http://dbj.org/dbj/?p=286\n// fails on only one very rare and deliberate custom object:\n// let bomb = { toString : undefined, valueOf: function(o) { return \"function BOMBA!\"; }};\nexport const isFunction = function (f: any): f is (...args: any[]) => any {\n    // eslint-disable-next-line posthog-js/no-direct-function-check\n    return typeof f === 'function'\n}\n// Underscore Addons\nexport const isObject = function (x: unknown): x is Record<string, any> {\n    // eslint-disable-next-line posthog-js/no-direct-object-check\n    return x === Object(x) && !isArray(x)\n}\nexport const isEmptyObject = function (x: unknown): x is Record<string, any> {\n    if (isObject(x)) {\n        for (const key in x) {\n            if (hasOwnProperty.call(x, key)) {\n                return false\n            }\n        }\n        return true\n    }\n    return false\n}\nexport const isUndefined = function (x: unknown): x is undefined {\n    return x === void 0\n}\n\nexport const isString = function (x: unknown): x is string {\n    // eslint-disable-next-line posthog-js/no-direct-string-check\n    return toString.call(x) == '[object String]'\n}\n\nexport const isEmptyString = function (x: unknown): boolean {\n    return isString(x) && x.trim().length === 0\n}\n\nexport const isNull = function (x: unknown): x is null {\n    // eslint-disable-next-line posthog-js/no-direct-null-check\n    return x === null\n}\n\n/*\n    sometimes you want to check if something is null or undefined\n    that's what this is for\n */\nexport const isNullish = function (x: unknown): x is null | undefined {\n    return isUndefined(x) || isNull(x)\n}\n\nexport const isDate = function (x: unknown): x is Date {\n    // eslint-disable-next-line posthog-js/no-direct-date-check\n    return toString.call(x) == '[object Date]'\n}\nexport const isNumber = function (x: unknown): x is number {\n    // eslint-disable-next-line posthog-js/no-direct-number-check\n    return toString.call(x) == '[object Number]'\n}\nexport const isBoolean = function (x: unknown): x is boolean {\n    // eslint-disable-next-line posthog-js/no-direct-boolean-check\n    return toString.call(x) === '[object Boolean]'\n}\n\nexport const isDocument = (x: unknown): x is Document => {\n    // eslint-disable-next-line posthog-js/no-direct-document-check\n    return x instanceof Document\n}\n\nexport const isFormData = (x: unknown): x is FormData => {\n    // eslint-disable-next-line posthog-js/no-direct-form-data-check\n    return x instanceof FormData\n}\n\nexport const isFile = (x: unknown): x is File => {\n    // eslint-disable-next-line posthog-js/no-direct-file-check\n    return x instanceof File\n}\n","import { isArray } from \"./type-utils\";\nconst localDomains = [\"localhost\", \"127.0.0.1\"];\n\nexport const getQueryParam = function (url: string, param: string): string {\n  const queryParams: string = url.split(\"?\")[1] || \"\";\n  const queryParts = queryParams.split(\"&\");\n  let keyValuePair;\n\n  for (let i = 0; i < queryParts.length; i++) {\n    const parts = queryParts[i].split(\"=\");\n    if (parts[0] === param) {\n      keyValuePair = parts;\n      break;\n    }\n  }\n\n  if (!isArray(keyValuePair) || keyValuePair.length < 2) {\n    return \"\";\n  } else {\n    let result = keyValuePair[1];\n    try {\n      result = decodeURIComponent(result);\n    } catch (err) {\n      //console.log('Skipping decoding for malformed query param: ' + result);\n    }\n    return result.replace(/\\+/g, \" \");\n  }\n};\n\nexport const isLocalhost = (): boolean => {\n  return localDomains.includes(location.hostname);\n};\n","import { isNull, isUndefined } from \"./type-utils\"\n\nconst FACEBOOK = 'Facebook'\nconst MOBILE = 'Mobile'\nconst IOS = 'iOS'\nconst ANDROID = 'Android'\nconst TABLET = 'Tablet'\nconst ANDROID_TABLET = ANDROID + ' ' + TABLET\nconst IPAD = 'iPad'\nconst APPLE = 'Apple'\nconst APPLE_WATCH = APPLE + ' Watch'\nconst SAFARI = 'Safari'\nconst BLACKBERRY = 'BlackBerry'\nconst SAMSUNG = 'Samsung'\nconst SAMSUNG_BROWSER = SAMSUNG + 'Browser'\nconst SAMSUNG_INTERNET = SAMSUNG + ' Internet'\nconst CHROME = 'Chrome'\nconst CHROME_OS = CHROME + ' OS'\nconst CHROME_IOS = CHROME + ' ' + IOS\nconst INTERNET_EXPLORER = 'Internet Explorer'\nconst INTERNET_EXPLORER_MOBILE = INTERNET_EXPLORER + ' ' + MOBILE\nconst OPERA = 'Opera'\nconst OPERA_MINI = OPERA + ' Mini'\nconst EDGE = 'Edge'\nconst MICROSOFT_EDGE = 'Microsoft ' + EDGE\nconst FIREFOX = 'Firefox'\nconst FIREFOX_IOS = FIREFOX + ' ' + IOS\nconst NINTENDO = 'Nintendo'\nconst PLAYSTATION = 'PlayStation'\nconst XBOX = 'Xbox'\nconst ANDROID_MOBILE = ANDROID + ' ' + MOBILE\nconst MOBILE_SAFARI = MOBILE + ' ' + SAFARI\nconst WINDOWS = 'Windows'\nconst WINDOWS_PHONE = WINDOWS + ' Phone'\nconst NOKIA = 'Nokia'\nconst OUYA = 'Ouya'\nconst GENERIC = 'Generic'\nconst GENERIC_MOBILE = GENERIC + ' ' + MOBILE.toLowerCase()\nconst GENERIC_TABLET = GENERIC + ' ' + TABLET.toLowerCase()\nconst KONQUEROR = 'Konqueror'\n\nconst BROWSER_VERSION_REGEX_SUFFIX = '(\\\\d+(\\\\.\\\\d+)?)'\nconst DEFAULT_BROWSER_VERSION_REGEX = new RegExp('Version/' + BROWSER_VERSION_REGEX_SUFFIX)\n\nconst XBOX_REGEX = new RegExp(XBOX, 'i')\nconst PLAYSTATION_REGEX = new RegExp(PLAYSTATION + ' \\\\w+', 'i')\nconst NINTENDO_REGEX = new RegExp(NINTENDO + ' \\\\w+', 'i')\nconst BLACKBERRY_REGEX = new RegExp(BLACKBERRY + '|PlayBook|BB10', 'i')\n\nexport const osMatchers: [\n    RegExp,\n    [string, string] | ((match: RegExpMatchArray | null, user_agent: string) => [string, string])\n][] = [\n    [\n        new RegExp(XBOX + '; ' + XBOX + ' (.*?)[);]', 'i'),\n        (match) => {\n            return [XBOX, (match && match[1]) || '']\n        },\n    ],\n    [new RegExp(NINTENDO, 'i'), [NINTENDO, '']],\n    [new RegExp(PLAYSTATION, 'i'), [PLAYSTATION, '']],\n    [BLACKBERRY_REGEX, [BLACKBERRY, '']],\n    [\n        new RegExp(WINDOWS, 'i'),\n        (_, user_agent) => {\n            if (/Phone/.test(user_agent) || /WPDesktop/.test(user_agent)) {\n                return [WINDOWS_PHONE, '']\n            }\n            // not all JS versions support negative lookbehind, so we need two checks here\n            if (new RegExp(MOBILE).test(user_agent) && !/IEMobile\\b/.test(user_agent)) {\n                return [WINDOWS + ' ' + MOBILE, '']\n            }\n            const match = /Windows NT ([0-9.]+)/i.exec(user_agent)\n            if (match && match[1]) {\n                const version = match[1]\n                // let osVersion = windowsVersionMap[version] || ''\n                // if (/arm/i.test(user_agent)) {\n                    // osVersion = 'RT'\n                // }\n                // return [WINDOWS, osVersion]\n            }\n            return [WINDOWS, '']\n        },\n    ],\n    [\n        /((iPhone|iPad|iPod).*?OS (\\d+)_(\\d+)_?(\\d+)?|iPhone)/,\n        (match) => {\n            if (match && match[3]) {\n                const versionParts = [match[3], match[4], match[5] || '0']\n                return [IOS, versionParts.join('.')]\n            }\n            return [IOS, '']\n        },\n    ],\n    [\n        /(watch.*\\/(\\d+\\.\\d+\\.\\d+)|watch os,(\\d+\\.\\d+),)/i,\n        (match) => {\n            // e.g. Watch4,3/5.3.8 (16U680)\n            let version = ''\n            if (match && match.length >= 3) {\n                version = isUndefined(match[2]) ? match[3] : match[2]\n            }\n            return ['watchOS', version]\n        },\n    ],\n    [\n        new RegExp('(' + ANDROID + ' (\\\\d+)\\\\.(\\\\d+)\\\\.?(\\\\d+)?|' + ANDROID + ')', 'i'),\n        (match) => {\n            if (match && match[2]) {\n                const versionParts = [match[2], match[3], match[4] || '0']\n                return [ANDROID, versionParts.join('.')]\n            }\n            return [ANDROID, '']\n        },\n    ],\n    [\n        /Mac OS X (\\d+)[_.](\\d+)[_.]?(\\d+)?/i,\n        (match) => {\n            const result: [string, string] = ['Mac OS X', '']\n            if (match && match[1]) {\n                const versionParts = [match[1], match[2], match[3] || '0']\n                result[1] = versionParts.join('.')\n            }\n            return result\n        },\n    ],\n    [\n        /Mac/i,\n        // mop up a few non-standard UAs that should match mac\n        ['Mac OS X', ''],\n    ],\n    [/CrOS/, [CHROME_OS, '']],\n    [/Linux|debian/i, ['Linux', '']],\n]\n\n\n\nconst includes = function (\n    obj: string,\n    target: string    \n) : boolean {\n    if (isNull(obj)){\n        return false;\n    }\n\n    return obj.indexOf(target) != -1;\n}\n\nfunction isSafari(userAgent: string): boolean {\n    return includes(userAgent, SAFARI) && !includes(userAgent, CHROME) && !includes(userAgent, ANDROID)\n}\n\nconst safariCheck = (ua: string, vendor?: string) => (vendor && includes(vendor, APPLE)) || isSafari(ua)\n\n\nexport const detectBrowser = function (user_agent: string, vendor: string | undefined): string {\n    vendor = vendor || '' // vendor is undefined for at least IE9\n\n    if (includes(user_agent, ' OPR/') && includes(user_agent, 'Mini')) {\n        return OPERA_MINI\n    } else if (includes(user_agent, ' OPR/')) {\n        return OPERA\n    } else if (BLACKBERRY_REGEX.test(user_agent)) {\n        return BLACKBERRY\n    } else if (includes(user_agent, 'IE' + MOBILE) || includes(user_agent, 'WPDesktop')) {\n        return INTERNET_EXPLORER_MOBILE\n    }\n    // https://developer.samsung.com/internet/user-agent-string-format\n    else if (includes(user_agent, SAMSUNG_BROWSER)) {\n        return SAMSUNG_INTERNET\n    } else if (includes(user_agent, EDGE) || includes(user_agent, 'Edg/')) {\n        return MICROSOFT_EDGE\n    } else if (includes(user_agent, 'FBIOS')) {\n        return FACEBOOK + ' ' + MOBILE\n    } else if (includes(user_agent, 'UCWEB') || includes(user_agent, 'UCBrowser')) {\n        return 'UC Browser'\n    } else if (includes(user_agent, 'CriOS')) {\n        return CHROME_IOS // why not just Chrome?\n    } else if (includes(user_agent, 'CrMo')) {\n        return CHROME\n    } else if (includes(user_agent, ANDROID) && includes(user_agent, SAFARI)) {\n        return ANDROID_MOBILE\n    } else if (includes(user_agent, CHROME)) {\n        return CHROME\n    } else if (includes(user_agent, 'FxiOS')) {\n        return FIREFOX_IOS\n    } else if (includes(user_agent.toLowerCase(), KONQUEROR.toLowerCase())) {\n        return KONQUEROR\n    } else if (safariCheck(user_agent, vendor)) {\n        return includes(user_agent, MOBILE) ? MOBILE_SAFARI : SAFARI\n    } else if (includes(user_agent, FIREFOX)) {\n        return FIREFOX\n    } else if (includes(user_agent, 'MSIE') || includes(user_agent, 'Trident/')) {\n        return INTERNET_EXPLORER\n    } else if (includes(user_agent, 'Gecko')) {\n        return FIREFOX\n    }\n\n    return ''\n}\n\n\n\nexport const detectDevice = function (user_agent: string): string {\n    if (NINTENDO_REGEX.test(user_agent)) {\n        return NINTENDO\n    } else if (PLAYSTATION_REGEX.test(user_agent)) {\n        return PLAYSTATION\n    } else if (XBOX_REGEX.test(user_agent)) {\n        return XBOX\n    } else if (new RegExp(OUYA, 'i').test(user_agent)) {\n        return OUYA\n    } else if (new RegExp('(' + WINDOWS_PHONE + '|WPDesktop)', 'i').test(user_agent)) {\n        return WINDOWS_PHONE\n    } else if (/iPad/.test(user_agent)) {\n        return IPAD\n    } else if (/iPod/.test(user_agent)) {\n        return 'iPod Touch'\n    } else if (/iPhone/.test(user_agent)) {\n        return 'iPhone'\n    } else if (/(watch)(?: ?os[,/]|\\d,\\d\\/)[\\d.]+/i.test(user_agent)) {\n        return APPLE_WATCH\n    } else if (BLACKBERRY_REGEX.test(user_agent)) {\n        return BLACKBERRY\n    } else if (/(kobo)\\s(ereader|touch)/i.test(user_agent)) {\n        return 'Kobo'\n    } else if (new RegExp(NOKIA, 'i').test(user_agent)) {\n        return NOKIA\n    } else if (\n        // Kindle Fire without Silk / Echo Show\n        /(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\\))/i.test(user_agent) ||\n        // Kindle Fire HD\n        /(kf[a-z]+)( bui|\\)).+silk\\//i.test(user_agent)\n    ) {\n        return 'Kindle Fire'\n    } else if (/(Android|ZTE)/i.test(user_agent)) {\n        if (\n            !new RegExp(MOBILE).test(user_agent) ||\n            /(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(user_agent)\n        ) {\n            if (\n                (/pixel[\\daxl ]{1,6}/i.test(user_agent) && !/pixel c/i.test(user_agent)) ||\n                /(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(user_agent) ||\n                (/lmy47v/i.test(user_agent) && !/QTAQZ3/i.test(user_agent))\n            ) {\n                return ANDROID\n            }\n            return ANDROID_TABLET\n        } else {\n            return ANDROID\n        }\n    } else if (new RegExp('(pda|' + MOBILE + ')', 'i').test(user_agent)) {\n        return GENERIC_MOBILE\n    } else if (new RegExp(TABLET, 'i').test(user_agent) && !new RegExp(TABLET + ' pc', 'i').test(user_agent)) {\n        return GENERIC_TABLET\n    } else {\n        return ''\n    }\n}\n\nexport const detectDeviceType = function (user_agent: string): string {\n    const device = detectDevice(user_agent)\n    if (\n        device === IPAD ||\n        device === ANDROID_TABLET ||\n        device === 'Kobo' ||\n        device === 'Kindle Fire' ||\n        device === GENERIC_TABLET\n    ) {\n        return TABLET\n    } else if (device === NINTENDO || device === XBOX || device === PLAYSTATION || device === OUYA) {\n        return 'Console'\n    } else if (device === APPLE_WATCH) {\n        return 'Wearable'\n    } else if (device) {\n        return MOBILE\n    } else {\n        return 'Desktop'\n    }\n}","import { getQueryParam } from \"./request-utils\"\nimport { isFunction } from \"./type-utils\";\nimport { osMatchers, detectBrowser, detectDevice, detectDeviceType } from \"./ua-utils\";\n\nexport const CAMPAIGN_PARAMS = [\n    'utm_source',\n    'utm_medium',\n    'utm_campaign',\n    'utm_content',\n    'utm_term',\n    'gclid', // google ads\n    'gad_source', // google ads\n    'gclsrc', // google ads 360\n    'dclid', // google display ads\n    'gbraid', // google ads, web to app\n    'wbraid', // google ads, app to web\n    'fbclid', // facebook\n    'msclkid', // microsoft\n    'twclid', // twitter\n    'li_fat_id', // linkedin\n    'mc_cid', // mailchimp campaign id\n    'igshid', // instagram\n    'ttclid', // tiktok\n    'rdt_cid', // reddit\n]\n     \n\n\nfunction campaignParamsFuction() {\n    if (!document){\n        return {};\n    }\n\n    const url = document.URL;\n    const params: Record<string, any> = {}\n    CAMPAIGN_PARAMS.forEach((kwkey) => {\n        const kw = getQueryParam(url, kwkey);\n        if (kw){\n            params[kwkey] = kw;\n        }\n    })\n\n    return params;\n}\n\n\n\nconst detectOSFunction = function (user_agent: string): [string, string] {\n    for (let i = 0; i < osMatchers.length; i++) {\n        const [rgex, resultOrFn] = osMatchers[i]\n        const match = rgex.exec(user_agent)\n        const result = match && (isFunction(resultOrFn) ? resultOrFn(match, user_agent) : resultOrFn)\n        if (result) {\n            return result\n        }\n    }\n    return ['', '']\n}\n\nconst detectBrowserLanguageFunction = function () {\n    return (\n        navigator.language || // Any modern browser\n        (navigator as Record<string, any>).userLanguage // IE11\n    )\n}\n\n\nasync function detectIPFunction() {\n    try {\n        const response = await fetch('https://api.ipify.org?format=json');\n        const data = await response.json();\n        return data.ip;\n    } catch (error) {\n        return \"0.0.0.0\";\n    }\n}\n\n\n\nexport const Info = {\n    campaignParams : campaignParamsFuction,\n    detectOS: detectOSFunction,\n    detectBrowser: detectBrowser,\n    detectBrowserLanguage: detectBrowserLanguageFunction,\n    detectDevice: detectDevice,\n    detectDeviceType: detectDeviceType,\n    detectIP: detectIPFunction\n}","import { eventWithTime } from \"rrweb\";\nimport { Info } from \"../utils/event-utils\";\n\n\n\nexport const UAPlugin = {\n    name: 'sitewiz/ua@1',\n    observer: async (cb: (event: eventWithTime) => void) => {\n        if(navigator?.userAgent){\n            const userAgent = navigator.userAgent;\n            const payload = {\n                browser: Info.detectBrowser(userAgent, navigator.vendor),\n                browserLanguage: Info.detectBrowserLanguage(),\n                os: Info.detectOS(userAgent),\n                device: Info.detectDevice(userAgent),\n                deviceType: Info.detectDeviceType(userAgent),\n                ip: await Info.detectIP()\n            }\n\n            cb(payload as unknown as eventWithTime);\n        }\n        \n        return () => {\n\n        };    \n    },\n    option: {},\n    reset: () => {},\n}","import type { eventWithTime, listenerHandler, mutationCallbackParam } from '@rrweb/types'\nimport { BaseRRNode, Mirror } from 'rrdom'\nimport { recordOptions } from 'rrweb'\n\n\nconst INCREMENTAL_SNAPSHOT_EVENT_TYPE = 3\nconst MUTATION_SOURCE_TYPE = 0\ntype rrwebRecord = {\n    (options: recordOptions<eventWithTime>): listenerHandler\n    addCustomEvent: (tag: string, payload: any) => void\n    takeFullSnapshot: () => void\n    mirror: Mirror\n}\n\n\nexport class MutationRateLimiter {\n    private bucketSize = 100\n    private refillRate = 10\n    private mutationBuckets: Record<string, number> = {}\n    private loggedTracker: Record<string, boolean> = {}\n\n    constructor(\n        private readonly rrweb: rrwebRecord,\n        private readonly options: {\n            bucketSize?: number\n            refillRate?: number\n            onBlockedNode?: (id: number, node: Node | null) => void\n        } = {}\n    ) {\n        this.refillRate = this.options.refillRate ?? this.refillRate\n        this.bucketSize = this.options.bucketSize ?? this.bucketSize\n        setInterval(() => {\n            this.refillBuckets()\n        }, 1000)\n    }\n\n    private refillBuckets = () => {\n        Object.keys(this.mutationBuckets).forEach((key) => {\n            this.mutationBuckets[key] = this.mutationBuckets[key] + this.refillRate\n\n            if (this.mutationBuckets[key] >= this.bucketSize) {\n                delete this.mutationBuckets[key]\n            }\n        })\n    }\n\n    private getNodeOrRelevantParent = (id: number): [number, BaseRRNode | null] => {\n        // For some nodes we know they are part of a larger tree such as an SVG.\n        // For those we want to block the entire node, not just the specific attribute\n\n        const node = this.rrweb.mirror.getNode(id)\n\n        // Check if the node is an Element and then find the closest parent that is an SVG\n        if (node?.nodeName !== 'svg' && node instanceof Element) {\n            const closestSVG = node.closest('svg') as BaseRRNode | null;;\n\n            if (closestSVG) {\n                return [this.rrweb.mirror.getId(closestSVG), closestSVG]\n            }\n        }\n\n        return [id, node]\n    }\n\n    private numberOfChanges = (data: Partial<mutationCallbackParam>) => {\n        return (\n            (data.removes?.length ?? 0) +\n            (data.attributes?.length ?? 0) +\n            (data.texts?.length ?? 0) +\n            (data.adds?.length ?? 0)\n        )\n    }\n\n    public throttleMutations = (event: eventWithTime) : eventWithTime | null => {\n        if (event.type !== INCREMENTAL_SNAPSHOT_EVENT_TYPE || event.data.source !== MUTATION_SOURCE_TYPE) {\n            return event\n        }\n\n        const data = event.data as Partial<mutationCallbackParam>\n        const initialMutationCount = this.numberOfChanges(data)\n\n        if (data.attributes) {\n            // Most problematic mutations come from attrs where the style or minor properties are changed rapidly\n            data.attributes = data.attributes.filter((attr) => {\n                const [nodeId, node] = this.getNodeOrRelevantParent(attr.id)\n\n                if (this.mutationBuckets[nodeId] === 0) {\n                    return false\n                }\n\n                this.mutationBuckets[nodeId] = this.mutationBuckets[nodeId] ?? this.bucketSize\n                this.mutationBuckets[nodeId] = Math.max(this.mutationBuckets[nodeId] - 1, 0)\n\n                if (this.mutationBuckets[nodeId] === 0) {\n                    if (!this.loggedTracker[nodeId]) {\n                        this.loggedTracker[nodeId] = true\n                        this.options.onBlockedNode?.(nodeId, node as Node | null)\n                    }\n                }\n\n                return attr\n            })\n        }\n\n        // Check if every part of the mutation is empty in which case there is nothing to do\n        const mutationCount = this.numberOfChanges(data)\n\n        if (mutationCount === 0 && initialMutationCount !== mutationCount) {\n            // If we have modified the mutation count and the remaining count is 0, then we don't need the event.\n            return null\n        }\n        return event\n    }\n}\n","// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Much of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// Many optimizations have been made, so the bundle size is ultimately smaller but performance is similar.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar wk = (function (c, id, msg, transfer, cb) {\n    var u = ch2[id] || (ch2[id] = URL.createObjectURL(new Blob([c], { type: 'text/javascript' })));\n    var w = new Worker(u);\n    w.onerror = function (e) { return cb(e.error, null); };\n    w.onmessage = function (e) { return cb(null, e.data); };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, u32 = Uint32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\n// see fleb note\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new u32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return [b, r];\n};\nvar _a = freb(fleb, 2), fl = _a[0], revfl = _a[1];\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b[0], revfd = _b[1];\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >>> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >>> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >>> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >>> 8) | ((x & 0x00FF) << 8)) >>> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i)\n        ++l[cd[i] - 1];\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 0; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >>> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i)\n            co[i] = rev[le[cd[i] - 1]++] >>> (15 - cd[i]);\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) >> 0;\n    return ((d[o] | (d[o + 1] << 8)) >>> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) >> 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >>> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p / 8) >> 0) + (p & 7 && 1); };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    var n = new (v instanceof u16 ? u16 : v instanceof u32 ? u32 : u8)(e - s);\n    n.set(v.subarray(s, e));\n    return n;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, buf, st) {\n    // source length\n    var sl = dat.length;\n    // have to estimate size\n    var noBuf = !buf || st;\n    // no state\n    var noSt = !st || st.i;\n    if (!st)\n        st = {};\n    // Assumes roughly 33% compression ratio average\n    if (!buf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            st.f = final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        throw 'unexpected EOF';\n                    break;\n                }\n                // ensure size\n                if (noBuf)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                if (!noSt && pos + tl * (clb + 7) > tbts)\n                    break;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >>> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                throw 'invalid block type';\n            if (pos > tbts)\n                throw 'unexpected EOF';\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17;\n        if (noBuf)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var mxa = lbt + dbt + 18;\n        while (noSt || pos + mxa < tbts) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >>> 4;\n            pos += c & 15;\n            if (pos > tbts)\n                throw 'unexpected EOF';\n            if (!c)\n                throw 'invalid length/literal';\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >>> 4;\n                if (!d)\n                    throw 'invalid distance';\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & ((1 << b) - 1), pos += b;\n                }\n                if (pos > tbts)\n                    throw 'unexpected EOF';\n                if (noBuf)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                for (; bt < end; bt += 4) {\n                    buf[bt] = buf[bt - dt];\n                    buf[bt + 1] = buf[bt + 1 - dt];\n                    buf[bt + 2] = buf[bt + 2 - dt];\n                    buf[bt + 3] = buf[bt + 3 - dt];\n                }\n                bt = end;\n            }\n        }\n        st.l = lm, st.p = pos, st.b = bt;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    return bt == buf.length ? buf : slc(buf, 0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) >> 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) >> 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n    d[o + 2] |= v >>> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return [new u8(0), 0];\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return [v, 1];\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return [new u8(tr), mbt];\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return [cl.subarray(0, cli), s];\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >>> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a[0], mlb = _a[1];\n    var _b = hTree(df, 15), ddt = _b[0], mdb = _b[1];\n    var _c = lc(dlt), lclt = _c[0], nlc = _c[1];\n    var _d = lc(ddt), lcdt = _d[0], ndc = _d[1];\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        lcfreq[lclt[i] & 31]++;\n    for (var i = 0; i < lcdt.length; ++i)\n        lcfreq[lcdt[i] & 31]++;\n    var _e = hTree(lcfreq, 7), lct = _e[0], mlcb = _e[1];\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + (2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18]);\n    if (flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >>> 5) & 127), p += clct[i] >>> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        if (syms[i] > 255) {\n            var len = (syms[i] >>> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (syms[i] >>> 23) & 31), p += fleb[len];\n            var dst = syms[i] & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (syms[i] >>> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[syms[i]]), p += ll[syms[i]];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new u32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, lst) {\n    var s = dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.floor(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var pos = 0;\n    if (!lvl || s < 8) {\n        for (var i = 0; i <= s; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e < s) {\n                // write full block\n                pos = wfblk(w, pos, dat.subarray(i, e));\n            }\n            else {\n                // write final block\n                w[i] = lst;\n                pos = wfblk(w, pos, dat.subarray(i, s));\n            }\n        }\n    }\n    else {\n        var opt = deo[lvl - 1];\n        var n = opt >>> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = new u16(32768), head = new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new u32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index  l/lind  waitdx  bitpos\n        var lc_1 = 0, eb = 0, i = 0, li = 0, wi = 0, bs = 0;\n        for (; i < s; ++i) {\n            // hash value\n            var hv = hsh(i);\n            // index mod 32768\n            var imod = i & 32767;\n            // previous index with this value\n            var pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && rem > 423) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = (imod - pimod) & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = (i - dif + j + 32768) & 32767;\n                                    var pti = prev[ti];\n                                    var cd = (ti - pti + 32768) & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += (imod - pimod + 32768) & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one Uint32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        // this is the easiest way to avoid needing to maintain state\n        if (!lst)\n            pos = wfblk(w, pos, et);\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new u32(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && 0xEDB88320) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = 0xFFFFFFFF;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return c ^ 0xFFFFFFFF; }\n    };\n};\n// Alder32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 5552, l);\n                for (; i < e; ++i)\n                    n += d[i], m += n;\n                n %= 65521, m %= 65521;\n            }\n            a = n, b = m;\n        },\n        d: function () { return ((a >>> 8) << 16 | (b & 255) << 8 | (b >>> 8)) + ((a & 255) << 23) * 2; }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : (12 + opt.mem), pre, post, !st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/ /g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return [fnStr, td];\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k] instanceof u8 || v[k] instanceof u16 || v[k] instanceof u32)\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    var _a;\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            _a = wcln(fns[i], fnStr, td_1), fnStr = _a[0], td_1 = _a[1];\n        ch[id] = wcln(fns[m], fnStr, td_1);\n    }\n    var td = mrg({}, ch[id][1]);\n    return wk(ch[id][0] + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, u32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, hMap, max, bits, bits16, shft, slc, inflt, inflateSync, pbf, gu8]; };\nvar bDflt = function () { return [u8, u16, u32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zlv]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get u8\nvar gu8 = function (o) { return o && o.size && new u8(o.size); };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    if (!opts.consume)\n        dat = new u8(dat);\n    w.postMessage([dat, opts], [dat.buffer]);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) { return strm.push(ev.data[0], ev.data[1]); };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.push = function (d, f) {\n        if (t)\n            throw 'stream finished';\n        if (!strm.ondata)\n            throw 'no stream handler';\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16)) + (d[b + 3] << 23) * 2; };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        throw 'invalid gzip data';\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += d[10] | (d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return (d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16) + (2 * (d[l - 1] << 23));\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + ((o.filename && (o.filename.length + 1)) || 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (fl ? (32 - 2 * fl) : 1);\n};\n// zlib valid\nvar zlv = function (d) {\n    if ((d[0] & 15) != 8 || (d[0] >>> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        throw 'invalid zlib data';\n    if (d[1] & 32)\n        throw 'invalid zlib data: preset dictionaries not supported';\n};\nfunction AsyncCmpStrm(opts, cb) {\n    if (!cb && typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n// zlib footer: -4 to -0 is Adler32\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (!cb && typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, !f), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (this.d)\n            throw 'stream finished';\n        if (!this.ondata)\n            throw 'no stream handler';\n        this.d = final;\n        this.p(chunk, final || false);\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    return dopt(data, opts, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an inflation stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Inflate(cb) {\n        this.s = {};\n        this.p = new u8(0);\n        this.ondata = cb;\n    }\n    Inflate.prototype.e = function (c) {\n        if (this.d)\n            throw 'stream finished';\n        if (!this.ondata)\n            throw 'no stream handler';\n        var l = this.p.length;\n        var n = new u8(l + c.length);\n        n.set(this.p), n.set(c, l), this.p = n;\n    };\n    Inflate.prototype.c = function (final) {\n        this.d = this.s.i = final || false;\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.o, this.s);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) >> 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous inflation stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncInflate(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, 0, function () {\n            var strm = new Inflate();\n            onmessage = astrm(strm);\n        }, 7);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gu8(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, out) {\n    return inflt(data, out);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        this.c.p(c);\n        this.l += c.length;\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, !f);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a GUNZIP stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Gunzip(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            var s = gzs(this.p);\n            if (s >= this.p.length && !final)\n                return;\n            this.p = this.p.subarray(s), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 8)\n                throw 'invalid gzip stream';\n            this.p = this.p.subarray(0, -8);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous GUNZIP stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncGunzip(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, 0, function () {\n            var strm = new Gunzip();\n            onmessage = astrm(strm);\n        }, 9);\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param out Where to write the data. GZIP already encodes the output size, so providing this doesn't save memory.\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, out) {\n    return inflt(data.subarray(gzs(data), -8), out || new u8(gzl(data)));\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        this.c.p(c);\n        var raw = dopt(c, this.o, this.v && 2, f && 4, !f);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates a Zlib decompression stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Unzlib(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 2 && !final)\n                return;\n            this.p = this.p.subarray(2), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                throw 'invalid zlib stream';\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous Zlib decompression stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncUnzlib(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, 0, function () {\n            var strm = new Unzlib();\n            onmessage = astrm(strm);\n        }, 11);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gu8(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, out) {\n    return inflt((zlv(data), data.subarray(2, -4)), out);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    /**\n     * Creates a decompression stream\n     * @param cb The callback to call whenever data is decompressed\n     */\n    function Decompress(cb) {\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            throw 'no stream handler';\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                var _this_1 = this;\n                var cb = function () { _this_1.ondata.apply(_this_1, arguments); };\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(cb)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(cb)\n                        : new this.Z(cb);\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    /**\n   * Creates an asynchronous decompression stream\n   * @param cb The callback to call whenever data is decompressed\n   */\n    function AsyncDecompress(cb) {\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, out) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, out)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, out)\n            : unzlibSync(data, out);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k;\n        if (val instanceof u8)\n            t[n] = [val, o];\n        else if (Array.isArray(val))\n            t[n] = [val[0], mrg(o, val[1])];\n        else\n            fltn(val, n + '/', t, o);\n    }\n};\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    var l = str.length;\n    if (!latin1 && typeof TextEncoder != 'undefined')\n        return new TextEncoder().encode(str);\n    var ar = new u8(str.length + (str.length >>> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >>> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >>> 18)), w(128 | ((c >>> 12) & 63)), w(128 | ((c >>> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >>> 12)), w(128 | ((c >>> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    var r = '';\n    if (!latin1 && typeof TextDecoder != 'undefined')\n        return new TextDecoder().decode(dat);\n    for (var i = 0; i < dat.length;) {\n        var c = dat[i++];\n        if (c < 128 || latin1)\n            r += String.fromCharCode(c);\n        else if (c < 224)\n            r += String.fromCharCode((c & 31) << 6 | (dat[i++] & 63));\n        else if (c < 240)\n            r += String.fromCharCode((c & 15) << 12 | (dat[i++] & 63) << 6 | (dat[i++] & 63));\n        else\n            c = ((c & 15) << 18 | (dat[i++] & 63) << 12 | (dat[i++] & 63) << 6 | (dat[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n    }\n    return r;\n}\n;\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl;\n    var _a = z ? z64e(d, es) : [b4(d, b + 20), b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b4(d, b + 12), b4(d, b + 4), b4(d, b + 20)];\n};\n// write zip header\nvar wzh = function (d, b, c, cmp, su, fn, u, o, ce, t) {\n    var fl = fn.length, l = cmp.length;\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b] = 20, b += 2;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (t == 8 && (o.level == 1 ? 6 : o.level < 6 ? 4 : o.level == 9 ? 2 : 0)), d[b++] = u && 8;\n    d[b] = t, b += 2;\n    var dt = new Date(o.mtime || Date.now()), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        throw 'date not in range 1980-2099';\n    wbytes(d, b, ((y << 24) * 2) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >>> 1));\n    b += 4;\n    wbytes(d, b, c);\n    wbytes(d, b + 4, l);\n    wbytes(d, b + 8, su);\n    wbytes(d, b + 12, fl), b += 16; // skip extra field, comment\n    if (ce != null)\n        wbytes(d, b += 10, ce), b += 4;\n    d.set(fn, b);\n    b += fl;\n    if (ce == null)\n        d.set(cmp, b);\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                wzh(out, tot, f.c, f.d, f.m, f.n, f.u, f.p, null, f.t);\n                wzh(out, o, f.c, f.d, f.m, f.n, f.u, f.p, tot, f.t), o += 46 + f.n.length, tot += 30 + f.n.length + f.d.length;\n            }\n            catch (e) {\n                return cb(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cb(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), m = file.length;\n        c.p(file);\n        var n = strToU8(fn), s = n.length;\n        var t = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cb(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = {\n                    t: t,\n                    d: d,\n                    m: m,\n                    c: c.d(),\n                    u: fn.length != l,\n                    n: n,\n                    p: p\n                };\n                o += 30 + s + l;\n                tot += 76 + 2 * s + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (n.length > 65535)\n            cbl('filename too long', null);\n        if (!t)\n            cbl(null, file);\n        else if (m < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var t = p.level == 0 ? 0 : 8;\n        var n = strToU8(fn), s = n.length;\n        if (n.length > 65535)\n            throw 'filename too long';\n        var d = t ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push({\n            t: t,\n            d: d,\n            m: file.length,\n            c: c.d(),\n            u: fn.length != s,\n            n: n,\n            o: o,\n            p: p\n        });\n        o += 30 + s + l;\n        tot += 76 + 2 * s + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f.c, f.d, f.m, f.n, f.u, f.p, null, f.t);\n        wzh(out, o, f.c, f.d, f.m, f.n, f.u, f.p, f.o, f.t), o += 46 + f.n.length;\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Asynchronously decompresses a ZIP archive\n * @param data The raw compressed ZIP file\n * @param cb The callback to call with the decompressed files\n * @returns A function that can be used to immediately terminate the unzipping\n */\nexport function unzip(data, cb) {\n    if (typeof cb != 'function')\n        throw 'no callback';\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cb('invalid zip file', null);\n            return;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (!lft)\n        cb(null, {});\n    var c = lft;\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50)\n            throw 'invalid zip file';\n        c = lft = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    var _loop_2 = function (i) {\n        var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cb(e, null);\n            }\n            else {\n                files[fn] = d;\n                if (!--lft)\n                    cb(null, files);\n            }\n        };\n        if (!c_1)\n            cbl(null, slc(data, b, b + sc));\n        else if (c_1 == 8) {\n            var infl = data.subarray(b, b + sc);\n            if (sc < 320000) {\n                try {\n                    cbl(null, inflateSync(infl, new u8(su)));\n                }\n                catch (e) {\n                    cbl(e, null);\n                }\n            }\n            else\n                term.push(inflate(infl, { size: su }, cbl));\n        }\n        else\n            cbl('unknown compression type ' + c_1, null);\n    };\n    for (var i = 0; i < c; ++i) {\n        _loop_2(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @returns The decompressed files\n */\nexport function unzipSync(data) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            throw 'invalid zip file';\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50)\n            throw 'invalid zip file';\n        c = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!c_2)\n            files[fn] = slc(data, b, b + sc);\n        else if (c_2 == 8)\n            files[fn] = inflateSync(data.subarray(b, b + sc), new u8(su));\n        else\n            throw 'unknown compression type ' + c_2;\n    }\n    return files;\n}\n","import { isArray, isObject } from \"./type-utils\"\nimport { SnapshotBuffer } from \"../session-replay\"\nimport { deflateSync } from 'fflate'\nimport { eventWithTime } from \"rrweb\"\nimport { event } from \"@rrweb/types\"\n\nconst CONTENT_TYPE_PLAIN = 'text/plain'\nexport const SEVEN_MEGABYTES = 1024 * 1024 * 7 * 0.9 // ~7mb (with some wiggle room)\n\n\n\n\nfunction circularReferenceReplacer() {\n  const ancestors: any[] = []\n  return function (_key: string, value: any) {\n      if (isObject(value)) {\n          // `this` is the object that value is contained in,\n          // i.e., its direct parent.\n          // @ts-expect-error - TS was unhappy with `this` on the next line but the code is copied in from MDN\n          while (ancestors.length > 0 && ancestors.at(-1) !== this) {\n              ancestors.pop()\n          }\n          if (ancestors.includes(value)) {\n              return '[Circular]'\n          }\n          ancestors.push(value)\n          return value\n      } else {\n          return value\n      }\n  }\n}\n\nexport function estimateSize(sizeable: unknown): number {\n  return JSON.stringify(sizeable, circularReferenceReplacer()).length\n}\n\n\nexport function splitBuffer(buffer: SnapshotBuffer, sizeLimit: number = SEVEN_MEGABYTES): SnapshotBuffer[] {\n    if (buffer.size >= sizeLimit && isArray(buffer.data) && buffer.data.length > 1) {\n        const half = Math.floor(buffer.data.length / 2)\n        const firstHalf = buffer.data.slice(0, half)\n        const secondHalf = buffer.data.slice(half)\n        return [\n            splitBuffer({\n                size: estimateSize(firstHalf),\n                data: firstHalf,\n                partitionKey: buffer.partitionKey,\n                stream_key: buffer.stream_key\n            }),\n            splitBuffer({\n                size: estimateSize(secondHalf),\n                data: secondHalf,\n                partitionKey: buffer.partitionKey,\n                stream_key: buffer.stream_key\n            }),\n        ].flatMap((x) => x)\n    } \n    \n    return [buffer];\n}\n\n\nconst maxSizeInBytes = 1 * 1024 * 1020; // Convert MB to bytes\n\n// function uint8ArrayToBase64(data: Uint8Array) {\n//     const binaryString = String.fromCharCode(...data);\n//     return btoa(binaryString);\n// }\n\nfunction uint8ArrayToBase64(bytes: Uint8Array) {\n    let binaryString = \"\";\n    const len = bytes.byteLength;\n    for (let i = 0; i < len; i++) {\n      binaryString += String.fromCharCode(bytes[i]);\n    }\n    return btoa(binaryString);\n  }\n\n\n\nexport const compressData = (data: eventWithTime[], stream_key: string) : string => {\n    const events = {data, stream_key}  ;\n    const jsonString = JSON.stringify(events);\n    const compressedData = deflateSync(new TextEncoder().encode(jsonString));\n    return uint8ArrayToBase64(compressedData);\n}\n\nexport const splitFullSnapshotCompressed = (data: eventWithTime[], partitionKey: string, stream_key: string) : SnapshotBuffer[] => {\n    const compressed = compressData(data, stream_key);\n    const result : SnapshotBuffer[] = [];\n    const maxCharsPerChunk = Math.floor(maxSizeInBytes / 2);\n\n    let start = 0;\n\n    while (start < compressed.length) {\n        const end = Math.min(start + maxCharsPerChunk, compressed.length);\n        const chunk = compressed.substring(start, end);\n\n        const bufferChunk : SnapshotBuffer = {\n            size: chunk.length,\n            data: chunk,\n            partitionKey: partitionKey,\n            stream_key: stream_key,\n            splitFullSnapshot: true\n        }\n\n        result.push(bufferChunk);\n        start = end;\n    }\n\n    return result;\n}","import { EventType, eventWithTime } from \"rrweb\";\nimport { SessionReplay, SnapshotBuffer } from \"../session-replay\";\nimport { compressData, estimateSize, splitBuffer, splitFullSnapshotCompressed } from \"../utils/compress\";\nimport { isLocalhost } from \"../utils/request-utils\";\nimport { isArray } from \"../utils/type-utils\";\n\n\n// Additional wrapping for processing buffers\ninterface DataPacket {\n    buffer: SnapshotBuffer, \n    fullSnapshot: boolean,\n    retryCount?: number\n}\n\n\nexport class Queue {\n    packets: DataPacket[] = [];\n    recorder: SessionReplay;\n    processing: boolean = false;\n    maxRetries = 5;\n    baseDelay = 500;\n    sending = false;\n    local = false;\n\n    constructor (recorder: SessionReplay){\n        this.recorder = recorder;\n        this.local = isLocalhost();\n        this.poll();\n    }\n\n\n    delay = (delayInms: number) => {\n        return new Promise(resolve => setTimeout(resolve, delayInms));\n    };\n      \n    async poll () {\n        setInterval(async () => {\n            if (!this.processing && !this.sending){\n                this.processing = true;\n                const packet = this.packets.shift();\n                if (packet){\n                    this.sendPackets (packet);\n                }\n                \n                this.processing = false;  \n            }\n        }, 500);\n        \n    }\n\n    isFullPageSnapshot = (event: eventWithTime) : boolean => {\n        return event.type === EventType.FullSnapshot;\n    }\n\n    splitBySnapshot = (data: eventWithTime[]) => {\n        const result = [];\n        let startIndex = 0;\n    \n        for (let i = 0; i < data.length; i++) {\n            if (this.isFullPageSnapshot(data[i])) {\n                if (startIndex < i) {\n                    result.push(data.slice(startIndex, i)); // Before the key\n                }\n\n                result.push(data.slice(i, i + 1)); // The matching key\n                startIndex = i + 1;\n            }\n        }\n    \n        if (startIndex < data.length) {\n            result.push(data.slice(startIndex)); // After the last key\n        }\n    \n        return result;\n    }\n    \n\n    // Splits packets in a buffer\n    // If its a fullpage snapshot, isolates the snapshot from other data events\n    // Otherwise, splits data events into chunks if too large\n\n    bufferToDatapacket = (data: SnapshotBuffer[], snapshot: boolean) => {\n        const packets: DataPacket[] = [];\n        data.forEach(buffer => {\n            const datapacket = {\n                buffer: buffer,\n                fullSnapshot: snapshot,\n            }\n\n            packets.push(datapacket);\n        });\n\n        return packets;\n    }\n\n    processPacket = (packet: DataPacket) : SnapshotBuffer[] => {\n\n        const stream_key = packet.buffer.stream_key;\n        const partitionKey = packet.buffer.partitionKey;\n\n        if (packet.fullSnapshot && isArray(packet.buffer.data)){\n            packet.buffer.data.shift();\n            \n            const splits = this.splitBySnapshot(packet.buffer.data);\n            const buffers : SnapshotBuffer[] = [];\n            splits.forEach(split => {\n\n                if(this.isFullPageSnapshot(split[0])){\n                    const compressed = splitFullSnapshotCompressed(split, partitionKey, stream_key);\n                    buffers.push(...compressed);\n                }\n                else{\n                    const bufferPayload: SnapshotBuffer= {\n                        size: estimateSize(split),\n                        data: split,\n                        partitionKey: packet.buffer.partitionKey,\n                        stream_key: packet.buffer.stream_key\n                    }\n                    buffers.push(bufferPayload);\n                }\n\n            });\n\n            return buffers;\n        }\n\n        else if (!isArray(packet.buffer.data)){\n            return [packet.buffer];\n        }\n        else{\n            const buffers = splitBuffer(packet.buffer);\n            return buffers;\n        }\n    }\n\n\n    // Split and process packets\n    // If packet has been split, readd to the queue\n    // If packet isn't split, send it to backend\n    sendPackets = (packet: DataPacket) => {\n        const processedPacket = this.processPacket(packet);\n        if (processedPacket.length > 1) {\n            processedPacket.slice().reverse().forEach(proc => {\n                this.packets.unshift({buffer: proc, fullSnapshot: false});\n            });\n            return;\n        }\n\n\n        const compressedEvents = typeof processedPacket[0].data !== 'string' ?\n                        compressData(processedPacket[0].data, processedPacket[0].stream_key) :\n                        processedPacket[0].data;\n\n        const fullPageSnapshot = processedPacket[0].splitFullSnapshot ? true : false;\n        const data = {events: compressedEvents, \n                      fullPageSnapshot, \n                      stream_key: processedPacket[0].stream_key,\n                      session: processedPacket[0].partitionKey};\n\n        const url = this.local ? 'https://webhook.site/a5725c69-7db0-4d59-ab0b-9eb199a4d765' : 'https://3c1vg79qm1.execute-api.us-east-1.amazonaws.com/prod/record';\n\n        const headers: Record<string, string> = {\n            \"Content-Type\": \"application/json;charset=UTF-8\",\n            \"Accept\": \"*/*\",\n            \"Connection\": \"Keep-Alive\"\n        };\n    \n\n        if (!this.local) {\n            headers[\"X-API-KEY\"] = processedPacket[0].stream_key;\n        }\n\n        const body = JSON.stringify({partitionKey: processedPacket[0].partitionKey, data})\n        const fetchOptions: RequestInit = {\n            method: \"POST\",\n            headers: headers,\n            body: body\n        };\n    \n        if (this.local) {\n            fetchOptions.mode = 'no-cors';\n        }\n    \n\n        this.sending = true;\n        fetch(url, fetchOptions).then(\n                async response => {\n                    if (!response.ok && response.type !== 'opaque') {\n                        packet.retryCount = (packet.retryCount || 0) + 1;\n\n                        if (packet.retryCount <= this.maxRetries) {\n                            const delay = this.baseDelay * Math.pow(2, packet.retryCount);\n                            if (this.local){\n                                console.log(`Retrying in ${delay} ms (Attempt ${packet.retryCount}/${this.maxRetries})`);\n                            }\n                            \n                            await this.delay(delay);\n                            this.packets.unshift(packet); // Re-add packet to the queue\n                        } else {\n                            if (this.local){\n                                console.error('Max retries reached. Dropping packet:', packet);\n                            }\n                            \n                        }\n                    }\n\n                    this.sending = false;\n                }\n            );\n        \n    }\n\n    addPackets = (events: SnapshotBuffer, fullSnapshot : boolean) => {\n        const clonedEvents: SnapshotBuffer = JSON.parse(JSON.stringify(events));\n\n        if (this.local){\n            console.log(clonedEvents.data);\n            console.log(fullSnapshot);\n        }\n\n        this.packets.push({buffer: clonedEvents, fullSnapshot});\n    }\n\n\n}","// @ts-ignore\n// session-replay.ts\nimport rrwebRecord from \"rrweb/es/rrweb/packages/rrweb/src/record\";\nimport { errorplugin } from \"./plugins/error\";\nimport { revenuePlugin } from \"./plugins/revenue\";\nimport { clickedElementPlugin } from \"./plugins/clickedElement\";\nimport { ga4Plugin } from \"./plugins/ga4\";\nimport { marketingPlugin } from \"./plugins/marketingTracking\";\nimport { EventType, eventWithTime, recordOptions } from \"rrweb\";\nimport { UAPlugin } from \"./plugins/userAgentDetection\";\nimport { MutationRateLimiter } from \"./optimizations/mutationLimiter\";\nimport { estimateSize } from \"./utils/compress\";\nimport { Queue } from \"./optimizations/queue\";\n\nexport interface SnapshotBuffer {\n  size: number;\n  data: eventWithTime[] | string;\n  partitionKey: string;\n  stream_key: string;\n  splitFullSnapshot?: boolean;\n}\n\nexport class SessionReplay {\n  private static instance: SessionReplay;\n  private static intervalSet: boolean = false;\n\n  record = false;\n  events: any[];\n  buffer: SnapshotBuffer | undefined;\n  mutationRateLimiter: MutationRateLimiter;\n  rrwebRecord;\n  stream_key: string | null;\n  session_id: string | null;\n  queue: Queue;\n  fullSnapshotExists: boolean = false;\n\n  private constructor(record: boolean) {\n    this.events = [];\n    this.stream_key = null;\n    this.session_id = null;\n\n    this.record = record;\n    this.rrwebRecord = rrwebRecord;\n    this.mutationRateLimiter = new MutationRateLimiter(this.rrwebRecord, {\n      onBlockedNode: (id, _) => {\n        const message = `Too many mutations on node '${id}'. Rate limiting. This could be due to SVG animations or something similar`;\n        //console.warn(message, node);\n      },\n    });\n\n    this.queue = new Queue(this);\n    if (!SessionReplay.intervalSet) {\n      setInterval(this._emit.bind(this), 3000);\n      SessionReplay.intervalSet = true;\n    }\n  }\n\n  public static getInstance(record: boolean): SessionReplay {\n    if (!SessionReplay.instance) {\n      SessionReplay.instance = new SessionReplay(record);\n    } else if (record !== SessionReplay.instance.record) {\n      SessionReplay.instance.record = record;\n    }\n    return SessionReplay.instance;\n  }\n\n  set_keys = (stream_key: string, session_id: string) => {\n    this.stream_key = stream_key;\n    this.session_id = session_id;\n  };\n\n  private _emit = () => {\n    if (\n      this.record &&\n      this.events.length > 0 &&\n      this.stream_key &&\n      this.session_id\n    ) {\n      const payload: SnapshotBuffer = {\n        size: estimateSize(this.events),\n        data: this.events,\n        partitionKey: this.session_id,\n        stream_key: this.stream_key,\n      };\n\n      this.fullSnapshotExists = false;\n      if (\n        typeof this.events[0] === \"string\" &&\n        this.events[0] === \"fullsnapshot\"\n      ) {\n        this.fullSnapshotExists = true;\n      }\n\n      this.queue.addPackets(payload, this.fullSnapshotExists);\n\n      this.events = [];\n    }\n  };\n\n  start_recording(is_eu: boolean) {\n    const rrwebOptions: recordOptions<eventWithTime> = {\n      emit: (event: eventWithTime) => {\n        const throttledEvent =\n          this.mutationRateLimiter.throttleMutations(event);\n        const controlledEvent = throttledEvent ? throttledEvent : event;\n        if (controlledEvent.type === EventType.FullSnapshot) {\n          this.events.unshift(\"fullsnapshot\");\n        }\n        this.events.push(controlledEvent);\n        marketingPlugin(controlledEvent, this.events);\n      },\n      sampling: {\n        mouseInteraction: {\n          MouseUp: false,\n          MouseDown: false,\n          ContextMenu: false,\n          Focus: false,\n          Blur: false,\n          TouchStart: false,\n          TouchEnd: false,\n          TouchMove: false,\n          Click: true,\n        },\n      },\n      maskInputOptions: {\n        password: true,\n      },\n      maskAllInputs: false,\n      plugins: [\n        errorplugin,\n        clickedElementPlugin,\n        ga4Plugin,\n        UAPlugin,\n        revenuePlugin,\n      ],\n    };\n\n    if (is_eu) {\n      rrwebOptions.maskAllInputs = true;\n      rrwebOptions.maskInputOptions = {\n        password: true,\n        text: true,\n        email: true,\n        tel: true,\n        search: true,\n        url: true,\n        color: true,\n        date: true,\n        \"datetime-local\": true,\n        month: true,\n        number: true,\n        range: true,\n        time: true,\n        week: true,\n        textarea: true,\n        select: true,\n      };\n\n      rrwebOptions.maskTextClass = \"*\";\n      rrwebOptions.maskTextSelector = \"*\";\n      rrwebOptions.maskTextFn = (text: string) => \"*\".repeat(text.length);\n\n      rrwebOptions.blockClass = \"rrweb-profile-img\";\n      rrwebOptions.blockSelector = 'img[src*=\"profile\"], img[src*=\"avatar\"]';\n    }\n\n    this.rrwebRecord(rrwebOptions);\n  }\n}\n","import { eventWithTime, EventType } from 'rrweb';\nimport { Info } from '../utils/event-utils';\n\n\nexport const marketingPlugin = (event: eventWithTime, allevents: eventWithTime[]) => {\n    if(event.type == EventType.Meta){\n        const params = Info.campaignParams();\n        const payload : eventWithTime = {\n            type: EventType.Plugin,\n            data: {\n                plugin: \"sitewiz/marketing@1\",\n                payload: params\n            },\n            timestamp: Date.now()\n        }\n\n        allevents.push(payload);\n    }\n}\n","import { Sitewiz } from \"../sitewiz-core\";\n\n\nexport const sitewiz = new Sitewiz();\nwindow.sitewiz = sitewiz;","import { getSessionId } from \"./utils/cookies\";\nimport { SessionReplay } from \"./session-replay\";\n\nexport class Sitewiz {\n  record: boolean = false;\n  funnel: boolean;\n  compress: boolean = true;\n  replay: SessionReplay;\n  gdpr: boolean = false;\n  stream_key: string = \"\";\n\n  constructor() {\n    this.funnel = true;\n\n    const recordingThreshold = 0;\n    if (Math.random() > recordingThreshold) {\n      this.record = true;\n    }\n\n    this.replay = SessionReplay.getInstance(this.record);\n  }\n\n  begin(stream_key: string) {\n    if (this.gdpr) {\n      // Implement PII masking logic here\n    }\n    const sessionId = getSessionId();\n    this.replay.set_keys(stream_key, sessionId[0]);\n    this.replay.record = true;\n    const is_eu = false;\n    this.replay.start_recording(is_eu);\n  }\n\n  dom_loaded_handler() {\n    if (document?.addEventListener) {\n      if (document.readyState === \"complete\") {\n        // Safari 4 can fire the DOMContentLoaded event before loading all\n        // external JS (including this file). You will see some copypasta\n        // on the internet that checks for 'complete' and 'loaded', but\n        // 'loaded' is an IE thing.\n        this.begin(this.stream_key);\n      } else {\n        document.addEventListener(\"DOMContentLoaded\", () =>\n          this.begin(this.stream_key)\n        );\n      }\n    }\n  }\n\n  init(stream_key: string, gtm?: boolean) {\n    this.stream_key = stream_key;\n\n    if (gtm) {\n      this.begin(this.stream_key);\n    } else {\n      window.addEventListener(\"load\", this.dom_loaded_handler.bind(this), true);\n    }\n  }\n}\n"],"names":["getSessionId","name","ca","decodeURIComponent","document","cookie","split","i","length","c","charAt","substring","indexOf","newSessionId","replace","r","Math","random","toString","value","days","d","Date","setTime","getTime","expires","toUTCString","concat","setCookie","NodeType","isShadowRoot","n","host","Boolean","shadowRoot","isNativeShadowDom","Object","prototype","call","stringifyStylesheet","s","rules","cssRules","cssText","Array","from","stringifyRule","join","includes","error","rule","importStringified","cssStringified","regex","isCSSImportRule","styleSheet","statement","JSON","stringify","href","layerName","push","supportsText","media","mediaText","escapeImportStatement","isCSSStyleRule","selectorText","Mirror","_createClass","_classCallCheck","this","idNodeMap","Map","nodeMetaMap","WeakMap","key","_a","id","getMeta","get","keys","_this","getId","childNodes","forEach","childNode","removeNodeFromMap","has","node","meta","set","oldNode","getNode","maskInputValue","_ref","element","maskInputOptions","tagName","type","maskInputFn","text","actualType","toLowerCase","repeat","str","ORIGINAL_ATTRIBUTE_NAME","getInputType","hasAttribute","extractFileExtension","path","baseURL","url","URL","window","location","err","match","pathname","canvasService","canvasCtx","_id","tagNameRegex","RegExp","genId","URL_IN_CSS_REF","URL_PROTOCOL_MATCH","URL_WWW_MATCH","DATA_URI","absoluteToStylesheet","origin","quote1","path1","quote2","path2","path3","filePath","maybeQuote","test","slice","stack","parts","pop","_step","_iterator","_createForOfIteratorHelper","done","part","e","f","SRCSET_NOT_SPACES","SRCSET_COMMAS_OR_SPACES","absoluteToDoc","doc","attributeValue","trim","a","createElement","isSVGElement","el","ownerSVGElement","getHref","transformAttribute","pos","collectCharacters","regEx","chars","exec","output","descriptorsStr","inParens","getAbsoluteSrcsetString","ignoreAttribute","_value","classMatchesRegex","checkAncestors","nodeType","ELEMENT_NODE","parentNode","eIndex","classList","className","needMaskingText","maskTextClass","maskTextSelector","parentElement","closest","contains","matches","serializeNode","options","mirror","blockClass","blockSelector","needsMask","inlineStylesheet","_options$maskInputOpt","maskTextFn","_options$dataURLOptio","dataURLOptions","inlineImages","recordCanvas","keepIframeSrcFn","_options$newlyAddedEl","newlyAddedElement","rootId","hasNode","docId","undefined","getRootId","DOCUMENT_NODE","compatMode","Document","DOCUMENT_TYPE_NODE","DocumentType","publicId","systemId","isCustomElement","_options$maskInputOpt2","_options$dataURLOptio2","_options$newlyAddedEl2","needBlock","_isBlockedElement","HTMLFormElement","processedTagName","getValidTagName","attributes","len","attr","stylesheet","styleSheets","find","rel","_cssText","sheet","innerText","textContent","checked","selected","__context","canvas","ctx","getContext","x","width","y","height","getImageData","originalGetImageData","Uint32Array","min","data","buffer","some","pixel","is2DCanvasBlank","rr_dataURL","toDataURL","quality","canvasDataURL","blankCanvas","image","oldValue","crossOrigin","recordInlineImage","removeEventListener","naturalWidth","naturalHeight","drawImage","console","warn","currentSrc","removeAttribute","complete","addEventListener","mediaAttributes","rr_mediaState","paused","rr_mediaCurrentTime","currentTime","rr_mediaPlaybackRate","playbackRate","rr_mediaMuted","muted","rr_mediaLoop","loop","rr_mediaVolume","volume","scrollLeft","rr_scrollLeft","scrollTop","rr_scrollTop","_n$getBoundingClientR","getBoundingClientRect","class","rr_width","rr_height","src","contentDocument","rr_src","customElements","Element","isSVG","isCustom","serializeElementNode","TEXT_NODE","parentTagName","isStyle","isScript","nextSibling","previousSibling","Text","serializeTextNode","CDATA_SECTION_NODE","CDATA","COMMENT_NODE","Comment","lowerIfExists","maybeAttr","serializeNodeWithId","_options$skipChild","skipChild","_options$inlineStyles","_options$maskInputOpt3","slimDOMOptions","_options$dataURLOptio3","_options$inlineImages","_options$recordCanvas","onSerialize","onIframeLoad","_options$iframeLoadTi","iframeLoadTimeout","onStylesheetLoad","_options$stylesheetLo","stylesheetLoadTimeout","_options$keepIframeSr","_options$newlyAddedEl3","_options$preserveWhit","preserveWhiteSpace","_serializedNode","sn","comment","script","as","headFavicon","headMetaDescKeywords","headMetaSocial","property","headMetaRobots","headMetaHttpEquiv","headMetaAuthorship","headMetaVerification","slimDOMExcluded","serializedNode","assign","add","recordChild","isShadowHost","headWhitespace","bypassOptions","_i","_Array$from","serializedChildNode","isElement","_i2","_Array$from2","isShadow","iframeEl","listener","win","contentWindow","readyState","fired","blankUrl","setTimeout","timer","clearTimeout","onceIframeLoaded","iframeDoc","serializedIframeNode","link","styleSheetLoadTimeout","styleSheetLoaded","onceStylesheetLoaded","serializedLinkNode","on","fn","target","arguments","capture","passive","DEPARTED_MIRROR_ACCESS_WARNING","_mirror","map","reset","throttle","func","wait","timeout","previous","_len","args","_key","now","leading","remaining","context","apply","trailing","hookSetter","isRevoked","original","getOwnPropertyDescriptor","defineProperty","patch","source","replacement","wrapped","defineProperties","__rrweb_original__","enumerable","Proxy","Reflect","prop","receiver","nowTimestamp","getWindowScroll","_b","_c","_d","_e","_f","left","scrollingElement","pageXOffset","documentElement","body","top","pageYOffset","getWindowHeight","innerHeight","clientHeight","getWindowWidth","innerWidth","clientWidth","closestElementOfNode","isBlocked","isIgnored","isAncestorRemoved","legacy_isTouchEvent","event","changedTouches","isSerializedIframe","nodeName","isSerializedStylesheet","getAttribute","hasShadowRoot","StyleSheetMirror","styleIDMap","idStyleMap","newId","getShadowHost","shadowHost","getRootNode","Node","DOCUMENT_FRAGMENT_NODE","shadowHostInDom","ownerDocument","rootShadowHost","getRootShadowHost","inDom","EventType","EventType2","IncrementalSource","IncrementalSource2","MouseInteractions","MouseInteractions2","PointerTypes","PointerTypes2","CanvasContext","CanvasContext2","isNodeInLinkedList","errorHandler","DoubleLinkedList","head","tail","position","Error","current","index","next","__ln","moveKey","parentId","MutationBuffer","frozen","locked","texts","attributeMap","removes","mapRemoves","movedMap","addedSet","Set","movedSet","droppedSet","processMutations","mutations","processMutation","emit","adds","addedIds","addList","getNextId","ns","nextId","pushAdd","addNode","currentN","iframeManager","addIframe","stylesheetManager","trackLinkElement","shadowDomManager","addShadowRoot","iframe","childSn","attachIframe","observeAttachShadow","attachLinkElement","shift","isParentRemoved","_step2","_iterator2","isAncestorInSet","candidate","tailNode","_node","unhandledNode","removeNode","payload","genTextAreaValueMutation","filter","attribute","style","diffAsStr","styleDiff","unchangedAsStr","_unchangedStyles","mutationCb","textarea","item","cn","m","attributeName","setAttribute","unattachedDoc","implementation","createHTMLDocument","old","pname","newValue","getPropertyValue","newPriority","getPropertyPriority","addedNodes","genAdds","removedNodes","nodeId","isSerialized","deepDelete","processedNodeManager","inOtherBuffer","targetId","childN","_this2","canvasManager","freeze","unfreeze","lock","unlock","addsSet","_isParentRemoved","size","_isAncestorInSet","registerErrorHandler","handler","unregisterErrorHandler","callbackWrapper","cb","mutationBuffers","getEventTarget","composedPath","initMutationObserver","rootEl","mutationBuffer","init","mutationObserverCtor","MutationObserver","__rrMutationObserver","angularZoneSymbol","Zone","__symbol__","observer","bind","observe","attributeOldValue","characterData","characterDataOldValue","childList","subtree","initMouseInteractionObserver","_ref3","mouseInteractionCb","sampling","mouseInteraction","disableMap","handlers","currentPointerType","Number","isNaN","endsWith","eventKey","eventName","pointerType","thisEventKey","Mouse","Touch","Pen","MouseDown","MouseUp","startsWith","Click","clientX","clientY","getHandler","PointerEvent","TouchStart","TouchEnd","h","initScrollObserver","_ref4","scrollCb","evt","defaultView","scrollLeftTop","scroll","INPUT_TAGS","lastInputValueMap","getNestedCSSRulePositions","childRule","hasNestedCSSRule","parentRule","CSSGroupingRule","CSSMediaRule","CSSSupportsRule","CSSConditionRule","unshift","parentStyleSheet","recurse","getIdAndStyleId","styleMirror","styleId","ownerNode","initAdoptedStyleSheetObserver","_ref14","hostId","patchTarget","ShadowRoot","originalPropertyDescriptor","configurable","sheets","result","adoptStyleSheets","initObservers","o","mutationObserver","hooks","currentWindow","mousemoveCb","viewportResizeCb","inputCb","mediaInteractionCb","styleSheetRuleCb","styleDeclarationCb","canvasMutationCb","fontCb","selectionCb","customElementCb","mutation","mousemove","viewportResize","input","mediaInteaction","styleSheetRule","styleDeclaration","canvasMutation","font","selection","customElement","mergeHooks","recordDOM","_ref6","lastH","lastW","mousemoveHandler","timeBaseline","threshold","callbackThreshold","mousemoveCallback","positions","wrappedCb","totalOffset","p","timeOffset","updatePosition","_ref2","DragEvent","Drag","MouseEvent","MouseMove","TouchMove","initMoveObserver","mouseInteractionHandler","scrollHandler","viewportResizeHandler","inputHandler","_ref7","ignoreClass","ignoreSelector","userTriggeredOnInput","eventHandler","userTriggered","isTrusted","isChecked","cbWithDedup","querySelectorAll","v","lastInputValue","propertyDescriptor","HTMLInputElement","hookProperties","HTMLSelectElement","HTMLTextAreaElement","HTMLOptionElement","_toConsumableArray","initInputObserver","mediaInteractionHandler","_ref17","initMediaInteractionObserver","styleSheetObserver","adoptedStyleSheetObserver","styleDeclarationObserver","fontObserver","_ref8","_ref9","CSSStyleSheet","insertRule","thisArg","argumentsList","_argumentsList","_slicedToArray","_getIdAndStyleId","replaceSync","deleteRule","_getIdAndStyleId2","_getIdAndStyleId3","_getIdAndStyleId4","supportedNestedCSSRuleTypes","canMonkeyPatchNestedCSSRule","unmodifiedFunctions","entries","_ref10","_ref11","typeKey","_argumentsList5","_getIdAndStyleId5","_getIdAndStyleId6","_ref12","_ref13","initStyleSheetObserver","_ref15","_ref16","ignoreCSSAttributes","setProperty","CSSStyleDeclaration","_argumentsList7","priority","_getIdAndStyleId7","removeProperty","_getIdAndStyleId8","remove","initStyleDeclarationObserver","collectFonts","_ref18","fontMap","originalFontFace","FontFace","family","descriptors","fontFace","fontSource","Uint8Array","restoreHandler","fonts","initFontObserver","selectionObserver","param","collapsed","updateSelection","getSelection","isCollapsed","ranges","count","rangeCount","range","getRangeAt","startContainer","startOffset","endContainer","endOffset","start","end","initSelectionObserver","customElementObserver","_ref19","constructor","define","initCustomElementObserver","pluginHandlers","plugins","plugin","callback","b","disconnect","CrossOriginIframeMirror","generateIdFn","iframeIdToRemoteIdMap","iframeRemoteIdToIdMap","remoteId","idToRemoteMap","remoteToIdMap","idToRemoteIdMap","getIdToRemoteIdMap","remoteIdToIdMap","getRemoteIdToIdMap","ids","getRemoteId","IframeManager","iframes","crossOriginIframeMap","crossOriginIframeMirror","crossOriginIframeRootIdMap","wrappedEmit","recordCrossOriginIframes","crossOriginIframeStyleMirror","generateId","handleMessage","loadListener","isAttachIframe","adoptedStyleSheets","message","crossOriginMessageEvent","transformedEvent","transformCrossOriginEvent","isCheckout","FullSnapshot","replaceIdOnNode","patchRootIdOnNode","timestamp","IncrementalSnapshot","Mutation","Meta","Load","DomContentLoaded","Plugin","Custom","replaceIds","ViewportResize","MediaInteraction","MouseInteraction","Scroll","CanvasMutation","Input","StyleSheetRule","StyleDeclaration","replaceStyleIds","Font","Selection","AdoptedStyleSheet","styles","iframeMirror","obj","isArray","getIds","child","_this3","ShadowDomManager","shadowDoms","WeakSet","restoreHandlers","patchAttachShadow","iframeElement","manager","option","__awaiter","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","rejected","then","lookup","charCodeAt","canvasVarMap","saveWebGLVar","isInstanceOfWebGLObject","_typeof","list","ctor","contextMap","variableListFor","serializeArg","arg","Float32Array","Float64Array","Int32Array","Uint16Array","Int16Array","Int8Array","Uint8ClampedArray","rr_type","values","ArrayBuffer","base64","arraybuffer","bytes","encode","DataView","byteOffset","byteLength","HTMLImageElement","HTMLCanvasElement","ImageData","serializeArgs","supportedWebGLConstructorNames","initCanvasContextObserver","setPreserveDrawingBufferToTrue","contextType","ctxName","getNormalizedContextName","contextAttributes","preserveDrawingBuffer","splice","patchGLPrototype","getOwnPropertyNames","_loop","recordArgs","hookHandler","setter","sourcemapArg","takeFullSnapshot","WorkerFactory","lastBlobMap","transparentBlobMap","getTransparentBlobFor","_regeneratorRuntime","mark","_callee","offscreen","blob","arrayBuffer","wrap","_context","prev","globalThis","abrupt","OffscreenCanvas","convertToBlob","sent","stop","worker","self","onmessage","_callee2","_e$data","bitmap","transparentBase64","_context2","close","t0","t1","t2","postMessage","lines","sourcemap","blankPrefixLength","search","funcToSource","Blob","createObjectURL","createURL","Worker","CanvasManager","pendingCanvasMutations","rafStamps","latestId","invokeId","_options$sampling","initCanvasMutationObserver","initCanvasFPSObserver","clear","resetObservers","fps","canvasContextReset","snapshotInProgressMap","commands","rafId","timeBetweenSnapshots","lastSnapshotTime","takeCanvasSnapshots","matchedCanvas","requestAnimationFrame","getContextAttributes","COLOR_BUFFER_BIT","createImageBitmap","cancelAnimationFrame","startRAFTimestamping","startPendingCanvasMutationFlusher","canvas2DReset","CanvasRenderingContext2D","initCanvas2DMutationObserver","canvasWebGL1and2Reset","WebGLRenderingContext","WebGL","WebGL2RenderingContext","WebGL2","initCanvasWebGLMutationObserver","flushPendingCanvasMutations","_this4","setLatestRAFTimestamp","_this5","flushPendingCanvasMutationFor","valuesWithType","rest","t","hasOwnProperty","getOwnPropertySymbols","propertyIsEnumerable","__rest","StylesheetManager","trackedLinkElements","adoptedStyleSheetCb","linkEl","trackStylesheetInLinkElement","adoptedStyleSheetData","styleIds","CSSRule","ProcessedNodeManager","nodeMap","periodicallyClear","thisBuffer","buffers","wrapEvent","recording","record","checkoutEveryNms","checkoutEveryNth","_options$blockClass","_options$blockSelecto","_options$ignoreClass","_options$ignoreSelect","_options$maskTextClas","_options$maskTextSele","maskAllInputs","_maskInputOptions","_slimDOMOptions","packFn","mousemoveWait","_options$recordDOM","_options$recordCrossO","_options$recordAfter","recordAfter","_options$userTriggere","_options$collectFonts","_options$ignoreCSSAtt","inEmittingFrame","parent","passEmitsToParent","lastFullSnapshotEvent","color","date","email","month","number","tel","time","week","select","password","NodeList","DOMTokenList","_len2","_key2","TypeError","polyfill","incrementalSnapshotCount","eventProcessor","isFrozen","buf","exceedCount","exceedTime","wrappedMutationEmit","wrappedScrollEmit","wrappedCanvasMutationEmit","getMirror","nodeMirror","_ref2$mirror","_ref2$blockClass","_ref2$blockSelector","_ref2$maskTextClass","_ref2$maskTextSelecto","_ref2$inlineStyleshee","_ref2$inlineImages","_ref2$recordCanvas","_ref2$maskAllInputs","_ref2$slimDOM","slimDOM","_ref2$keepIframeSrcFn","snapshot","initialOffset","CustomElement","addLoadListener","destroy","addCustomEvent","tag","freezePage","StackFrame","fileName","functionName","lineNumber","columnNumber","FIREFOX_SAFARI_STACK_REGEXP","CHROME_IE_STACK_REGEXP","SAFARI_NATIVE_CODE_REGEXP","ErrorStackParser","parse","stacktrace","parseOpera","parseV8OrIE","parseFFOrSafari","extractLocation","urlLike","line","sanitizedLine","tokens","locationParts","functionNameRegex","parseOpera9","parseOpera11","parseOpera10","lineRE","parseFloat","pathToSelector","outerHTML","localName","domSiblings","children","sibling","isObject","isObjTooDeep","limit","_keys","stringifyOptions","numOfKeysLimit","depthOfLimit","thisPos","Infinity","_obj","shouldIgnore","stringLengthLimit","Event","eventResult","eventValue","HTMLElement","defaultLogOptions","level","lengthThreshold","logger","initLogObserver","logOptions","loggerType","logCount","inStack","cancelHandlers","trace","stackFrame","unhandledrejectionHandler","reason","levelType","_logger","errorplugin","revenuePlugin","dataLayer","originalPush_1","normalizedEvent","addToCart","add_to_cart","removeFromCart","remove_from_cart","beginCheckout","begin_checkout","purchase","transaction","dataLayerEvent","trackDataLayerChanges","getXPath","depth","ix","siblings","clickedElementPlugin","clickHandler","clickEvent","xPath","hoverHandler","hoverEvent","pollForClientId","intervalId","setInterval","clientId","getClientId","clientIdEvent","clearInterval","ga4Plugin","__generator","_","label","trys","ops","g","create","Iterator","verb","Symbol","iterator","op","__read","ar","SuppressedError","nativeIsArray","localDomains","MOBILE","IOS","ANDROID","TABLET","ANDROID_TABLET","IPAD","APPLE","APPLE_WATCH","SAFARI","BLACKBERRY","SAMSUNG","SAMSUNG_BROWSER","SAMSUNG_INTERNET","CHROME","CHROME_OS","CHROME_IOS","INTERNET_EXPLORER","INTERNET_EXPLORER_MOBILE","OPERA","OPERA_MINI","EDGE","MICROSOFT_EDGE","FIREFOX","FIREFOX_IOS","NINTENDO","PLAYSTATION","XBOX","ANDROID_MOBILE","MOBILE_SAFARI","WINDOWS","WINDOWS_PHONE","NOKIA","OUYA","GENERIC","GENERIC_MOBILE","GENERIC_TABLET","KONQUEROR","XBOX_REGEX","PLAYSTATION_REGEX","NINTENDO_REGEX","BLACKBERRY_REGEX","osMatchers","user_agent","versionParts","version","isUndefined","isNull","safariCheck","ua","vendor","userAgent","detectDevice","CAMPAIGN_PARAMS","Info","campaignParams","params","kwkey","kw","keyValuePair","queryParts","getQueryParam","detectOS","rgex","resultOrFn","detectBrowser","FACEBOOK","detectBrowserLanguage","navigator","language","userLanguage","detectDeviceType","device","detectIP","fetch","json","ip","UAPlugin","browser","browserLanguage","os","deviceType","MutationRateLimiter","rrweb","bucketSize","refillRate","mutationBuckets","loggedTracker","refillBuckets","getNodeOrRelevantParent","closestSVG","numberOfChanges","_h","_g","throttleMutations","initialMutationCount","max","onBlockedNode","mutationCount","u8","u16","u32","fleb","fdeb","clim","freb","eb","j","fl","revfl","revfd","rev","hMap","cd","mb","l","co","le","rvb","sv","r_1","flt","fdt","flm","fdm","shft","wbits","wbits16","hTree","sort","i0","i1","i2","maxSym","tr","mbt","ln","dt","lft","cst","i2_1","i2_2","i2_3","lc","cl","cli","cln","cls","w","subarray","clen","cf","wfblk","out","dat","wblk","final","syms","lf","df","li","bs","bl","dlt","mlb","ddt","mdb","lclt","nlc","lcdt","ndc","lcfreq","lct","mlcb","nlcc","lm","ll","dm","dl","flen","ftlen","dtlen","llm","lcts","it","clct","dst","deo","dflt","lvl","plvl","pre","post","lst","floor","opt","msk_1","bs1_1","ceil","bs2_1","hsh","lc_1","wi","hv","imod","pimod","rem","ch_1","dif","maxn","maxd","ml","nl","mmd","md","ti","lin","din","slc","deflateSync","opts","mem","log","st","circularReferenceReplacer","ancestors","at","estimateSize","sizeable","splitBuffer","sizeLimit","half","firstHalf","secondHalf","partitionKey","stream_key","flatMap","compressData","events","jsonString","binaryString","String","fromCharCode","btoa","uint8ArrayToBase64","TextEncoder","Queue","recorder","packets","processing","maxRetries","baseDelay","sending","local","delay","delayInms","isFullPageSnapshot","splitBySnapshot","startIndex","bufferToDatapacket","datapacket","fullSnapshot","processPacket","packet","splits","buffers_1","compressed","maxCharsPerChunk","maxSizeInBytes","chunk","bufferChunk","splitFullSnapshot","splitFullSnapshotCompressed","to","pack","__spreadArray","bufferPayload","sendPackets","processedPacket","reverse","proc","fullPageSnapshot","session","headers","Accept","Connection","fetchOptions","method","mode","response","ok","retryCount","pow","addPackets","clonedEvents","hostname","poll","SessionReplay","fullSnapshotExists","set_keys","session_id","_emit","queue","rrwebRecord","mutationRateLimiter","intervalSet","getInstance","instance","start_recording","is_eu","rrwebOptions","throttledEvent","controlledEvent","allevents","marketingPlugin","ContextMenu","Focus","Blur","sitewiz","Sitewiz","compress","gdpr","funnel","replay","begin","sessionId","dom_loaded_handler","gtm"],"mappings":"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","x_google_ignoreList":[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,31,38]}